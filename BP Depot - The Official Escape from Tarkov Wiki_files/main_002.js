var Di=Object.defineProperty;var lt=n=>{throw TypeError(n)};var Oi=(n,i,e)=>i in n?Di(n,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[i]=e;var s=(n,i,e)=>Oi(n,typeof i!="symbol"?i+"":i,e),ct=(n,i,e)=>i.has(n)||lt("Cannot "+e);var m=(n,i,e)=>(ct(n,i,"read from private field"),e?e.call(n):i.get(n)),O=(n,i,e)=>i.has(n)?lt("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(n):i.set(n,e),V=(n,i,e,t)=>(ct(n,i,"write to private field"),t?t.call(n,e):i.set(n,e),e);function Wt(){return"v159"}function Se(n,i){return n==null&&i==null?!0:n==null||i==null?!1:n.toLowerCase()===i.toLowerCase()}function Fi(n){n.cmd??(n.cmd=[]);const i=[...n.cmd];n.cmd.push=(...e)=>{for(const t of e)t(n);return 0};for(const e of i)e(n)}const Mi=n=>{const i=("; "+document.cookie).split("; "+n+"=");return i.length>=2?i.pop().split(";").shift():null},zt=n=>n!=null&&n.length?` domain=${n};`:"",xi=(n,i,e)=>{const t=new Date;t.setTime(t.getTime()+e.expires*1e3),document.cookie=`${n}=${i};${zt(e.domain)} path=${e.path}; expires=${t.toUTCString()}`},Ui=(n,i)=>{document.cookie=`${n}=;${zt(i.domain)} path=${i.path}; expires=Thu, 01 Jan 1970 00:00:00 GMT`},k={set:xi,get:Mi,delete:Ui},Gt=()=>{const n=window.location.hostname,i=n.split(".");return i.length<2?n:`.${i[i.length-2]}.${i[i.length-1]}`};function Vi(){const n=window.location.hostname.toLowerCase(),i=/(^|.)(showcase|externaltest|preview|verify|stable|sandbox-[^.]+)\./.exec(n);if(i&&i.length>2)return i[2];const[e]=n.split(".");return e||null}function Be(n){return new URLSearchParams(window.location.search).get(n)}function G(n){const i=Be(n);return Ee(n)&&i===""||i==="1"||i==="true"}function Ee(n){return new URLSearchParams(window.location.search).has(n)}const Wi="",zi=/^(?:(v\d+)-)?(\d{2})$/;function Gi(){let n=Be("pf_pathfinder_force_bucket")??k.get("exp_bucket");const i=n==null?void 0:n.match(zi);return i&&i.length>=3&&(n=i[2]),n??Wi}const _e="adengadinfo",Hi="adengadsizeinfo";var W=(n=>(n.SLOT_REQUESTED_INFO="requested_info",n.SLOT_CODE_SERVED_INFO="code_served_info",n.SLOT_RENDERED_INFO="success_info",n.SLOT_COLLAPSE_INFO="collapse",n.SLOT_FORCE_CLOSE_INFO="force-close",n.SLOT_CLICKED="clicked",n.SLOT_HEAVY_AD_INTERVENTION="heavy-ad-intervention",n))(W||{}),Ht=(n=>(n.SLOT_SIZE_ESTABLISHED="size_established",n))(Ht||{}),U=(n=>(n.BIDDER_RESPONSE="bid_response",n))(U||{}),et=(n=>(n.IDENTITY_INFO="identity_info",n))(et||{}),$t=(n=>(n.LABRADOR_KEYVALUES="labrador_keyvalues",n))($t||{}),P=(n=>(n.AE_FIRST_LINE_EXEC="ae.firstLineExec",n.AE_AFTER_INIT_PLUGINS="ae.afterInitPlugins",n.AE_AFTER_GPT_WRAPPER_INIT="ae.afterGptWrapperInit",n.AE_AD_ENGINE_INIT="ae.adEngineInit",n.AE_ON_BIDDERS_INIT="ae.onBiddersInit",n.AE_CONFIG_CALLBACK_STARTED="ae.beforeAuction.configCallbackStarted",n.AE_CONFIG_CALLBACK_COMPLETE="ae.beforeAuction.configCallbackComplete",n.AE_AUCTION_START="ae.auctionStart",n.AE_AUCTION_START_A9_START="ae.auctionStart.a9.bidStart",n.AE_AUCTION_END="ae.auctionEnd",n.AE_BEFORE_FIRST_CALL_ADS_REQUEST="ae.beforeFirstCallAdsRequest",n.AE_FIRST_RENDER_CYCLE_COMPLETE="ae.firstRenderCycleComplete",n.AE_GPT_SLOT_REQUESTED_INITIAL="ae.gpt.slotRequested.initial",n.AE_GPT_SLOT_RESPONSE_RECEIVED_INITIAL="ae.gpt.slotResponseReceived.initial",n.AE_GPT_SLOT_RENDERED_ENDED_INITIAL="ae.gpt.slotRenderEnded.initial",n.AE_GPT_SLOT_SLOT_ONLOAD_INITIAL="ae.gpt.slotOnload.initial",n))(P||{}),qt=(n=>(n.AE_AUCTION_DURATION_A9_BID_TOTAL_TIME="ae.d.auctionDuration.a9.bidTotalTime",n.AE_AUCTION_DURATION="ae.d.auctionDuration",n.AE_DURATION_TO_BID="ae.d.firstLineExec_to_auctionStart",n.AE_CONFIG_CALLBACK_DURATION="ae.d.configCallbackDuration",n))(qt||{});const _="adengloadtimes";var S=(n=>(n.SLOT_REQUESTED="requested",n.SLOT_RENDERED="rendered",n.AE_INIT="init",n.VENDOR_TIME_UPDATE="vendor_time_update",n.CREATIVE_RENDERED="creative_rendered",n.PERFORMANCE_MARK="performance_mark",n))(S||{}),jt=(n=>(n.TRACKING_EVENT="trackingevent",n))(jt||{}),c=(n=>(n.P1="p1",n.P2="p2",n.P3="p3",n.P4="p4",n))(c||{}),A=(n=>(n.ERROR_NO_TIER_PROVIDED="-2",n.ERROR_DISABLED_TIERS="-1",n.NOT_SUITABLE_FOR_ADVERTISING="2",n.PARTIALLY_MONETIZED="3",n.FULLY_MONETIZED="4",n))(A||{}),ze=(n=>(n.FANDOM_DESKTOP="fandomdesktop",n.FANDOM_MOBILE="fandommobile",n))(ze||{});function Kt(n=window.fandomContext??null){var e;const i=(e=n==null?void 0:n.page)==null?void 0:e.monetizationTier;return typeof i=="number"?i.toString():A.ERROR_NO_TIER_PROVIDED}const me=()=>{var n;return window.fandomHost??(window.fandomHost={cmd:[]}),(n=window.fandomHost).cmd??(n.cmd=[]),window.fandomHost};function h(n){me().cmd.push(i=>{i.issueManager.handleIssue({...n,type:"error"})})}function $i(n,i){var e;if(typeof i=="string"){const t=document.getElementsByTagName("script")[0];(e=t==null?void 0:t.parentNode)==null||e.insertBefore(n,t)}else(i??document.body).appendChild(n)}const qi={isAsyncOrDeferOtherwise:!0,node:null,parameters:{},datasets:{}};function ji(n){const{src:i,isAsyncOrDeferOtherwise:e,node:t,parameters:r,datasets:o}={...qi,...n},a=document.createElement("script");return a.async=!!e,a.defer=!e,a.src=i,r&&Object.keys(r).forEach(d=>{a.setAttribute(d,r[d])}),o&&Object.keys(o).forEach(d=>{a.dataset[d]=o[d]}),$i(a,t),a}async function H(n){try{return await new Promise((e,t)=>{const r=ji(typeof n=="string"?{src:n,node:null}:n);r.onload=o=>e(o),r.onerror=o=>t(o)})}catch(i){throw me().cmd.push(e=>e.adBlockManager.adBlockSuspected({suspected:!0,reason:"scriptBlocked"})),h({message:"Failed to load script",error:i,priority:c.P3,data:[{srcOrOptions:n}]}),i}}function Ki(){var n,i,e;return window.fandomTrack??(window.fandomTrack={q:[],cmd:[],registry:{}}),(n=window.fandomTrack).q??(n.q=[]),(i=window.fandomTrack).cmd??(i.cmd=[]),(e=window.fandomTrack).registry??(e.registry={}),window.fandomTrack}function f(n,i){Ki().q.push({event:n,payload:i})}async function be(n,i){try{f(_,{type:S.VENDOR_TIME_UPDATE,eventName:`${n}_started`,time:performance.now()});const e=await H(i);return f(_,{type:S.VENDOR_TIME_UPDATE,eventName:`${n}_loaded`,time:performance.now()}),e}catch(e){throw f(_,{type:S.VENDOR_TIME_UPDATE,eventName:`${n}_error_loading`,time:performance.now()}),e}}function tt(n,i,e=!1){const t=!n||typeof n!="object",r=!i||typeof i!="object";if(t&&r)return{};if(t)return i;if(r)return n;const o={...n};for(const a in i){const d=n[a],l=i[a];d===void 0?o[a]=l:Array.isArray(d)?o[a]=[...d,...Array.isArray(l)?l:[l]]:typeof d=="object"&&typeof l=="object"?o[a]=tt(d,l,e):e&&(o[a]=l)}return o}function E(n){me().cmd.push(i=>{i.issueManager.handleIssue({...n,type:"degradation"})})}class Yi{constructor(){s(this,"storage",{})}get length(){return Object.keys(this.storage).length}key(i){return Object.keys(this.storage)[i]}clear(){this.storage={}}getItem(i){var e;return((e=this.storage)==null?void 0:e[i])??null}removeItem(i){delete this.storage[i]}setItem(i,e){this.storage[i]=e}}function Yt(n){return n instanceof Object&&"expires"in n&&"data"in n&&typeof n.expires=="number"}function Qi(n){return Yt(n)&&n.expires?Date.now()>=n.expires:!1}class Qt{constructor(i=()=>window.localStorage){s(this,"fallbackStorage",new Yi);s(this,"provider");try{this.provider=i(),this.isAvailable()||(this.provider=this.fallbackStorage)}catch{this.provider=this.fallbackStorage}}isAvailable(){const i=`__o${Date.now()}__`;try{this.provider.setItem(i,i);const e=this.provider.getItem(i)==i;return this.provider.removeItem(i),e}catch{return!1}}getItem(i,e=!1){try{let t=this.provider.getItem(i);return t===null||e?t:(t=this.parseValue(t),Yt(t)?this.handleTTLItem(i,t):t)}catch{return this.fallbackStorage.getItem(i)}}parseValue(i){try{return JSON.parse(i)}catch{return i}}handleTTLItem(i,e){return Qi(e)?(this.removeItem(i),null):e.data}setItemWithTTL(i,e,t){const o={expires:Date.now()+t,data:e};return this.setItem(i,o)}setItem(i,e,t){if(t)return this.setItemWithTTL(i,e,t);const r=e instanceof Object?JSON.stringify(e):e;try{this.provider.setItem(i,r)}catch{this.fallbackStorage.setItem(i,r)}return!0}removeItem(i){try{this.provider.removeItem(i)}catch{this.fallbackStorage.removeItem(i)}}clear(){try{this.provider.clear()}catch{this.fallbackStorage.clear()}}}function ye(n,i={maxTries:100,fixedTimeout:0}){return(async()=>{let t=0,r="exponentialTimeout"in i?i.exponentialTimeout:i.fixedTimeout,o=n();for(;!o&&t<i.maxTries;)await new Promise(a=>setTimeout(a,r)),o=n(),"exponentialTimeout"in i&&(r*=2),t++;return o})()}function Xi(n,i){return new Promise((e,t)=>{setTimeout(()=>{let r=`Operation timed out after ${n}ms`;i&&(r=`${i} ${r}`),t(new Error(r))},n)})}function q(n,i,e){const t=Xi(i,e);return Promise.race([n,t])}function Zi(n=[],i){const e=n.flat().filter(t=>t.status==="rejected");if(e.length>0){for(const r of e)h({message:"Promise rejected",error:r.reason,priority:c.P3});let t=`${e.length} of ${n.length} promises were rejected.`;i!=null&&i.logMessagePrefix&&(t=`${i.logMessagePrefix} ${t}`),h({message:t,priority:(i==null?void 0:i.priority)??c.P3,data:e})}}async function ut(n,i,e){const t=await q(Promise.allSettled(n),i,e==null?void 0:e.logMessagePrefix);return Zi(t,e),t}const Ji=-1;function en(){var n;return((n=window.RLCONF)==null?void 0:n.wgCityId)??Ji}const gt="fandomContextUpdate",tn=(n=window)=>{const i=()=>{var e;return((e=n.fandomContext)==null?void 0:e.tracking)!==void 0&&n.fandomContext.tracking.pvNumber&&n.fandomContext.tracking.pvNumberGlobal&&n.fandomContext.tracking.pvUID};return new Promise(e=>{if(i())return e();const t=()=>{i()&&(n.removeEventListener(gt,t),e())};n.addEventListener(gt,t)})},Xt=[];function nn(n,i,e=[]){Xt.push({time:performance.now(),name:n,params:i,failures:e})}function rn(){return Xt}function K(n,i,...e){const t=[];for(const r of n){const o=r.hooks[i];if(typeof o=="function")try{o.call(r,...e)}catch(a){t.push(r.name),h({message:`Error running hook ${i} in plugin ${r.name}`,priority:c.P2,error:a})}}nn(i,e,t)}var x;class on{constructor(i){O(this,x);V(this,x,i)}get activePluginList(){return m(this,x).getPlugins().map(i=>i.name).sort()}get hooksLog(){return rn()}get adNodes(){return m(this,x).adNodeManager.getAdNodes()}get adEngineState(){return m(this,x).getDebugState()}get pluginState(){const i={};return m(this,x).getPlugins().forEach(e=>{i[e.name]=e.getDebugState()}),i}}x=new WeakMap;function sn(n){if(G("odyssey_debug"))return new on(n)}var Z;class an{constructor(i,e,t=[]){O(this,Z);s(this,"version");s(this,"deploymentEnvironment");s(this,"debug");s(this,"reset");var r;this.cmd=t,V(this,Z,i),this.deploymentEnvironment=((r=window.fandomAds)==null?void 0:r.deploymentEnvironment)??"unknown",this.version=Wt(),this.debug=sn(e),this.reset=()=>e.reset(),window.fandomAds=this,Fi(this)}getPlugin(i){if(!m(this,Z)[i])throw new Error(`Plugin ${i} does not exist`);return m(this,Z)[i].api}}Z=new WeakMap;const dn=(function(){const i=typeof document<"u"&&document.createElement("link").relList;return i&&i.supports&&i.supports("modulepreload")?"modulepreload":"preload"})(),ln=function(n){return"/"+n},ht={},B=function(i,e,t){let r=Promise.resolve();if(e&&e.length>0){let a=function(u){return Promise.all(u.map(b=>Promise.resolve(b).then(I=>({status:"fulfilled",value:I}),I=>({status:"rejected",reason:I}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),l=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));r=a(e.map(u=>{if(u=ln(u),u in ht)return;ht[u]=!0;const b=u.endsWith(".css"),I=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${I}`))return;const N=document.createElement("link");if(N.rel=b?"stylesheet":dn,b||(N.as="script"),N.crossOrigin="",N.href=u,l&&N.setAttribute("nonce",l),document.head.appendChild(N),b)return new Promise((ki,Li)=>{N.addEventListener("load",ki),N.addEventListener("error",()=>Li(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(a){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=a,window.dispatchEvent(d),!d.defaultPrevented)throw a}return r.then(a=>{for(const d of a||[])d.status==="rejected"&&o(d.reason);return i().catch(o)})};function cn(){var n,i,e;return((e=(i=(n=window.ads)==null?void 0:n.context)==null?void 0:i.opts)==null?void 0:e.isAdTestWiki)===!0}async function un(){const n=[];if(Ee("cid")){const{PassCIDPlugin:r}=await B(async()=>{const{PassCIDPlugin:o}=await import("./PassCIDPlugin-C9iykau-.js");return{PassCIDPlugin:o}},[]);n.push(new r)}if(G("gpt_debug")){const{GPTDebugPlugin:r}=await B(async()=>{const{GPTDebugPlugin:o}=await import("./GPTDebugPlugin-B2UbE4C9.js");return{GPTDebugPlugin:o}},[]);n.push(new r)}if(Ee("wikia_bidder")||Ee("pbjs_mock")){const{PrebidWikiaDebugPlugin:r}=await B(async()=>{const{PrebidWikiaDebugPlugin:o}=await import("./PrebidWikiaDebugPlugin-06HgfnV1.js");return{PrebidWikiaDebugPlugin:o}},[]);n.push(new r)}if(G("bidder_debug")){const{BidderDebugPlugin:r}=await B(async()=>{const{BidderDebugPlugin:o}=await import("./BidderDebugPlugin-3Dd0q8i8.js");return{BidderDebugPlugin:o}},[]);n.push(new r)}if(cn()){const{TestWikiPlugin:r}=await B(async()=>{const{TestWikiPlugin:o}=await import("./TestWikiPlugin-CYN-SKde.js");return{TestWikiPlugin:o}},[]);n.push(new r)}return n}function Zt(){var n;return(n=window.icbm)!=null&&n.config?Promise.resolve(window.icbm):new Promise(i=>{const e=()=>{i(window.icbm),window.removeEventListener("instantConfigLoaded",e)};window.addEventListener("instantConfigLoaded",e)})}const ae=class ae{constructor(i,e){s(this,"currentTier");this.adEngine=i,this.config=e,this.readCurrentTier()}reset(){this.readCurrentTier()}readCurrentTier(){if(!this.config.icTieredMonetizationEnabled){E({message:"MonetizationTierEngine: Tiered monetization is not enabled. Defaulting to FULLY_MONETIZED.",priority:c.P4}),this.currentTier=A.FULLY_MONETIZED;return}this.currentTier=Kt(),this.currentTier!==A.NOT_SUITABLE_FOR_ADVERTISING&&this.currentTier!==A.PARTIALLY_MONETIZED&&this.currentTier!==A.FULLY_MONETIZED&&(h({message:`MonetizationTierEngine: Invalid monetization tier value: ${this.currentTier}. Falling back to default tier: ${ae.DEFAULT_MONETIZATION_TIER}.`,priority:c.P4}),this.currentTier=ae.DEFAULT_MONETIZATION_TIER),this.isDemonetized()&&this.adEngine.adRenderManager.disableAdRendering()}filterTieredParamsByCurrentTier(i){if(!i||typeof i!="object"||i===null||Array.isArray(i))return{};const e=A.PARTIALLY_MONETIZED in i?i[A.PARTIALLY_MONETIZED]:void 0,t=A.FULLY_MONETIZED in i?i[A.FULLY_MONETIZED]:void 0;if(e===void 0&&t===void 0)return;const r=this.getCurrentTier();if(r===A.PARTIALLY_MONETIZED)return e;if(r===A.FULLY_MONETIZED)return t}isEnabled(){return this.config.icTieredMonetizationEnabled}getCurrentTier(){return this.currentTier}isMonetized(){return this.isPartiallyMonetized()||this.isFullyMonetized()}isNotSuitableForAdvertising(){return this.getCurrentTier()===A.NOT_SUITABLE_FOR_ADVERTISING}isPartiallyMonetized(){return this.getCurrentTier()===A.PARTIALLY_MONETIZED}isFullyMonetized(){return this.getCurrentTier()===A.FULLY_MONETIZED}isDemonetized(){return!this.isMonetized()}};s(ae,"DEFAULT_MONETIZATION_TIER",A.NOT_SUITABLE_FOR_ADVERTISING);let Ge=ae;const ve=200,gn=1,hn="https://pubads.g.doubleclick.net/gampad/ads?";function Jt(n,i=ve){if(!n)return!1;const{top:e,bottom:t}=n.getBoundingClientRect();return t>-i&&e<window.innerHeight+i}function fn(n){return Jt(n,0)}var oe=(n=>(n.EXACT="EXACT",n.LESS_THAN="LESS_THAN",n.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",n.GREATER_THAN="GREATER_THAN",n.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",n))(oe||{});function pn(n){return Array.isArray(n)&&Array.isArray(n[0])&&Array.isArray(n[0][0])}const mn={strategy:"once",match:"height",with:"GREATER_THAN"};function ei(n){switch(n){case"EXACT":return(i,e)=>i===e;case"LESS_THAN":return(i,e)=>i<e;case"LESS_THAN_OR_EQUAL":return(i,e)=>i<=e;case"GREATER_THAN":return(i,e)=>i>e;case"GREATER_THAN_OR_EQUAL":return(i,e)=>i>=e;default:throw new Error(`Invalid comparator: ${n}`)}}function ti(n){return Array.isArray(n)&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"}function bn(n){if(!ti(n))return!1;if(n[0]===0&&n[1]===0)throw new Error("Invalid size to compare [0,0]");return!0}function He(n,i,e="EXACT"){if(!ti(n)||!bn(i))return!1;const t=typeof e=="function"?e:ei(e),[r,o]=n,[a,d]=i;return a===0?t(o,d):d===0?t(r,a):t(r,a)&&t(o,d)}function Tn(n,i,e="EXACT"){if(!Array.isArray(n))return n;const t=ei(e);return n.filter(r=>!He(r,i,t))}function De(n,i,e="EXACT"){return n.map(t=>{const[r,o]=t;return[r,Tn(o,i,e)]})}function Sn(n,i){for(const e of n)e.length===2&&e[1].push(i);return n}function Ie(n){return n?Array.isArray(n)?n.join("x"):n:""}function ke(n){return n.flatMap(i=>{const e=i[1];return Array.isArray(e)&&(e.length===1||typeof e[0]!="number")?e.map(Ie):[Ie(e)]})}const En=/_\d+$/;function it(n){return n.replace(En,"")}const ft={masterSlotMarker:"<!-- Odyssey Creative Template",collapseAllMarker:'data-premium-takeover="true"',customSizeWidthRange:{min:2,max:20}};class nt extends Error{constructor(i){super(`Cannot create AdNode for disabled slot: slotName[${i}]`),this.slotName=i,this.name="DisabledSlotError"}}var J;class y extends HTMLElement{constructor(e){super();O(this,J);s(this,"adNode");V(this,J,e)}connectedCallback(){this.adNode||this.createAdNode()}disconnectedCallback(){m(this,J).adNodeManager.removeAdNode(this.adNode),this.adNode=void 0}getBaseSlotName(){var e;return((e=this.adNode)==null?void 0:e.getBaseSlotName())??it(this.id)}getAdUnitPath(){var e;return((e=this.adNode)==null?void 0:e.getAdUnitPath())??null}getTargeting(){var e;return((e=this.adNode)==null?void 0:e.getAllTargeting())??{}}createAdNode(){try{this.adNode=m(this,J).adNodeManager.createAdNode(this.id)}catch(e){if(e instanceof nt)return;throw e}if(!this.adNode)throw new Error(`AdNode for element with id[${this.id}] could not be created.`)}}J=new WeakMap,s(y,"ELEMENT_NAME","fandom-ad"),s(y,"WRAPPER_CLASS","fandom-ad-wrapper");function An(n){customElements.get(y.ELEMENT_NAME)||customElements.define(y.ELEMENT_NAME,class extends y{constructor(){super(n)}})}function _n(n){return n?n.style.height==="0px"||n.style.display==="none":!1}function pt(n){n&&(n.style.height="0px",n.style.display="none")}function mt(n){n&&(n.style.height="",n.style.display="")}var ii=(n=>(n.NOT_RENDERED="not-rendered",n.RENDERING="rendering",n.RENDERED="rendered",n))(ii||{}),R;class yn{constructor(i,e,t){O(this,R);s(this,"renderStatus","not-rendered");s(this,"renderCount",0);s(this,"currentSlotConfig");s(this,"adServerSlot");s(this,"baseSlotName");s(this,"emptyRetryCount",0);s(this,"blocked",!1);s(this,"collapsed",!1);s(this,"takeoverState",null);s(this,"bidderSizes");this.slotName=i,this.slotConfig=e,V(this,R,t),this.currentSlotConfig=structuredClone(e),this.baseSlotName=it(i),this.bidderSizes=this.filterSizesForBidders(),this.hookAdNodeToGptEvents()}hookAdNodeToGptEvents(){this.enableLimitingSizesIfConfigured(),this.listenToSlotRenderEnded()}enableLimitingSizesIfConfigured(){const i=this.getRefreshConfigRemoveSizes();if(!(i!=null&&i.strategy))return;const e=m(this,R).gptWrapper.addSlotEventListener(this.slotName,"impressionViewable",()=>{this.removeSizesFromSlotElement(),i.strategy==="once"&&e()})}listenToSlotRenderEnded(){m(this,R).gptWrapper.addSlotEventListener(this.slotName,"slotRenderEnded",i=>{i!=null&&i.isEmpty?this.emptyRetryCount+=1:this.emptyRetryCount=0,this.renderCount===1&&this.slotConfig.companion===!0&&this.inspectCreativeForTakeover(i.size),this.handleExactSizesToRemoveAfterRender(),this.renderStatus="rendered"})}inspectCreativeForTakeover(i){var a,d;const{masterSlotMarker:e,collapseAllMarker:t,customSizeWidthRange:r}=ft,o=Array.isArray(i)?i[0]:0;if(r.min<=o&&o<=r.max){const l=((d=(a=this.getIFrameElement())==null?void 0:a.contentDocument)==null?void 0:d.body.innerHTML)??"";l.includes(e)&&(this.takeoverState={isMaster:!0,shouldCollapseAll:l.includes(t)})}}setAdServerSlot(i){this.adServerSlot=i}destroy(){this.adServerSlot=void 0,m(this,R).gptWrapper.destroySlots([this])}reset(){var i;this.currentSlotConfig=structuredClone(this.slotConfig),this.bidderSizes=this.filterSizesForBidders(),this.emptyRetryCount=0,this.renderStatus="not-rendered",this.renderCount=0,this.blocked=!1,this.takeoverState=null,this.isCollapsed()&&this.uncollapse(),((i=this.getRefreshConfigRemoveSizes())==null?void 0:i.strategy)==="once"&&this.enableLimitingSizesIfConfigured()}getSlotName(){return this.slotName}setOutOfPageSlotName(i){this.slotName=i}getBaseSlotName(){return this.baseSlotName}getSlotType(){return this.currentSlotConfig.type??"display"}getSlotConfig(){return this.currentSlotConfig}setSlotConfig(i){this.currentSlotConfig=i}getBidderConfig(i){var e;return(e=this.currentSlotConfig.bidders)==null?void 0:e[i]}setBidderConfig(i,e){var t;(t=this.currentSlotConfig).bidders??(t.bidders={}),this.currentSlotConfig.bidders[i]=e}getTakeoverState(){return this.takeoverState}getElement(){return document.getElementById(this.slotName)}getIFrameElement(){var e;const i=(e=this.getElement())==null?void 0:e.getElementsByTagName("iframe");return(i==null?void 0:i[0])??null}getAdUnitPath(){return m(this,R).gptWrapper.getAdUnitPath(this.slotName)}clearTargeting(i){m(this,R).gptWrapper.clearSlotTargeting(this.slotName,i)}setTargeting(i,e){m(this,R).gptWrapper.setSlotTargeting(this.slotName,i,e)}getTargeting(i){try{return m(this,R).gptWrapper.getSlotTargeting(this.slotName,i)}catch{return[]}}getAllTargeting(){try{return m(this,R).gptWrapper.getAllSlotTargeting(this.slotName)}catch{return{}}}getRenderStatus(){return this.renderStatus}isEligibleToRender(){return!(this.isBlocked()||!this.adServerSlot||this.getRenderStatus()==="rendering"||this.hasEverBeenRequested()&&!this.isRefreshable())}isInViewport(){const i=this.getElement();return i?fn(i):!1}isNearViewport(){const i=this.getElement();return Jt(i,ve)}incrementRenderCount(){this.renderCount+=1,this.setTargeting("rv",this.renderCount.toString())}getRenderCount(){return this.renderCount}isRefreshable(){var i;return!!((i=this.currentSlotConfig.refresh)!=null&&i.enabled)&&this.emptyRetryCount<gn}isBlocked(){return this.blocked}block(){this.blocked=!0}unblock(){this.blocked=!1}isCollapsed(){return this.collapsed||_n(this.getElement())}getParentWrapper(){var e;const i=(e=this.getElement())==null?void 0:e.parentElement;return i!=null&&i.classList.contains(y.WRAPPER_CLASS)?i:null}collapse(){if(this.isCollapsed())return;this.collapsed=!0,this.blocked=!0;const i=this.getElement();i&&(pt(i),pt(this.getParentWrapper()))}uncollapse(){if(!this.isCollapsed())return;this.collapsed=!1,this.blocked=!1;const i=this.getElement();i&&(mt(i),mt(this.getParentWrapper()))}hasEverBeenRequested(){return this.renderStatus!=="not-rendered"}startRender(){this.renderStatus="rendering",this.takeoverState=null,this.incrementRenderCount()}getSizes(){return this.currentSlotConfig.sizes}setSizes(i){this.currentSlotConfig.sizes=i,this.bidderSizes=this.filterSizesForBidders();try{m(this,R).gptWrapper.updateSizeMapping(this.slotName,this.getSizes())}catch{}}getDefaultSizes(){const e=this.getSizes().flatMap(r=>r[1]);return Array.from(new Set(e.map(r=>JSON.stringify(r)))).map(r=>JSON.parse(r))}removeSizes(i,e=oe.EXACT){const t=this.getSizes();if(!Array.isArray(t))return;const r=De(t,i,e);this.setSizes(r)}getBidderSizes(){return this.bidderSizes}filterSizesForBidders(){const i=ft.customSizeWidthRange.max;let e=structuredClone(this.getSizes());e=De(e,[i,i],oe.LESS_THAN_OR_EQUAL);const{doNotEmitSizesForBidders:t}=this.getSlotConfig();return t!=null&&t.length&&t.forEach(r=>{e=De(e,r,oe.EXACT)}),e}getRefreshConfigRemoveSizes(){const{removeSizes:i}=this.currentSlotConfig.refresh??{};if(!(!this.isRefreshable()||!i))return i===!0?mn:i}removeSizesFromSlotElement(){var o;const i=this.getRefreshConfigRemoveSizes();if(!i)return;const e=(o=this.getElement())==null?void 0:o.querySelector("iframe");if(!e)return;const t=e.getBoundingClientRect(),r=[i.match==="height"?0:t.width,i.match==="width"?0:t.height];this.removeSizes(r,i.with)}handleExactSizesToRemoveAfterRender(){var e;const i=(e=this.currentSlotConfig.refresh)==null?void 0:e.exactSizesToRemove;i&&i.forEach(t=>{this.removeSizes(t)})}}R=new WeakMap;var bt="Invariant failed";function T(n,i){if(!n){var e=typeof i=="function"?i():i,t=e?"".concat(bt,": ").concat(e):bt;throw new Error(t)}}function L(){return window.fandomContext??null}const vn=1e10;function In(){return Math.floor(Math.random()*vn)+1}function Cn(){return["output=xml_vast4","env=vp","gdfp_req=1","impl=s","unviewed_position_start=1",`url=${encodeURIComponent(window.location.href)}`,`description_url=${encodeURIComponent(window.location.href)}`,`correlator=${In()}`]}function Pn(){var i,e;const n=(e=(i=L())==null?void 0:i.tracking)==null?void 0:e.ppid;return n?[`ppid=${n}`]:[]}function Rn(n){const i=ke(n.getSizes());return i.length>0?i.join("|"):"640x480"}var z,pe;class D extends y{constructor(e){super(e);s(this,"unblocked",Promise.withResolvers());s(this,"consentData");O(this,z);O(this,pe,Promise.withResolvers());V(this,z,e)}connectedCallback(){var e,t;super.connectedCallback(),Zt().then(r=>{r.config.icUAPJWPlayer||this.unblockVideo()}).catch(()=>{h({message:`Error retrieving instant config for video ad node: ${this.id}`,priority:c.P2})}),(t=(e=window.fandomAds)==null?void 0:e.cmd)==null||t.push(()=>{m(this,pe).resolve()})}async getVastUrl(){try{return(await this.requestRender()).vastUrl}catch{h({message:`Error retrieving VAST URL for video slot name: ${this.id}`,priority:c.P2})}}async requestRender(){return await m(this,pe).promise,this.consentData=await m(this,z).privacyManager.waitForConsents(),await this.requestBids(),{vastUrl:this.buildVastUrl(),vastParams:this.buildVastParams()}}unblockVideo(){this.unblocked.resolve()}buildVastParams(){const e=this.getTargeting()??{},{...t}=m(this,z).gptWrapper.getAllTargeting({raw:!1})??{};return{vpos:"preroll",slotTargeting:e,pageTargeting:t}}buildVastUrl(){return this.adNode?`${hn}${this.getParams().join("&")}`:""}async requestBids(){this.adNode&&(this.adNode.incrementRenderCount(),await m(this,z).adRenderManager.requestBids([this.adNode]),await this.waitForResolvedState())}waitForResolvedState(){return this.unblocked.promise}getParams(){return[...Cn(),...Pn(),...this.getPrivacyParams(),...this.getSlotParams(this.adNode),...this.getCustomParams()].filter(Boolean)}getPrivacyParams(){const{coppa:e,consentApi:t,consentString:r=""}=this.consentData??{},o=[];return t==="usp"?o.push(`us_privacy=${r}`,"gdpr=0"):t==="tcf"&&o.push(`gdpr_consent=${r}`,"gdpr=1"),e&&o.push("tfcd=1"),o}getSlotParams(e){const t=this.getAdUnitPath(),r=Rn(e);return[`iu=${t}`,`sz=${r}`]}getCustomParams(){const e=this.buildVastParams(),t=this.flattenTargetingParams(e),r=Object.entries(t).map(([o,a])=>`${o}=${Array.isArray(a)?a.join(","):a}`).join("&");return[`cust_params=${encodeURIComponent(r)}`]}flattenTargetingParams(e){const t={};for(const[r,o]of Object.entries(e))if(this.isNestedTargetingObject(r,o))Object.assign(t,o);else{const a=o;(typeof a=="string"||Array.isArray(a))&&(t[r]=a)}return t}isNestedTargetingObject(e,t){return(e==="slotTargeting"||e==="pageTargeting")&&typeof t=="object"&&t!==null&&!Array.isArray(t)}}z=new WeakMap,pe=new WeakMap,s(D,"ELEMENT_NAME","fandom-video-ad"),s(D,"WRAPPER_CLASS","fandom-video-ad-wrapper");function wn(n){customElements.get(D.ELEMENT_NAME)||customElements.define(D.ELEMENT_NAME,class extends D{constructor(){super(n)}})}class Nn{constructor(i,e,t){s(this,"adNodes",[]);s(this,"observer");this.adEngine=i,this.slotConfigMap=e,this.hooks=t}reset(){for(const i of this.getAdNodes())this.removeAdNode(i),i.reset(),this.registerAdNode(i)}registerAdNodes(){this.addAllStaticSlots(),this.registerAdNodeComponents()}getSlotConfigMap(){return this.slotConfigMap}getSlotConfig(i){return this.slotConfigMap.baseSlots[i]??this.slotConfigMap.baseSlots[it(i)]??this.slotConfigMap.videoSlots[i]}createAdNode(i,e){var o,a,d,l;const t=e??this.getSlotConfig(i);if(!t){h({message:`Cannot create adNode, no slot config found for slotName=[${i}]`,priority:c.P2});return}if((a=(o=this.hooks).onBeforeAdNodeCreated)==null||a.call(o,i,t),t.isDisabled)throw new nt(i);const r=new yn(i,t,this.adEngine);return this.registerAdNode(r),(l=(d=this.hooks).onAdNodeCreated)==null||l.call(d,r),r}registerAdNode(i){this.adNodes.push(i),this.adEngine.gptWrapper.defineSlot(i),this.observer&&this.startObservingElement(i)}removeAdNode(i){const e=i.getElement();e&&this.stopObservingElement(e),this.adNodes=this.adNodes.filter(t=>t.getSlotName()!==i.getSlotName()),i.destroy(),this.hooks.onAdNodeRemoved(i)}getAdNodes(){return this.adNodes}getFirstCallAdNodes(i=!0){return this.adNodes.filter(e=>{const{companion:t=!1,isFirstCall:r}=e.getSlotConfig();return r===!0&&t===i})}getAdNodeByName(i){let e=this.adNodes.find(t=>t.getSlotName()===i);return e??(e=this.adNodes.find(t=>t.getBaseSlotName()===i)),e}getAdNodesByBaseName(i){return this.adNodes.filter(e=>e.getBaseSlotName()===i)}getAdNodeByNameOrFail(i){const e=this.getAdNodeByName(i);return T(e,`adNode is not defined: ${i}`),e}blockSlot(i){this.getAdNodeByNameOrFail(i).block()}unblockSlot(i){this.getAdNodeByNameOrFail(i).unblock()}startRendering(){this.adEngine.adRenderManager.requestRender(this.getFirstCallAdNodes(),!0),this.adEngine.adRenderManager.requestRender(this.getFirstCallAdNodes(!1),!0),this.startIntersectionObserver()}startIntersectionObserver(){this.startObservingSlots(i=>{const e=i.map(t=>{if(t.intersectionRatio>0){const r=this.getAdNodeByName(t.target.id);if(r&&!r.hasEverBeenRequested())return r}}).filter(t=>t!==void 0);this.adEngine.adRenderManager.requestRender([...new Set([...e])])})}startObservingSlots(i){this.observer=new IntersectionObserver(i,{root:null,rootMargin:`${ve}px 0px ${ve}px 0px`,threshold:1}),this.getAdNodes().forEach(e=>{this.startObservingElement(e)})}startObservingElement(i){var t;const e=i.getElement();e&&i.getSlotType()==="display"&&((t=this.observer)==null||t.observe(e))}stopObservingElement(i){var e;(e=this.observer)==null||e.unobserve(i)}registerAdNodeComponents(){An(this.adEngine),wn(this.adEngine)}addAllStaticSlots(){const i=this.getSlotConfigMap().baseSlots,e=y.ELEMENT_NAME.toUpperCase();Object.values(i).forEach(t=>{if(t&&!t.dynamic){const r=document.getElementById(t.name);r&&r.tagName!==e&&this.createAdNode(t.name,t)}})}}const Ae="-1",$e="0",ni="1",qe="2",ce="0",$="1",Tt="registeredUser",rt="notRegistered",Bn="activeEditor";function kn(n){var i;return(i=n==null?void 0:n.site)!=null&&i.top1000?"_top1k_wiki":"_not_a_top1k_wiki"}class Ln{constructor(i){s(this,"SERVER_PREFIX","wka1b");this.gptWrapper=i}buildAdUnitPathForNode(i){const e=L(),t=this.gptWrapper.getGamId(),{group:r}=i.getSlotConfig(),o=i.getSlotName(),a=kn(e),[d="fandom"]=this.gptWrapper.getTargeting("product"),[l="article"]=this.gptWrapper.getTargeting("s2"),[u="all"]=this.gptWrapper.getTargeting("s0"),[b="ucp_desktop"]=this.gptWrapper.getTargeting("skin"),[I="desktop"]=this.gptWrapper.getTargeting("device");return`/${t}/${this.SERVER_PREFIX}.${r}/${o}/${I}/${b}-${d}-${l}/${a}-${u}`}setupPerformanceMarks(i){i.addToCommandQueue(()=>{this.registerEventPerformanceMarkCallback(i,"slotRequested","top_leaderboard"),this.registerEventPerformanceMarkCallback(i,"slotResponseReceived","top_leaderboard"),this.registerEventPerformanceMarkCallback(i,"slotRenderEnded","top_leaderboard"),this.registerEventPerformanceMarkCallback(i,"slotOnload","top_leaderboard")})}registerEventPerformanceMarkCallback(i,e,t){i.addEventListener(e,({slot:r})=>{const o=r.getTargeting("rv");if(o.length>0&&o[0]==="1"&&r.getSlotElementId()===t){const d=this.getInitialSlotPerformanceMarkName(e);d&&performance.mark(d.toString(),{detail:{slotId:t}})}})}getInitialSlotPerformanceMarkName(i){switch(i){case"slotRequested":return P.AE_GPT_SLOT_REQUESTED_INITIAL;case"slotResponseReceived":return P.AE_GPT_SLOT_RESPONSE_RECEIVED_INITIAL;case"slotRenderEnded":return P.AE_GPT_SLOT_RENDERED_ENDED_INITIAL;case"slotOnload":return P.AE_GPT_SLOT_SLOT_ONLOAD_INITIAL}}}function Dn({consentApi:n,optOut:i,coppa:e}){const t=n==="tcf"&&i?$:ce,r=n==="usp"&&i?$:ce,o=On(e);return{npa:t,rdp:r,monetization:o}}function On(n){var i,e;if((e=(i=window.fandomContext)==null?void 0:i.site)!=null&&e.directedAtChildren)return n?"restricted":"regular"}const St="fs";class Fn{constructor(i,e,t){s(this,"GAM_ID","5441");s(this,"gptPlatformPlugin");this.adEngine=i,this.initialPageTargeting=e,this.hooks=t,this.gptPlatformPlugin=new Ln(this),window.googletag=window.googletag??{cmd:[]},this.gptPlatformPlugin.setupPerformanceMarks(this)}async enableServices(){return new Promise(i=>{this.addToCommandQueue(()=>{googletag.pubads().disableInitialLoad(),googletag.pubads().enableSingleRequest(),googletag.pubads().enableVideoAds();for(const[e,t]of Object.entries(this.initialPageTargeting))this.setTargeting(e,t);googletag.enableServices(),i()})})}reset(){this.clearAllTargeting()}getGamId(){return this.GAM_ID}setConfig(i){this.addToCommandQueue(()=>{googletag.setConfig(i)})}setTargeting(i,e){if(typeof i=="string"){if(typeof e=="string"||Array.isArray(e)){googletag.pubads().setTargeting(i,e);return}E({message:`Targeting value for key "${i}" must be a string or an array of strings, passed ${e}`,priority:c.P3})}else i?googletag.setConfig({targeting:{...i}}):E({message:`GPT setTargeting was called with invalid parameters: ${i}, ${e}`,priority:c.P3})}getTargeting(i){return googletag.pubads().getTargeting(i)}getAdUnitPath(i){const e=this.getGPTSlotsBySlotNames([i]);return e.length>=1?e[0].getAdUnitPath():null}getAllTargeting(i={}){const{raw:e=!1}=i,t={},r=googletag.pubads().getTargetingKeys();for(const o of r){const a=this.getTargeting(o);e||a.length>1?t[o]=a:a.length===1&&(t[o]=a[0])}return t}clearTargeting(i){googletag.setConfig({targeting:{[i]:null}})}clearAllTargeting(){googletag.setConfig({targeting:null})}updatePublisherProvidedId(i){i&&this.addToCommandQueue(()=>{this.setTargeting("ppid",i),googletag.pubads().setPublisherProvidedId(i)})}updatePrivacySettings(i){const{npa:e,rdp:t,monetization:r}=Dn(i);this.addToCommandQueue(()=>{r&&this.setTargeting("monetization",r),this.setTargeting("npa",e),this.setTargeting("rdp",t),googletag.pubads().setPrivacySettings({nonPersonalizedAds:e===$,restrictDataProcessing:t===$,childDirectedTreatment:i.coppa===!0})})}defineOutOfPageSlot(i,e,t){const{format:r="INTERSTITIAL"}=t??{},o=googletag.defineOutOfPageSlot(e,googletag.enums.OutOfPageFormat[r]??i.getSlotConfig().name);return o!==null&&i.setOutOfPageSlotName(o==null?void 0:o.getSlotElementId()),o}defineSlot(i){this.addToCommandQueue(()=>{var d;const e=i.getSlotConfig(),t=this.gptPlatformPlugin.buildAdUnitPathForNode(i);let r=null;const o=(d=e.dynamic)==null?void 0:d.outOfPage;if(o?r=this.defineOutOfPageSlot(i,t,o):r=googletag.defineSlot(t,i.getDefaultSizes(),i.getSlotName()),r===null){h({message:`GptWrapper: Slot ${i.getSlotName()} could not be defined.`,priority:c.P2,data:i});return}i.setAdServerSlot(r),Object.entries(e.targeting).forEach(([l,u])=>{r.setTargeting(l,u)});const a=i.getSizes();a&&!o&&r.defineSizeMapping(a),r.addService(googletag.pubads()),e.companion&&r.addService(googletag.companionAds())})}getGPTSlotsByAdNodes(i){return this.getGPTSlotsBySlotNames(i.map(e=>e.getSlotName()))}getSlotById(i){return googletag.pubads().getSlots().find(e=>e.getSlotElementId()===i)??null}getGPTSlotsBySlotNames(i){const e=new Set(i),t=googletag.pubads().getSlots().filter(a=>e.has(a.getSlotElementId())),r=t.map(a=>a.getSlotElementId()),o=[...e].filter(a=>!r.includes(a));return o.length>0&&(console.error("Slots missing from googletag:",o),me().cmd.push(a=>a.adBlockManager.adBlockSuspected({suspected:!0,reason:"nodeMissing"}))),t}addKeyValForTruncationCheck(){this.clearTargeting(St),this.setTargeting(St,"t")}requestSlots(i){this.hooks.onBeforeAdsRequest(i),this.addKeyValForTruncationCheck(),googletag.pubads().refresh(this.getGPTSlotsByAdNodes(i))}destroySlots(i){i&&googletag.destroySlots(this.getGPTSlotsByAdNodes(i))}clearSlotTargeting(i,e){const[t]=this.getGPTSlotsBySlotNames([i]);T(t,`Slot ${i} not found`),t.clearTargeting(e)}setSlotTargeting(i,e,t){const[r]=this.getGPTSlotsBySlotNames([i]);T(r,`Slot ${i} not found`),r.setTargeting(e,t)}getSlotTargeting(i,e){const[t]=this.getGPTSlotsBySlotNames([i]);return T(t,`Slot ${i} not found`),t.getTargeting(e)}getAllSlotTargeting(i,e={}){const{raw:t=!0}=e,[r]=this.getGPTSlotsBySlotNames([i]);T(r,`Slot ${i} not found`);const o=r.getTargetingKeys();return Object.fromEntries(o.map(a=>{let d=r.getTargeting(a);return!t&&Array.isArray(d)&&d.length===1&&(d=d[0]),[a,d]}))}updateSizeMapping(i,e){const[t]=this.getGPTSlotsBySlotNames([i]);return T(t,`Slot ${i} not found`),t.defineSizeMapping(e)}addToCommandQueue(i){googletag.cmd.push(i)}addEventListener(i,e){googletag.pubads().addEventListener(i,e)}removeEventListener(i,e){googletag.pubads().removeEventListener(i,e)}addSlotEventListener(i,e,t){const r=o=>{o.slot.getSlotElementId()===i&&t(o)};return this.addEventListener(e,r),()=>this.removeEventListener(e,r)}}class Mn{constructor(i,e){s(this,"consentData");s(this,"pendingWaitForConsentResolver");s(this,"pendingWaitForBlockingResolver");this.adEngine=i,this.hooks=e,this.consentData=window.fandomCmp,this.startConsentUpdateListener()}startConsentUpdateListener(){const i=()=>{this.fandomCmpReady(window.fandomCmp)&&this.fandomConsentUpdateHandler()};window.addEventListener("fandomConsentUpdate",i),i()}async fandomConsentUpdateHandler(){var i,e;this.consentData=window.fandomCmp,this.updateGptPrivacySettings(),(i=this.pendingWaitForConsentResolver)==null||i.call(this,this.consentData),this.pendingWaitForConsentResolver=void 0,this.consentData.allowed.ads&&((e=this.pendingWaitForBlockingResolver)==null||e.call(this,this.consentData),this.pendingWaitForBlockingResolver=void 0),this.notifyPluginsOfConsentChange()}updateGptPrivacySettings(){this.consentData&&this.adEngine.gptWrapper.updatePrivacySettings(this.consentData)}notifyPluginsOfConsentChange(){T(this.consentData,"Expected window.fandomCmp to have consent data before calling onConsentUpdated"),this.hooks.onConsentUpdated(this.consentData)}fandomCmpReady(i){return(i==null?void 0:i.ready)===!0}async waitForConsents(){return new Promise(i=>{this.consentData!==void 0&&this.fandomCmpReady(this.consentData)&&i(this.consentData),this.pendingWaitForConsentResolver=i})}async waitForAdsAllowed(){return new Promise(i=>{var e,t;((e=this.consentData)==null?void 0:e.ready)===!0&&((t=this.consentData)==null?void 0:t.allowed.ads)===!0&&i(this.consentData),this.pendingWaitForBlockingResolver=i})}}class xn{constructor(i,e,t){s(this,"enableBidding",!0);s(this,"enableAdRendering",!0);s(this,"renderCycleCount",0);s(this,"isFirstRenderCycleComplete",!1);this.adEngine=i,this.config=e,this.hooks=t}async waitForFirstRenderCycleComplete(){return this.isFirstRenderCycleComplete?!0:await ye(()=>this.isFirstRenderCycleComplete,{maxTries:50,fixedTimeout:50})}async finishFirstRenderCycle(i=[]){await ye(()=>i.every(t=>t.getRenderStatus()===ii.RENDERED),{maxTries:50,fixedTimeout:50});let e=$e;for(const t of i){const r=t.getTakeoverState();if(r!=null&&r.isMaster){e=r.shouldCollapseAll?ni:qe;break}}this.adEngine.gptWrapper.setTargeting("odyssey_takeover",e),this.hooks.onFirstRenderCycleComplete(this.adEngine,i,e),this.isFirstRenderCycleComplete=!0,performance.mark(P.AE_FIRST_RENDER_CYCLE_COMPLETE)}disableBidding(){this.enableBidding=!1}isBiddingEnabled(){return this.enableBidding}disableAdRendering(){this.disableBidding(),this.enableAdRendering=!1}isAdRenderingEnabled(){return this.enableAdRendering}getDebugState(){return{enableBidding:this.enableBidding,enableAdRendering:this.enableAdRendering,renderCycleCount:this.renderCycleCount,isFirstRenderCycleComplete:this.isFirstRenderCycleComplete}}async start(){if(this.enableBidding){const i=[];this.hooks.onBiddersInit(this.adEngine,i);try{await ut(i,this.config.icAdEngineBidderInitTimeoutMS,{logMessagePrefix:"onBiddersInit",priority:c.P3})}catch(e){E({message:"onBiddersInit timed out",priority:c.P3,error:e})}performance.mark(P.AE_ON_BIDDERS_INIT)}if(this.enableAdRendering){this.adEngine.adNodeManager.startRendering();return}}async reset(){this.isFirstRenderCycleComplete=!1,this.renderCycleCount=0,this.enableAdRendering=!0,this.enableBidding=!0}async requestBids(i,e){if(!this.enableBidding)return;const t={auctionId:crypto.randomUUID(),adNodes:i,pageTargeting:this.adEngine.gptWrapper.getAllTargeting(),renderCycleCount:e},r=(...o)=>{this.hooks.onCreateBidderAdUnit(...o)};try{const o=[];this.hooks.onCreateBiddersRequests(o,t,this.adEngine,r),performance.mark(P.AE_AUCTION_START,{detail:{renderCycleCount:e,auctionId:t.auctionId}}),await ut([...o],this.config.icAdEngineOnCreateBiddersRequestsTimeoutMS,{logMessagePrefix:`onCreateBiddersRequests [cycle ${e}]`,priority:c.P3}),performance.mark(P.AE_AUCTION_END,{detail:{renderCycleCount:e,auctionId:t.auctionId}})}catch(o){E({message:"Bidders requests timed out",priority:c.P3,error:o})}}async requestRender(i=[],e=!1){if(!this.enableAdRendering)return;const t=[];for(const r of i)(e||r.isEligibleToRender())&&(r.startRender(),t.push(r));t.length&&await this.render(t)}async render(i=[]){this.renderCycleCount++;const e=this.renderCycleCount;await this.requestBids(i,e),e===1&&(this.config.icAdEngineWaitBeforeFirstAdsRequestMS>0&&await new Promise(t=>setTimeout(t,this.config.icAdEngineWaitBeforeFirstAdsRequestMS)),this.hooks.onBeforeFirstCallAdsRequest(this.adEngine.gptWrapper,this.adEngine.adNodeManager),performance.mark(P.AE_BEFORE_FIRST_CALL_ADS_REQUEST)),e>1&&!this.isFirstRenderCycleComplete&&await this.waitForFirstRenderCycleComplete(),this.adEngine.gptWrapper.requestSlots(i),e===1&&await this.finishFirstRenderCycle(i)}}class Un{constructor(i,e,t,r){s(this,"monetizationTierEngine");s(this,"gptWrapper");s(this,"privacyManager");s(this,"adNodeManager");s(this,"adRenderManager");this.config=i,this.plugins=e,this.initialPageTargeting=t,this.platformConfig=r,this.adRenderManager=new xn(this,this.config,{onBiddersInit:this.generateHookCallback("onBiddersInit"),onCreateBiddersRequests:this.generateHookCallback("onCreateBiddersRequests"),onCreateBidderAdUnit:this.generateHookCallback("onCreateBidderAdUnit"),onBeforeFirstCallAdsRequest:this.generateHookCallback("onBeforeFirstCallAdsRequest"),onFirstRenderCycleComplete:this.generateHookCallback("onFirstRenderCycleComplete")}),this.monetizationTierEngine=new Ge(this,this.config),this.gptWrapper=new Fn(this,t,{onBeforeAdsRequest:this.generateHookCallback("onBeforeAdsRequest")}),this.privacyManager=new Mn(this,{onConsentUpdated:this.generateHookCallback("onConsentUpdated")}),this.adNodeManager=new Nn(this,r.slots,{onAdNodeCreated:this.generateHookCallback("onAdNodeCreated"),onBeforeAdNodeCreated:this.generateHookCallback("onBeforeAdNodeCreated"),onAdNodeRemoved:this.generateHookCallback("onAdNodeRemoved")})}generateHookCallback(i){return(...e)=>this.runHook(i,...e)}runHook(i,...e){K(this.plugins,i,...e)}async start(){await this.adRenderManager.start()}reset(){this.adRenderManager.reset(),this.monetizationTierEngine.reset(),this.gptWrapper.reset(),this.adNodeManager.reset(),this.runHook("onAdEngineReset",this),this.start()}getDebugState(){return{...this.adRenderManager.getDebugState()}}getPlatformConfig(){return this.platformConfig}getPlugins(){return this.plugins}}async function Vn(){return new Promise(n=>{window.fandomHost=window.fandomHost??{},window.fandomHost.cmd=window.fandomHost.cmd??[],window.fandomHost.cmd.push(n)})}async function Wn(n,i,e){const t={};K(i,"onInitPageTargeting",t),K(i,"onInitSlotConfigMap",e.slots);const r=new Un(n,i,t,e);return await Promise.all([r.privacyManager.waitForConsents(),Vn()]),await r.gptWrapper.enableServices(),K(i,"onAfterGptWrapperInit",r.gptWrapper),performance.mark(P.AE_AFTER_GPT_WRAPPER_INIT),r.adNodeManager.registerAdNodes(),K(i,"onAfterAdNodeManagerInit",r.adNodeManager,e.slots.baseSlots),await r.privacyManager.waitForAdsAllowed(),K(i,"onAdEngineInit",r),performance.mark(P.AE_AD_ENGINE_INIT),r}function zn(n){return!!(n!=null&&n.baseSlots)}function Et(n){return zn(n)?{app:n.app,version:n.version,slots:n}:n}async function Gn(n){const i=window.fandomAdsSlotsConfig;if(i){const e=Et(i);return window.fandomAdsSlotsConfig=e,e}else{const{loadConfig:e}=await B(async()=>{const{loadConfig:o}=await import("./handleDynamicConfig-077wGdgk.js");return{loadConfig:o}},[]),t=await e(n),r=Et(t);return window.fandomAdsSlotsConfig=r,r}}var ee;class g{constructor(){O(this,ee);s(this,"api");s(this,"hooks",{})}static isEnabled(i){return!!i}getDebugState(){return{}}setPlugins(i){V(this,ee,i)}usePlugin(i){var e,t;return(t=(e=m(this,ee))==null?void 0:e.get(i))==null?void 0:t.api}useExperiment(i){var e,t;return(t=(e=m(this,ee))==null?void 0:e.get(i))==null?void 0:t.api}}ee=new WeakMap;function ri(){var n;return((n=window.ads)==null?void 0:n.context)??null}class Hn{constructor(i,e){s(this,"AMZN_TOKEN_NAME","AMZN-Token");s(this,"APSTAG_RECORD_KEY","apstagRecord");s(this,"APSTAG_HEM_SENT_KEY","apstagHEMsent");s(this,"APSTAG_HEM_OPTOUT_KEY","apstagHEMoptOut");s(this,"AMAZON_TOKEN_TTL",336*60*60*1e3);s(this,"storage",new Qt);this.config=i,this.consentData=e}updateConsentData(i,e){this.consentData=i,this.updateApstagPublisherAudienceConfig(e)}updateApstagPublisherAudienceConfig({gdprParam:i}){var o,a;if(this.cleanUpA9TokensIfApplicable(),!this.isHemSyncingEnabled())return;const e=this.resolveHashedEmailSource(),{optOut:t}=this.consentData;if(!e){E({message:"Can't update HEM without an email record.",priority:c.P4}),t&&window.apstag&&((a=(o=window.apstag).dpa)==null||a.call(o));return}const r={...i,optOut:t,hashedRecords:[{type:"email",record:e}]};this.syncHemIfApplicable(r)}getApstagRecordFromStorage(){return this.storage.getItem(this.APSTAG_RECORD_KEY)}getHashedEmailFromAdsContext(){var e;const i=(e=ri())==null?void 0:e.opts.userEmailHashes;return!Array.isArray(i)||(i==null?void 0:i.length)!==3?null:i[2]}resolveHashedEmailSource(){return this.getApstagRecordFromStorage()??this.getHashedEmailFromAdsContext()??null}syncHemIfApplicable(i){var o,a,d,l;const e=(a=(o=i==null?void 0:i.hashedRecords)==null?void 0:o[0])==null?void 0:a.record,{optOut:t}=i;if(!e)return;const r=this.deriveApstagTokenizationFunction(t);r&&window.apstag&&((l=(d=window.apstag)[r])==null||l.call(d,i,()=>{this.updateApstagConsentInLocalStorage(e,t)}))}deriveApstagTokenizationFunction(i){return this.checkIfUserConsentChanged(i)?"upa":this.checkIfA9TokenShouldBeRenewed()?"rpa":null}checkIfA9TokenShouldBeRenewed(){const i=this.storage.getItem(this.APSTAG_HEM_SENT_KEY,!0);if(!i)return!0;const e=parseInt(i,10);return isNaN(e)?!0:e<Date.now()}checkIfUserConsentChanged(i){const e=this.storage.getItem(this.APSTAG_HEM_OPTOUT_KEY,!1);return e!==null&&i!==e}isHemSyncingEnabled(){return this.config.icA9HEM&&!this.config.icA9CleanHEM}updateApstagConsentInLocalStorage(i,e){this.storage.setItem(this.APSTAG_RECORD_KEY,i),this.storage.setItem(this.APSTAG_HEM_OPTOUT_KEY,e.toString()),k.get(this.AMZN_TOKEN_NAME)?this.storage.setItem(this.APSTAG_HEM_SENT_KEY,(Date.now()+this.AMAZON_TOKEN_TTL).toString()):this.storage.removeItem(this.APSTAG_HEM_SENT_KEY)}cleanUpA9TokensIfApplicable(){this.config.icA9CleanHEM&&this.cleanUpA9Tokens()}cleanUpA9Tokens(){var i,e;(k.get(this.AMZN_TOKEN_NAME)||this.storage.getItem(this.APSTAG_RECORD_KEY))&&((e=(i=window.apstag)==null?void 0:i.dpa)==null||e.call(i),this.storage.removeItem(this.APSTAG_RECORD_KEY),this.storage.removeItem(this.APSTAG_HEM_SENT_KEY),this.storage.removeItem(this.APSTAG_HEM_OPTOUT_KEY),k.delete(this.AMZN_TOKEN_NAME,{path:"/"}))}}function $n(n,i,e){var r,o;return(o=(r=n.filter(([a])=>a[0]<=i&&a[1]<=e).sort(([a],[d])=>d[0]-a[0]||d[1]-a[1]))==null?void 0:r[0])==null?void 0:o[1]}const oi=10,qn={currency:"USD",value:oi};class jn{constructor(i,e,t,r,o){s(this,"apstagConfigParams");s(this,"a9HemSyncer");this.consentData=i,this.timeout=e,this.config=t,this.apstagConfigParams={pubID:r,adServer:"googletag",videoAdServer:"DFP",simplerGPT:!0,deals:!0,bidTimeout:this.timeout,signals:o?{ortb2:o}:{}},this.a9HemSyncer=new Hn(this.config,this.consentData),this.init(!0)}configureCommand(i,e){window.apstag._Q.push([i,e])}updateApstagOrtb2Signals(i){i&&(this.apstagConfigParams.signals.ortb2=i,this.updateApstagConfig())}updateApstagConfig(){if(window.apstag){const{gdprParam:i,uspParam:e}=this.getConsentsParams();window.apstag.init({...this.apstagConfigParams,...i,...e})}}init(i){window.apstag=window.apstag??{_Q:[],init:(...t)=>{this.configureCommand("i",t)},fetchBids:(...t)=>{this.configureCommand("f",t)}};const e=this.getConsentsParams();this.updateApstagConfig(),i&&this.a9HemSyncer.updateApstagPublisherAudienceConfig(e)}getConsentsParams(){return{gdprParam:this.consentData.consentApi==="tcf"?{gdpr:{cmpTimeout:this.timeout}}:{gdpr:{enabled:!1}},uspParam:this.getUspParam()}}handleConsentChange(i){this.consentData=i;const e=this.getConsentsParams();this.updateApstagConfig(),this.a9HemSyncer.updateConsentData(i,e)}getUspParam(){return this.consentData.consentApi==="usp"&&this.consentData.consentString?{params:{us_privacy:this.consentData.consentString}}:{}}async requestBids(i,e){if(!this.consentData.allowed.ads||this.consentData.coppa)return[];T(window.apstag,"window.apstag has not been initialized yet");const t={slots:this.buildBidsConfig(i.adNodes),timeout:this.timeout};if(!t.slots.length)return[];e("a9",i,t);const r=new Promise(o=>{var a;(a=window.apstag)==null||a.fetchBids(t,d=>{var l,u;(u=(l=window.apstag)==null?void 0:l.setDisplayBids)==null||u.call(l),o(d)})});try{return await q(r,this.timeout)}catch{return this.buildTimedOutResponse(t.slots)}}buildTimedOutResponse(i){return i.map(e=>({slotID:e.slotID,timedOut:!0}))}transformA9Config(i,e){if(!i.sizeConfig)return i;const t={...i,sizes:$n(e,window.innerWidth,window.innerHeight)};return delete t.sizeConfig,t}buildBidsConfig(i){const e=[];return i.forEach(t=>{const r=t.getBidderConfig("a9");if(!r)return;const o=t.getSlotName(),a=t.getBidderSizes(),d=this.transformA9Config(r,a),l={slotName:t.getAdUnitPath()??o,slotID:o,floor:qn,...d};e.push(l)}),e}}function Kn(n){const i=parseFloat(n);return isNaN(i)?"-1":`us_tier${Yn(i)}`}function Yn(n){return n>=.7?1:n>=.5?2:3}const si=6,Qn="1217",Xn="bsr004",Zn="1014",Jn=40,er=50,At={main_vertical:{from:"main_vertical",limit:"one-of-each"},main_entity_type:{from:"main_entity_type",limit:"one-of-each"},genre:{from:"genres",addConfidence:"site"},subgenre:{from:"subgenres",addConfidence:"site"},vertical:{from:"verticals",addConfidence:"all"},themes:{from:"themes",addConfidence:"site"},fran:{from:"franchises"},trending:{from:"trending_score",transformValue:Kn}};function ai(n){const i=(window==null?void 0:window.fandomTaxonomy)??{};return(i==null?void 0:i[n])??[]}function F(n){const i=[Qn,Xn],e=ai(n),t=(e==null?void 0:e.iab_categories)??[];return t.length>0?i.push(...t):i.push(Zn),Array.from(new Set(i.filter(Boolean)))}function tr(n){return typeof n!="number"||isNaN(n)?"":`_c${0+Math.floor(n*10)}`}function ir(n){return typeof n!="object"||n===null?n:Object.keys(n).reduce((i,e)=>(n[e]&&n[e].length>0&&(i[e]=n[e]),i),{})}function nr(n){return typeof n=="object"&&n&&typeof n.value=="string"&&n.value.length>0&&typeof n.confidence=="number"}const rr={site:"s_",page:"p_"};function _t(n,i,e){const t=ai(n);let r=(t==null?void 0:t[i])??[];return Array.isArray(r)||(r=[r]),r.filter(nr).map(a=>{const d=typeof e=="function"?e(a.value):a.value;return{...a,value:`${rr[n]}${d}`}})}function or(n){const{from:i,addConfidence:e=!1,limit:t,transformValue:r}=n,o=yt(_t("site",i,r),e==="site"||e==="all"),a=yt(_t("page",i,r),e==="page"||e==="all"),d=t==="one-of-each"?1:void 0;return sr([...o.slice(0,d),...a.slice(0,d)]).filter(Boolean).map(dr).slice(0,er)}function sr(n){return n.sort((i,e)=>e.confidence-i.confidence)}function yt(n,i){return i?n.map(ar):n}function ar(n){return{...n,value:`${n.value}${tr(n.confidence)}`}}function dr(n){return n.value.substring(0,Jn)}function Oe(){const n=Object.keys(At).reduce((i,e)=>(i[e]=or(At[e]),i),{});return ir(n)}const lr=500;class di extends g{constructor(){super(...arguments);s(this,"name","FandomTaxonomyPlugin");s(this,"targetingApplied",!1);s(this,"hooks",{onAfterGptWrapperInit:e=>{this.waitForFandomTaxonomyPresent().then(()=>this.updateGpt(e))}});s(this,"api",{getIABPageCategories:()=>F("page"),getIABSiteCategories:()=>F("site"),getTargetingKeyValues:()=>Oe()})}getDebugState(){return{isTargetingApplied:this.targetingApplied,iabSiteCategories:F("site"),iabPageCategories:F("page"),taxonomyKeyValues:Oe()}}async waitForEvent(){return new Promise(e=>{const t=()=>e();window.addEventListener("FandomTaxonomyUpdated",()=>{window.removeEventListener("FandomTaxonomyUpdated",t),e()})})}async waitForFandomTaxonomyPresent(){if(!window.fandomTaxonomy)try{await q(Promise.any([ye(()=>!!window.fandomTaxonomy),this.waitForEvent()]),lr)}catch{h({message:"waitForFandomTaxonomyPresent timed out",priority:c.P2})}}updateGptConfig(e){e.setConfig({pps:{taxonomies:{IAB_CONTENT_2_2:{values:[...new Set([...F("site"),...F("page")])]}}}})}getIABKeyValues(){return{cattax:[si.toString()],cat:F("site"),pagecat:F("page")}}updateGptKVs(e){Object.entries({...this.getIABKeyValues(),...Oe()}).forEach(([t,r])=>{const o=e.getTargeting(t);o&&o.length>0&&(r=[...new Set([...o,...r])]),e.setTargeting(t,r)})}updateGpt(e){this.targetingApplied||(this.targetingApplied=!0,this.updateGptKVs(e),this.updateGptConfig(e))}}const li=.1,cr={buckets:[{max:3,increment:.01},{max:8,increment:.05},{max:20,increment:.5},{max:46,increment:1}]},ur={buckets:[{max:3,increment:.01},{max:8,increment:.05},{max:20,increment:.5}]},ue={data:{currency:"USD",default:li}},gr={cache:{url:"https://prebid.adnxs.com/pbc/v1/cache"},debug:!1,enableTIDs:!0,enableSendAllBids:!0,sendBidsControl:{bidLimit:2,dealPrioritization:!0},priceGranularity:"dense",mediaTypePriceGranularity:{banner:cr,video:ur},targetingControls:{alwaysIncludeDeals:!0,allowTargetingKeys:["AD_ID","BIDDER","PRICE_BUCKET","UUID","SIZE","DEAL","CACHE_HOST","SOURCE"],allowSendAllBidsTargetingKeys:["AD_ID","BIDDER","PRICE_BUCKET","UUID","SIZE","DEAL"]},timeoutBuffer:400,useBidCache:!0,bidCacheFilterFunction:n=>n.mediaType!=="video",userSync:{filterSettings:{iframe:{bidders:"*",filter:"include"},image:{bidders:"*",filter:"include"}},userIds:[],auctionDelay:50,syncsPerBidder:3,syncDelay:6e3},floors:ue,ozone:{enhancedAdserverTargeting:!1,oz_whitelist_adserver_keys:[]},rubicon:{singleRequest:!0}},hr={standard:{storageAllowed:!0,suppressEmptyKeys:!0,allowZeroCpmBids:!0}},fr={standard:{adserverTargeting:[{key:"hb_bidder",val:function(n){return n.bidderCode}},{key:"hb_adid",val:function(n){return n.adId}},{key:"hb_pb",val:function(n){return n.pbCg}},{key:"hb_size",val:function(n){return n.size}},{key:"hb_source",val:function(n){return n.source}},{key:"hb_format",val:function(n){return n.mediaType}},{key:"hb_deal",val:function(n){return n.dealId}}]}},pr={bidfloor:li,bidfloorcur:"USD"};class mr{constructor(i){s(this,"prebidReady",!1);s(this,"pbjs");this.prebidConfig=i,window.pbjs=window.pbjs??{},window.pbjs.que=window.pbjs.que??[],this.pbjs=window.pbjs,this.pbjs.que.push(()=>{this.pbjs.bidderSettings=tt(this.pbjs.bidderSettings,hr),this.pbjs.setConfig({...this.prebidConfig}),this.prebidReady=!0})}isPrebidReady(){return this.prebidReady}defineAdUnits(i){this.pbjs.que.push(()=>{this.pbjs.addAdUnits(i)})}requestBids(i){this.pbjs.que.push(()=>{this.pbjs.requestBids(i)})}setTargetingForGPTAsync(i,e){this.pbjs.que.push(()=>{var t,r;(r=(t=this.pbjs).setTargetingForGPTAsync)==null||r.call(t,i,e)})}pushToQueue(i){this.pbjs.que.push(()=>i(this.pbjs))}setConfig(i){this.pbjs.que.push(()=>{try{this.pbjs.setConfig(i)}catch(e){E({message:`Failed to set Prebid config: ${e}`,priority:c.P2})}})}}class C{constructor(...i){s(this,"configFlags");this.configFlags=i}isEnabled(i){return this.configFlags.length===0?!0:this.configFlags.every(e=>!!i[e])}transformAdUnitBidConfigs(i){return i}}class br extends C{transformAdUnitBidConfigs(i,e){for(const t of i)t.params.keywords={...e.pageTargeting};return i}}class Tr extends C{transformAdUnitBidConfigs(i,e){for(const t of i)t.params.customData=[{settings:{},targeting:{...e.pageTargeting}}];return i}}const Sr={appnexus:new br("icPrebidAppNexus"),gumgum:new C("icPrebidGumGum"),ix:new C("icPrebidIX"),kargo:new C("icPrebidKargo"),mgnipbs:new C("icPrebidMagniteS2s"),medianet:new C("icPrebidMedianet"),nobid:new C("icPrebidNobid"),openx:new C("icPrebidOpenX"),ozone:new Tr("icPrebidOzone"),pubmatic:new C("icPrebidPubmatic"),rubicon:new C("icPrebidRubicon"),seedtag:new C("icPrebidSeedtag"),triplelift:new C("icPrebidTriplelift"),ttd:new C("icPrebidTtd"),wikia:new C};function vt(){return G("pbjs_debug")}const Er=n=>{if(n.icPrebidSharedId)return{name:"pubCommonId",storage:{type:"cookie",name:"_pubcid",expires:365}}},Ar=n=>{if(!n.icPrebidId5)return;const i={name:"id5Id",params:{partner:1139},storage:{type:"html5",name:"id5id",expires:90,refreshInSeconds:8*3600}};return n.icPrebidId5ExternalModule&&Object.assign(i.params,{externalModuleUrl:"https://cdn.id5-sync.com/api/1.0/id5PrebidModule.js"}),i},_r=n=>n.icLiveIntentConnectedId?{name:"liveIntentId",params:{publisherId:"79968",requestedAttributesOverrides:{uid2:!0,bidswitch:!0,medianet:!0,magnite:!0,pubmatic:!0,index:!0,openx:!0,thetradedesk:!0,sovrn:!0},ajaxTimeout:1e3,liCollectConfig:{fpiStorageStrategy:"ls",fpiExpirationDays:730}},storage:{name:"__tamLIResolveResult",type:"html5",expires:1}}:void 0,yr={ignoreOptOut:!1,ignoreAllowedAds:!1,ignoreCoppa:!1},w=(n,i={})=>{var a;const{ignoreAllowedAds:e,ignoreCoppa:t,ignoreOptOut:r}={...yr,...i},o=(d,l)=>l?!0:!d;return!!(n&&n.ready&&o(n.optOut,r)&&o(!((a=n.allowed)!=null&&a.ads),e)&&o(n.coppa,t))},vr="https://b-code.liadm.com/a-07ev.min.js",Ir="0.3",Cr={unifiedId:"liveConnect-unifiedId",sha2:"liveConnect",md5:"liveConnect-md5",sha1:"liveConnect-sha1"},It="LiveConnectConsentInitialized",Fe="LiveConnectPluginReady",Me=n=>Cr[n];class ne extends g{constructor(e){super();s(this,"name","LiveConnectPlugin");s(this,"storage",null);s(this,"libraryLoaded",!1);s(this,"consent");s(this,"hooks",{onConsentUpdated:e=>{w(e)?(this.consent=!0,this.setupStorage()):this.consent=!1,window.dispatchEvent(new Event(It))}});s(this,"api",{waitForHems:async()=>(this.consent===void 0&&await this.waitFor(It),this.consent?(this.libraryLoaded||await this.waitFor(Fe),{sha2:this.getFromStorage("sha2"),sha1:this.getFromStorage("sha1"),md5:this.getFromStorage("md5")}):null),checkIfSha2HemAvailable:()=>ne.isEnabled(this.config)?this.isAvailableInStorage("sha2"):!1});this.config=e}getDebugState(){return{isScriptLoaded:this.libraryLoaded,isStorageInitialized:!!this.storage,isSha2HemAvailable:this.api.checkIfSha2HemAvailable()}}static isEnabled(e){return(e==null?void 0:e.icLiveConnect)&&(e==null?void 0:e.icLiveConnectCachingStrategy)&&!(e!=null&&e.icIdentityPartners)}setupStorage(){!this.consent||this.storage||(this.storage=new Qt(this.config.icLiveConnectCachingStrategy.type==="local"?()=>window.localStorage:()=>window.sessionStorage),this.shouldLoadScript()?(f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"live_connect_started",time:performance.now()}),H({src:vr,isAsyncOrDeferOtherwise:!0,node:"first"}).then(()=>{this.resolveAndTrackIds(),f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"live_connect_loaded",time:performance.now()})})):(f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"live_connect_cached",time:performance.now()}),this.libraryLoaded=!0,window.dispatchEvent(new Event(Fe))))}getHEMTypes(){return this.config.icLiveConnectCachingStrategy.mandatoryParams}shouldLoadScript(){return this.getHEMTypes().some(t=>!this.isAvailableInStorage(t))}resolveAndTrackIds(){var e,t,r;(r=window.liQ)==null||r.resolve(o=>{for(const[a,d]of Object.entries(o))a==="unifiedId"&&f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"live_connect_responded_uuid",time:performance.now()}),this.storeId(a,d);this.libraryLoaded=!0,window.dispatchEvent(new Event(Fe))},o=>{h({message:"Failed to resolve and track ids",priority:c.P4,error:o})},{qf:((t=(e=this.config)==null?void 0:e.icLiveConnectQf)==null?void 0:t.toString())??Ir,resolve:["sha2","md5","sha1","unifiedId"]})}storeId(e,t){var o;if(this.isAvailableInStorage(e))return;const r=Me(e);(o=this.storage)==null||o.setItem(r,t,this.config.icLiveConnectCachingStrategy.ttl),f(et.IDENTITY_INFO,{partnerName:r,partnerIdentityId:t})}isAvailableInStorage(e){var t;return!!((t=this.storage)!=null&&t.getItem(Me(e)))}getFromStorage(e){var t;return((t=this.storage)==null?void 0:t.getItem(Me(e)))??null}async waitFor(e){return new Promise(t=>{const r=()=>t();window.addEventListener(e,()=>{window.removeEventListener(e,r),t()})})}}function Pr(n){const i=n.match(/.{2}/g);if(!i)throw new Error("Invalid input string");return btoa(String.fromCharCode(...i.map(e=>parseInt(e,16))))}const Rr="VCaqxS6v2X",wr="UID2-X-P-MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEOE+DsIa2aJWHIYpG+JrLpe0uxwrGe9aC4NaP7lQMN9+9/pk/7vydOrzQvxeDSlThIiMwGRMpyjAa593RYoGtFA==",Nr=async(n,i)=>{if(n.icPrebidUID2)try{const e=i.usePlugin(ne);if(!e)return;const t=await e.waitForHems();if(t!=null&&t.sha2)return{name:"uid2",params:{serverPublicKey:wr,subscriptionId:Rr,emailHash:Pr(t.sha2)}}}catch{return}},Br=n=>{var i,e;if(n.icPrebidYahooConnectId)return{name:"connectId",params:{pixelId:"58833",puid:((e=(i=window.fandomContext)==null?void 0:i.tracking)==null?void 0:e.ppid)??"0"},storage:{type:"html5",name:"connectId",expires:15}}},ci="identityLink",kr=n=>{if(n.icPrebidLiveRampATS)return{name:ci,params:{pid:"2161",notUse3P:!1},storage:{type:"cookie",name:"idl_env",expires:15,refreshInSeconds:1800}}},Lr="924dbye",Dr=n=>{if(n.icPrebidUnifiedId)return{name:"unifiedId",params:{partner:Lr},storage:{type:"cookie",name:"pbjs_unifiedid",expires:30}}},Or=[Dr,Er,Ar,_r,Br,kr],Fr=(n,i)=>{var t;const e=Or.map(r=>r(i)).filter(r=>r!==void 0);return n.userSync??(n.userSync={}),(t=n.userSync).userIds??(t.userIds=[]),n.userSync.userIds.push(...e),n},Mr=[Nr],xr=(n,i,e)=>{Mr.forEach(t=>{t(n,i).then(r=>{if(!r)return;const o=e.getConfig("userSync");o.userIds??(o.userIds=[]),o.userIds.push(r),e.mergeConfig({userSync:o}),e.refreshUserIds({submoduleNames:[r.name]})})})},Ur=n=>{if(n.icPrebidLiveRampATSAnalytics)return{provider:"atsAnalytics",options:{pid:"2161"}}},Vr=[Ur],Wr=(n,i)=>{const e=Vr.map(t=>t(n)).filter(t=>t!==void 0);e.length&&i.enableAnalytics(e)};function zr(n){return n.banner!==void 0}function Gr(n){return n.video!==void 0}class v extends g{constructor(e){super();s(this,"name","PrebidPlugin");s(this,"adEngine");s(this,"prebidWrapper");s(this,"activeBidders",new Map);s(this,"hooks",{onBiddersInit:(e,t)=>{e.adRenderManager.isBiddingEnabled()&&(this.adEngine=e,t.push(this.waitForPrebidReady()))},onCreateBiddersRequests:(e,t,r,o)=>{r.adRenderManager.isBiddingEnabled()&&e.push(this.requestBids(t,o))},onInitPageTargeting:()=>{this.prebidWrapper.pushToQueue(e=>xr(this.config,this,e)),this.prebidWrapper.pushToQueue(e=>Wr(this.config,e))}});s(this,"api",{addPrebidReadyCallback:e=>{this.prebidWrapper.pushToQueue(e)},setConfig:e=>{this.prebidWrapper.setConfig(e)}});this.config=e,this.prebidWrapper=this.initPrebidWrapper(),this.initBidderAdapters()}getDebugState(){return{activeBidders:Array.from(this.activeBidders.keys()),isWrapperInitialized:!!this.prebidWrapper,isDebugEnabled:vt()}}async waitForPrebidReady(){const e=new Promise(t=>{this.api.addPrebidReadyCallback(()=>t())});await q(e,this.config.icPrebidInitTimeoutMS,"PrebidPlugin.waitForPrebidReady")}initPrebidWrapper(){const e=Fr({...gr,bidderTimeout:this.config.icAdEngineAuctionTimeoutMS,debug:vt()},this.config);return new mr(e)}initBidderAdapters(){for(const[e,t]of Object.entries(Sr))t.isEnabled(this.config)&&this.activeBidders.set(e,t)}generateAdUnitBids(e,t){const r=[];for(const[o,a]of Object.entries(e.bids)){const d=this.applyMonetizationTiersToBids(a);if(this.activeBidders.has(o)){const l=this.activeBidders.get(o),u=(l==null?void 0:l.transformAdUnitBidConfigs(d,t,this.config))??[];r.push(...u)}}return r}applyMonetizationTiersToBids(e){var o;const t=(o=this.adEngine)==null?void 0:o.monetizationTierEngine;if(!t)return h({message:"PrebidPlugin.applyMonetizationTiersToBids: MonetizationTierEngine is not available.",priority:c.P2}),e;const r=[];for(const a of e){if(!a.params)continue;const d=t.filterTieredParamsByCurrentTier(a.params);typeof d>"u"||r.push({...a,params:d})}return r}generateAdUnits(e){const t=[];for(const r of e.adNodes){const o=r.getBidderConfig("prebid");if(!o)continue;let a=[];o.bids&&(a=this.generateAdUnitBids(o,e));const d={...o,code:r.getSlotName(),bids:a,ortb2Imp:{...pr,...o.ortb2Imp??{}}};d.mediaTypes=this.transformAdUnitMediaTypes(r,d.mediaTypes??{}),t.push(d)}return t}transformAdUnitMediaTypes(e,t){const r=e.getBidderSizes();if(zr(t))pn(r)&&(t.banner={sizeConfig:this.transformBannerSizeConfig(r),...t.banner});else if(Gr(t)){const o=this.transformVideoSizeConfig(r,e.getSlotName());t.video={playerSize:o,w:o?o[0]:void 0,h:o?o[1]:void 0,...t.video}}return t}transformBannerSizeConfig(e){return e.map(([t,r])=>({minViewPort:t,sizes:r}))}transformVideoSizeConfig(e,t){var o,a;const r=(a=(o=e[0])==null?void 0:o[1])==null?void 0:a[0];if(Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number")return r;E({message:`PrebidPlugin.transformVideoSizeConfig: Invalid video size configuration for ad node ${t}. Using default size.`,priority:c.P3})}async requestBids(e,t){return T(this.prebidWrapper.isPrebidReady(),"PrebidPlugin.requestBids: Prebid.js is not ready"),new Promise(r=>{var d;const o=this.generateAdUnits(e);t("prebid",e,o);const a=((d=this.usePlugin(ot))==null?void 0:d.getOrtb2(e.pageTargeting))??{};this.prebidWrapper.requestBids({auctionId:e.auctionId,adUnits:o,ortb2:a,bidsBackHandler:()=>{this.prebidWrapper.setTargetingForGPTAsync(),r()}})})}}class ot extends g{constructor(){super(...arguments);s(this,"name","OpenRtbPlugin");s(this,"pageTargeting",{});s(this,"adEngine");s(this,"dsaSettings",{dsa:{dsarequired:1,pubrender:2,datatopub:2}});s(this,"orbt2SiteCategories",[]);s(this,"ortb2PageCategories",[]);s(this,"hooks",{onBiddersInit:e=>{this.adEngine=e;const t=this.usePlugin(v);t==null||t.addPrebidReadyCallback(r=>{this.pageTargeting={...e.gptWrapper.getAllTargeting()},this.extendPrebidConfig(r)})}});s(this,"api",{getOrtb2:(e={})=>{var r;const t=((r=this.adEngine)==null?void 0:r.gptWrapper.getAllTargeting())??{};return this.pageTargeting={...t,...e},this.getOrtb2()}})}getDebugState(){return{pageTargeting:{...this.pageTargeting},orbt2SiteCategories:[...this.orbt2SiteCategories],ortb2PageCategories:[...this.ortb2PageCategories]}}getKeywordsSet(e){return new Set([...e.gnre??[],...e.media??[],...e.theme??[],...e.tv??[]])}buildKeywords(){var t;const e=(t=window==null?void 0:window.fandomContext)==null?void 0:t.site;return e!=null&&e.tags?Array.from(this.getKeywordsSet(e.tags).values()).filter(Boolean).join(","):""}setOrtb2Categories(){const e=this.usePlugin(di);this.orbt2SiteCategories=(e==null?void 0:e.getIABSiteCategories())??[],this.ortb2PageCategories=(e==null?void 0:e.getIABPageCategories())??[]}getOrtb2(){this.setOrtb2Categories();const{pageName:e,pageId:t,lang:r,...o}=this.pageTargeting;return{site:{...o,cattax:si,cat:[...this.orbt2SiteCategories],pagecat:[...this.ortb2PageCategories],id:t==null?void 0:t.toString(),name:e,content:{language:r,context:5},keywords:this.buildKeywords(),domain:window.location.hostname},regs:{ext:{...this.dsaSettings}}}}extendPrebidConfig(e){e.mergeConfig({ortb2:this.getOrtb2()})}}function ui(n,i,e){var r;const t=(r=n.getResponseInformation)==null?void 0:r.call(n);if(t)return{advertiserId:t.advertiserId,creativeId:t.creativeId,lineItemId:t.lineItemId,orderId:t.campaignId,selectedSize:e,configuredSizes:ke(i.getSizes())}}function xe(n,i,e,t){const r=i.getSlotElementId(),o=e.getAdNodeByName(r);if(!o)return;const a={type:n,slotName:r,slotInfo:ui(i,o,t),rv:o.getRenderCount()};f(_e,a)}function Ct(n,i){f(_,{type:n,time:performance.now(),slotName:i})}const Hr=/[?&]prev_iu_szs=([^&#]*)/;function $r(n){if(!n)return"";const i=n.match(Hr);return i?decodeURIComponent(i[1]):""}function qr(n){var t;if(!n)return[];const i=((t=n.getContentUrl)==null?void 0:t.call(n))??"",e=$r(i);return e?e.split("|").filter(Boolean):[]}function jr(n,i,e,t){const r=i.getSlotElementId(),o=e.getAdNodeByName(r);if(!o)return;const a={type:n,slotName:r,slotInfo:{...Yr(i),selectedSize:Kr(t),configuredSizes:ke(o.getSizes()),parsedSizes:qr(i)}};f(Hi,a)}function Kr(n){if(n!==void 0)return n===null?null:Ie(n)}function Yr(n){var e;const i=(e=n.getResponseInformation)==null?void 0:e.call(n);return i?{advertiserId:i.advertiserId,creativeId:i.creativeId,lineItemId:i.lineItemId,orderId:i.campaignId}:{advertiserId:void 0,creativeId:void 0,lineItemId:void 0,orderId:void 0}}class gi extends g{constructor(e){super();s(this,"name","HeavyAdsDetectionPlugin");s(this,"detectedHeavyAds",[]);s(this,"onHeavyAdDetectedCallbacks",[]);s(this,"api",{getDetectedHeavyAds:()=>this.detectedHeavyAds.slice(),onHeavyAdDetected:e=>{this.onHeavyAdDetectedCallbacks.push(e)}});e.icInterventionTracking&&this.initializeHeavyAdDetection()}getDebugState(){return{detectedHeavyAds:this.detectedHeavyAds.slice()}}initializeHeavyAdDetection(){if(typeof ReportingObserver>"u"){E({message:"ReportingObserver not supported, heavy ads detection unavailable",priority:c.P4});return}window.addEventListener("message",this.handleMessageEvent.bind(this),{capture:!0,passive:!0})}handleMessageEvent(e){if(e.origin!==window.origin)return;const t=e.data;if(t&&t.libId==="@wikia/post-quecast"&&t.action&&t.action.id==="HeavyAdIntervention"){const r={slotName:t.action.slotName,reason:this.parseReasonFromMessage(t.action.message),timestamp:t.action.timestamp};this.detectedHeavyAds.push(r),this.onHeavyAdDetectedCallbacks.forEach(o=>o(r)),E({message:`HeavyAdsDetectionPlugin detected heavy ad for slot ${r.slotName} (${r.reason})`,priority:c.P3})}}parseReasonFromMessage(e){return e.includes("CPU usage")?"cpu":e.includes("network")?"network":"unknown"}}class Qr{constructor(i,e){s(this,"listener",this.detectClickOnIframe.bind(this));this.slotName=i,this.callbackOnDetection=e}init(){window.addEventListener("blur",this.listener)}detectClickOnIframe(){const i=document.activeElement;(i==null?void 0:i.closest(`div#${CSS.escape(this.slotName)}`))!==null&&(this.callbackOnDetection(),this.clearDetection())}clearDetection(){setTimeout(()=>{document.activeElement.blur()},100)}detach(){window.removeEventListener("blur",this.listener)}}function hi(n,i,e,t){return{slotName:n.adUnitCode,baseSlotName:(e==null?void 0:e.getBaseSlotName())??n.adUnitCode,rv:(e==null?void 0:e.getRenderCount())??void 0,bidInfo:{status:i,bidderName:n.bidderCode,size:`${n.width}x${n.height}`,price:`${n.cpm}`,timeToRespond:n.timeToRespond,auctionId:n.auctionId,rejectionReason:n.rejectionReason,fullAuction:t}}}function st(n,i,e,t){return{slotName:n.adUnitCode,baseSlotName:(e==null?void 0:e.getBaseSlotName())??n.adUnitCode,rv:(e==null?void 0:e.getRenderCount())??void 0,bidInfo:{status:i,bidderName:n.bidder,auctionId:n.auctionId,size:void 0,price:void 0,timeToRespond:void 0,rejectionReason:void 0,fullAuction:t}}}function Xr(n,i,e,t){if(!t)return;const r=hi(n,"on_time",i,e);f(U.BIDDER_RESPONSE,r)}function Zr(n,i,e,t){if(!t)return;const r=hi(n,"rejected",i,e);f(U.BIDDER_RESPONSE,r)}function Jr(n,i,e,t){if(!t)return;const r=st(n,"unknown",i,e);f(U.BIDDER_RESPONSE,r)}function eo(n,i,e,t){if(!t)return;const r=st(n,"timedout",i,e);f(U.BIDDER_RESPONSE,r)}function to(n,i,e,t){if(!t)return;const r=st(n,"declined",i,e);f(U.BIDDER_RESPONSE,r)}function re(n,i){if(!i)return;const e={slotName:"error",baseSlotName:"error",rv:void 0,bidInfo:{status:"error",bidderName:"error",auctionId:void 0,size:void 0,price:void 0,timeToRespond:void 0,rejectionReason:void 0,fullAuction:n}};f(U.BIDDER_RESPONSE,e)}const io={auctionEndWait:100,percentFullAuctions:.01,percentSampleTarget:.1};class no{constructor(i,e,t=io){s(this,"fullAuction");s(this,"sampleRate");s(this,"pendingAuctions",{});this.pbjs=i,this.adNodeManager=e,this.config=t,this.validateSampling(t.percentFullAuctions,t.percentSampleTarget),this.fullAuction=Math.random()<t.percentFullAuctions,G("force_tracking")&&(this.fullAuction=!0),this.fullAuction?this.sampleRate=1:this.sampleRate=(t.percentSampleTarget-t.percentFullAuctions)/(1-t.percentFullAuctions),this.monitorAuctionInit(),this.monitorTimedOutRequests(),this.monitorAuctionEnd()}validateSampling(i,e){if(i>e)throw Error("percentFullAuctions must be less than the percentSampleTarget");if(e>1||e<0)throw Error("percentSampleTarget must be between 0 and 1");if(i>1||i<0)throw Error("percentFullAuctions must be between 0 and 1")}bidIsSampled(){return Math.random()<this.sampleRate}monitorAuctionInit(){this.pbjs.onEvent("auctionInit",i=>{const e={bidState:{}};i.bidderRequests.forEach(t=>{try{t.bids.forEach(r=>{e.bidState[j(r)]="requested"})}catch{h({message:`Error tracking initial auctionInit state for bidRequest: ${JSON.stringify(t)}`,priority:c.P4})}}),this.pendingAuctions[i.auctionId]=e})}monitorAuctionEnd(){this.pbjs.onEvent("auctionEnd",i=>{this.recordBidsReceived(i),this.recordBidsRejected(i),setTimeout(()=>{this.recordNoBids(i),this.recordUnknownBids(i),delete this.pendingAuctions[i.auctionId]},this.config.auctionEndWait)})}monitorTimedOutRequests(){this.pbjs.onEvent("bidTimeout",i=>{i.forEach(e=>{try{const t=this.pendingAuctions[e.auctionId],r=this.adNodeManager.getAdNodeByName(e.adUnitCode);t.bidState[j(e)]="timedout",eo(e,r,this.fullAuction,this.bidIsSampled())}catch{h({message:"Error recording bidTimeout",priority:c.P4,data:e}),re(this.fullAuction,this.bidIsSampled())}})})}recordBidsReceived(i){const e=this.pendingAuctions[i.auctionId];i.bidsReceived.forEach(t=>{try{const r=this.adNodeManager.getAdNodeByName(t.adUnitCode);e.bidState[j(t)]="on_time",Xr(t,r,this.fullAuction,this.bidIsSampled())}catch(r){h({message:"Error recording bidReceived",priority:c.P4,error:r,data:t}),re(this.fullAuction,this.bidIsSampled())}})}recordBidsRejected(i){const e=this.pendingAuctions[i.auctionId];i.bidsRejected.forEach(t=>{try{e.bidState[j(t)]="rejected";const r=this.adNodeManager.getAdNodeByName(t.adUnitCode);Zr(t,r,this.fullAuction,this.bidIsSampled())}catch{h({message:"Error recording bidRejected",priority:c.P4,data:t}),re(this.fullAuction,this.bidIsSampled())}})}recordNoBids(i){const e=this.pendingAuctions[i.auctionId];i.noBids.forEach(t=>{try{const r=j(t);if(e.bidState[r]!="timedout"){e.bidState[r]="declined";const o=this.adNodeManager.getAdNodeByName(t.adUnitCode);to(t,o,this.fullAuction,this.bidIsSampled())}}catch{h({message:"Error recording no_bid",priority:c.P4,data:t}),re(this.fullAuction,this.bidIsSampled())}})}recordUnknownBids(i){try{const e=i.bidderRequests.flatMap(r=>r.bids),t=this.pendingAuctions[i.auctionId];for(const[r,o]of Object.entries(t.bidState))if(o==="requested"){const a=e.find(d=>j(d)===r);if(a){const d=this.adNodeManager.getAdNodeByName(a.adUnitCode);Jr(a,d,this.fullAuction,this.bidIsSampled())}else h({message:"Could not find bid data to report",priority:c.P4}),re(this.fullAuction,this.bidIsSampled())}}catch{h({message:"Error recording unknown bids",priority:c.P4})}}}function j(n){return`${n.bidder}-${n.transactionId}`}function ro(n){return"timedOut"in n&&n.timedOut}class oo{constructor(){s(this,"A9_BIDDER_NAME","a9")}trackBidResponse(i,e,t,r){e.forEach(o=>{if(ro(o)){const d=this.buildTimedOutBidInfo(i,r,t);this.sendBidInfo(d,o,i);return}if(o.size=="0x0"){const d=this.buildDeclinedBidInfo(i,r,t);this.sendBidInfo(d,o,i);return}const a=this.buildOnTimeBidInfo(i,r,o,t);this.sendBidInfo(a,o,i)})}buildTimedOutBidInfo(i,e,t){return{status:"timedout",bidderName:this.A9_BIDDER_NAME,size:void 0,price:void 0,timeToRespond:Math.round(t),timedOut:!0,auctionId:i.auctionId,fullAuction:e}}buildDeclinedBidInfo(i,e,t){return{status:"declined",bidderName:this.A9_BIDDER_NAME,size:void 0,price:void 0,timeToRespond:Math.round(t),timedOut:!1,auctionId:i.auctionId,fullAuction:e}}buildOnTimeBidInfo(i,e,t,r){return{status:"on_time",bidderName:this.A9_BIDDER_NAME,size:t.size,price:t.targeting.amznbid,timeToRespond:Math.round(r),timedOut:!1,auctionId:i.auctionId,fullAuction:e}}sendBidInfo(i,e,t){const r=e.slotID;let o=0,a=r;const d=t.adNodes.find(u=>u.getSlotName()===r);d&&(o=d.getRenderCount(),a=d.getBaseSlotName());const l={slotName:r,baseSlotName:a,rv:o,bidInfo:i};f(U.BIDDER_RESPONSE,l)}}class fi extends g{constructor(){super(...arguments);s(this,"name","TrackingPlugin");s(this,"auctionTracker");s(this,"a9AuctionTracker");s(this,"SLOTS_ELIGIBLE_TO_LOADING_TIME_TRACK",["top_leaderboard","top_boxad","floor_adhesion","interstitial"]);s(this,"clickTrackingSlotMap",new Map);s(this,"slotsAlreadyTrackedForLoadTime",{requested:new Map,rendered:new Map});s(this,"hooks",{onInitPageTargeting:()=>{f(_,{type:S.AE_INIT,time:performance.now()})},onAdEngineInit:e=>{document.addEventListener("visibilitychange",this.onPageVisibilityChange.bind(this,e)),this.onPageVisibilityChange(e)},onBiddersInit:e=>{var t;(t=this.usePlugin(v))==null||t.addPrebidReadyCallback(r=>{this.auctionTracker=new no(r,e.adNodeManager),this.a9AuctionTracker=new oo})},onBeforeFirstCallAdsRequest:(e,t)=>{var r;return this.onGptSlotRequested(e,t),this.onGptSlotRendered(e,t),this.onGptResponseReceived(e,t),(r=this.usePlugin(gi))==null||r.onHeavyAdDetected(o=>{this.onHeavyAdDetected(e,t,o)}),e},onFirstRenderCycleComplete(){me().cmd.push(e=>e.issueManager.triggerPageStatus({trigger:"first_render_cycle"}))},onBeforeAdsRequest:()=>{if(G("temp_force_error"))throw Error("Fake Error onBeforeAdsRequest")},onAdEngineReset:()=>{this.slotsAlreadyTrackedForLoadTime.requested.clear(),this.slotsAlreadyTrackedForLoadTime.rendered.clear();for(const e of this.clickTrackingSlotMap.values())e.detach();this.clickTrackingSlotMap.clear()}});s(this,"api",{trackA9BidResponse:(e,t,r)=>{var a;const o=t.filter(()=>this.auctionTracker.bidIsSampled());(a=this.a9AuctionTracker)==null||a.trackBidResponse(e,o,r,this.auctionTracker.fullAuction)}})}getDebugState(){return{isAuctionTrackerInitialized:!!this.auctionTracker,isA9AuctionTrackerInitialized:!!this.a9AuctionTracker,clickTrackingSlotNames:Array.from(this.clickTrackingSlotMap.keys()),slotsTrackedForLoadTimeRequested:Array.from(this.slotsAlreadyTrackedForLoadTime.requested.keys()),slotsTrackedForLoadTimeRendered:Array.from(this.slotsAlreadyTrackedForLoadTime.rendered.keys())}}isSlotEligibleToLoadingTimeTrack(e){return this.SLOTS_ELIGIBLE_TO_LOADING_TIME_TRACK.includes(e)}onGptSlotRequested(e,t){e.addEventListener("slotRequested",r=>{const o=r.slot,a=o.getSlotElementId();xe(W.SLOT_REQUESTED_INFO,o,t),this.isSlotEligibleToLoadingTimeTrack(a)&&(this.slotsAlreadyTrackedForLoadTime.requested.has(a)||(Ct(S.SLOT_REQUESTED,a),this.slotsAlreadyTrackedForLoadTime.requested.set(a,!0)))})}onGptSlotRendered(e,t){e.addEventListener("slotRenderEnded",r=>{if(r.isEmpty)return;const o=r.slot,a=o.getSlotElementId(),d=t.getAdNodeByName(a);d&&(xe(W.SLOT_RENDERED_INFO,o,t,Ie(r.size??"")),jr(Ht.SLOT_SIZE_ESTABLISHED,o,t,r.size),this.attachClickTracking(a,d),this.isSlotEligibleToLoadingTimeTrack(a)&&(this.slotsAlreadyTrackedForLoadTime.rendered.has(a)||(Ct(S.SLOT_RENDERED,a),this.slotsAlreadyTrackedForLoadTime.rendered.set(a,!0))))})}onGptResponseReceived(e,t){e.addEventListener("slotResponseReceived",r=>{const o=r.slot;xe(W.SLOT_CODE_SERVED_INFO,o,t)})}onPageVisibilityChange(e){e.gptWrapper.setTargeting("is_bg",document.hidden?$:ce)}attachClickTracking(e,t){if(this.clickTrackingSlotMap.has(e))return;const r=()=>{const a=t.getRenderCount(),d={type:W.SLOT_CLICKED,slotName:e,rv:a};f(_e,d)},o=new Qr(e,r);o.init(),this.clickTrackingSlotMap.set(e,o)}onHeavyAdDetected(e,t,r){const o=r.slotName,a=t.getAdNodeByName(o);if(!a){E({message:`HeavyAdsDetectionPlugin detected heavy ad for unknown slot ${o}`,priority:c.P2});return}const d=e.getSlotById(o);if(!d){E({message:`HeavyAdsDetectionPlugin detected heavy ad for slot ${o}, but GPT has no record of that slot`,priority:c.P2});return}f(_e,{type:W.SLOT_HEAVY_AD_INTERVENTION,slotName:o,rv:a.getRenderCount(),reason:r.reason,slotInfo:ui(d,a)})}}const so="b8f84ec5-52e5-45d5-a863-6181aea3a67b",ao="3115";class lo extends g{constructor(e){super();s(this,"name","A9Plugin");s(this,"wrapper");s(this,"errorOnInit");s(this,"consentData");s(this,"adEngine");s(this,"hooks",{onConsentUpdated:e=>{this.consentData=e,this.wrapper?this.wrapper.handleConsentChange(e):this.initWrapper()},onAdEngineInit:e=>{e.adRenderManager.isBiddingEnabled()&&(this.adEngine=e,this.initWrapper())},onCreateBiddersRequests:(e,t,r,o)=>{r.adRenderManager.isBiddingEnabled()&&e.push(q(this.executeBidRequest(t,o),this.config.icAdEngineAuctionTimeoutMS,`A9 bid request timed out for auction ${t.auctionId}`).catch(a=>{if(a.message.includes("request timed out")){E({message:a.message,priority:c.P3,error:a,data:t});return}throw a}))}});this.config=e}static isEnabled(e){return!!e.icA9Bidder}getDebugState(){return{isWrapperInitialized:!!this.wrapper,initErrorMessage:this.errorOnInit??null,resolvedPubId:this.adEngine?this.resolvePubID(this.adEngine):null}}trackBidResponse(e,t,r){var o;try{(o=this.usePlugin(fi))==null||o.trackA9BidResponse(e,t,r)}catch(a){h({message:"Error tracking A9 bids",priority:c.P3,error:a})}}resolvePubID(e){const{monetizationTierEngine:t}=e;return t.isPartiallyMonetized()?so:t.isFullyMonetized()?ao:null}async executeBidRequest(e,t){T(this.wrapper,"A9Wrapper has not been initialized");const r=`${P.AE_AUCTION_START_A9_START}_${e.auctionId}`;performance.mark(r),this.wrapper.updateApstagOrtb2Signals(this.getOrtb2Object());const o=await this.wrapper.requestBids(e,t),{duration:a}=performance.measure(qt.AE_AUCTION_DURATION_A9_BID_TOTAL_TIME,r);this.trackBidResponse(e,o,a)}initWrapper(){if(!this.consentData||!this.adEngine||!this.isConsentGranted(this.consentData)||this.wrapper||this.errorOnInit)return;const e=this.resolvePubID(this.adEngine);if(!e){const t="A9Wrapper initialization failed: pubID could not be resolved";h({message:t,priority:c.P2}),this.errorOnInit=t;return}this.wrapper??(this.wrapper=new jn(this.consentData,this.config.icAdEngineAuctionTimeoutMS,this.config,e,this.getOrtb2Object())),this.errorOnInit=void 0}getOrtb2Object(e){var t;return(t=this.usePlugin(ot))==null?void 0:t.getOrtb2(e)}isConsentGranted(e){return w(e,{ignoreOptOut:!0})}}class co extends g{constructor(e){super();s(this,"name","ConsentManagementPrebidPlugin");s(this,"isTcfAvailable",!1);s(this,"isUspAvailable",!1);s(this,"hooks",{onConsentUpdated:({coppa:e,consentApi:t})=>{var r;this.isTcfAvailable=t==="tcf",this.isUspAvailable=t==="usp",(r=this.usePlugin(v))==null||r.addPrebidReadyCallback(o=>{o.mergeConfig({coppa:e})})},onBiddersInit:()=>{var e;(e=this.usePlugin(v))==null||e.addPrebidReadyCallback(t=>{this.isTcfAvailable&&t.mergeConfig({consentManagement:{gdpr:{cmpApi:"iab",timeout:this.config.icPrebidConsentManagementTimeoutMS,defaultGdprScope:!0}}}),this.isUspAvailable&&t.mergeConfig({consentManagement:{usp:{cmpApi:"iab",timeout:this.config.icPrebidConsentManagementTimeoutMS}}})})}});this.config=e}getDebugState(){return{isTcfAvailable:this.isTcfAvailable,isUspAvailable:this.isUspAvailable}}}class pi{constructor(i){s(this,"iconSvg",'<svg width="9" height="9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22C6.48605 22 2.00005 17.514 2.00005 12C2.00005 6.486 6.48605 2 12 2C17.514 2 22 6.486 22 12C22 17.514 17.514 22 12 22M12 0C5.383 0 0 5.383 0 12C0 18.617 5.383 24 12 24C18.617 24 24 18.617 24 12C24 5.383 18.617 0 12 0" clip-rule="evenodd"/><path d="M10.9998 18.0171V10.0096C10.9998 9.4556 11.4467 9.00777 11.9997 9.00777 12.5527 9.00777 12.9997 9.4556 12.9997 10.0096V18.0171C12.9997 18.5711 12.5527 19.0189 11.9997 19.0189 11.4467 19.0189 10.9998 18.5711 10.9998 18.0171zM12.0057 7.01379C11.4527 7.01379 10.9998 6.55995 10.9998 6.00693 10.9998 5.4539 11.4527 5.00006 12.0057 5.00006 12.5587 5.00006 13.0107 5.4539 13.0107 6.00693 13.0107 6.55995 12.5587 7.01379 12.0057 7.01379" clip-rule="evenodd"/></svg>');this.props=i}render(){const e=new DOMParser().parseFromString(this.iconSvg,"image/svg+xml").documentElement,t=()=>{document.querySelectorAll(".dsa-dialog").forEach(a=>{document.body.removeChild(a)})},r=async()=>{const{AdvertisementInfoDialog:o}=await B(async()=>{const{AdvertisementInfoDialog:d}=await import("./AdvertisementInfoDialog-ftkjtV7l.js");return{AdvertisementInfoDialog:d}},[]);t();const a=new o(this.props).render();document.body.appendChild(a),a.showModal()};return jsxRenderer("span",{className:"dsa-advertisement-label-icon",onClick:r},e)}}class Pt{constructor(i){s(this,"translatedAdLabel",document.querySelector(".ae-translatable-label"));this.props=i}render(){const{behalf:i,paid:e}=this.props,t=new pi({behalf:i,paid:e}).render();return jsxRenderer("div",{className:"ae-translatable-label advertisement-label",id:"label-"+this.props.slot},jsxRenderer("span",{className:"dsa-advertisement-label-clickable"},this.translatedAdLabel?this.translatedAdLabel.innerText:"Advertisement ",t))}}class uo extends g{constructor(){super(...arguments);s(this,"name","DigitalServicesActPlugin");s(this,"adUnitsWithoutDynamicLabel",["interstitial","floor_adhesion"]);s(this,"defaultDSAPrebidSettings",{dsarequired:1,pubrender:2,datatopub:2});s(this,"hooks",{onBiddersInit:()=>{const e=this.usePlugin(v);T(e,"PrebidPlugin not found"),e.addPrebidReadyCallback(t=>{this.extendPrebidConfig(t),this.attachPrebidEventsHandlers(t)})}})}extendPrebidConfig(e){e.mergeConfig({ortb2:{regs:{ext:{dsa:{...this.defaultDSAPrebidSettings}}}}})}getBidMeta(e){return e.meta??{}}getDSAMeta(e){return this.getBidMeta(e).dsa??null}isDSADataAvailable(e){var t,r;return typeof((t=this.getDSAMeta(e))==null?void 0:t.behalf)=="string"&&typeof((r=this.getDSAMeta(e))==null?void 0:r.adrender)=="number"}handleRegularAdUnit(e){var a;const{behalf:t,paid:r}=this.getDSAMeta(e),o=new Pt({slot:e.adUnitCode,behalf:t,paid:r}).render();(a=document.getElementById(e.adUnitCode))==null||a.appendChild(o)}handleTopLeaderboard(e){var d;const t=document.querySelector(".top-ads-container .ae-translatable-label"),{behalf:r,paid:o}=this.getDSAMeta(e),a=new pi({behalf:r,paid:o}).render();t.classList.add("advertisement-label","dsa-advertisement-label-clickable"),(d=t.querySelector(".dsa-advertisement-label-icon"))==null||d.remove(),t.appendChild(a)}handleIncontentSlots(e,t){const r=this.getRealSlotName(t);if(!r)return;const o=document.getElementById(r);if(!o)return;const{behalf:a,paid:d}=this.getDSAMeta(e),l=new Pt({slot:e.adUnitCode,behalf:a,paid:d}).render();o.appendChild(l)}attachPrebidEventsHandlers(e){const t=({bid:r,doc:o})=>{if(!(!this.isDSADataAvailable(r)||this.adUnitsWithoutDynamicLabel.includes(r.adUnitCode)))switch(r.adUnitCode){case"top_leaderboard":this.handleTopLeaderboard(r);break;case"incontent_leaderboard":case"incontent_boxad":this.handleIncontentSlots(r,o);break;default:this.handleRegularAdUnit(r)}};e.onEvent("adRenderSucceeded",t)}getRealSlotName(e){var t,r,o,a;return(a=(o=(r=(t=e==null?void 0:e.defaultView)==null?void 0:t.frameElement)==null?void 0:r.parentElement)==null?void 0:o.parentElement)==null?void 0:a.id}}const go=(n,...i)=>n.reduce((t,r,o)=>{const a=i[o]||"";return t+r+a},"").replace(/\s+/g," ").trim(),mi=document.createElement("style");document.head.appendChild(mi);const Rt=mi.sheet,ho=n=>typeof(n==null?void 0:n.dynamic)=="object"&&!!n.dynamic.single,fo=n=>typeof(n==null?void 0:n.dynamic)=="object"&&!!n.dynamic.outOfPage;class po extends g{constructor(){super(...arguments);s(this,"name","DynamicSlotPlugin");s(this,"requestedSlots",[]);s(this,"missingAnchors",[]);s(this,"hooks",{onAfterAdNodeManagerInit:(e,t)=>{for(const r of Object.values(t))try{ho(r)&&this.handleDynamicSingleSlot(r),fo(r)&&this.handleDynamicOutOfPageSlot(r)}catch(o){h({priority:c.P3,error:o,message:`Dynamic slot "${r.name}" failed to render`})}}})}getDebugState(){return{requestedSlots:[...this.requestedSlots],missingAnchors:this.missingAnchors.map(e=>({...e}))}}renderWrapper(e,t){const r=document.createElement("div");return r.id=e,r.classList.add(y.WRAPPER_CLASS),t&&Rt&&Rt.insertRule(go`
        #${e} {
          ${t}
        }
      `),r}handleDynamicSingleSlot(e){const t=e.dynamic.single,r=document.querySelector(t.selector);if(!r){h({message:`Dynamic slot anchor element with selector "${t.selector}" not found`,priority:c.P2}),this.missingAnchors.push({slotName:e.name,selector:t.selector});return}this.renderDynamicSlot(r,e.name,t),this.requestedSlots.push(e.name)}handleDynamicOutOfPageSlot(e){const t=document.createElement(y.ELEMENT_NAME);t.id=e.name,document.body.append(t)}renderDynamicSlot(e,t,r){var a;const o=document.createElement(y.ELEMENT_NAME);if(o.id=t,(a=r.wrapper)!=null&&a.id){const d=this.renderWrapper(r.wrapper.id,r.wrapper.css);d.appendChild(o),e[r.insertMethod](d);return}e[r.insertMethod](o)}}const mo='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.707 4.293a.999.999 0 0 0-1.414 0L12 10.586 5.707 4.293a.999.999 0 1 0-1.414 1.414L10.586 12l-6.293 6.293a.999.999 0 1 0 1.414 1.414L12 13.414l6.293 6.293a.997.997 0 0 0 1.414 0 .999.999 0 0 0 0-1.414L13.414 12l6.293-6.293a.999.999 0 0 0 0-1.414" fill-rule="evenodd"/></svg>';function bo(n){const i=new DOMParser,e=document.createElement("button"),t=["button-control","button-close","floor-adhesion-close-button"],r=i.parseFromString(mo,"image/svg+xml").documentElement;return e.appendChild(r),e.classList.add(...t),e.addEventListener("click",n),e}class je{constructor(i=0){s(this,"observers",new Map);s(this,"history",[]);this.historySize=i}subscribe(i){const e=Symbol();return this.observers.set(e,i),this.historySize>0&&this.history.forEach(t=>i(t)),()=>{this.observers.delete(e)}}notify(i){this.historySize>0&&(this.history.push(i),this.history.length>this.historySize&&this.history.shift()),this.observers.forEach(e=>e(i))}}function te(){var n;return((n=window.fandomHost)==null?void 0:n.device)==="smartphone"}const Q={DESKTOP_COLLAPSE:[9,9],DESKTOP_SUCCESS:[11,11],MOBILE_COLLAPSE:[6,6],MOBILE_SUCCESS:[8,8]};function wt(n,i,e){const t=Sn(n.getSizes(),i);n.setSizes(t),n.removeSizes(e)}function To(n){te()?wt(n,Q.MOBILE_SUCCESS,Q.MOBILE_COLLAPSE):wt(n,Q.DESKTOP_SUCCESS,Q.DESKTOP_COLLAPSE)}function Nt(n){return n===Q.MOBILE_SUCCESS[1]||n===Q.DESKTOP_SUCCESS[1]}const Ue=50;class bi extends g{constructor(){super(...arguments);s(this,"name","FloorAdhesionPlugin");s(this,"floorAdhesionSlotName","floor_adhesion");s(this,"containerRendered",!1);s(this,"adEngine");s(this,"adNodeManager");s(this,"closeButtonElement");s(this,"collapseEventSubscriber",new je(1));s(this,"closeButtonOnClickEventSubscriber",new je(1));s(this,"observer");s(this,"isTentpole",!1);s(this,"hooks",{onAfterAdNodeManagerInit:e=>{this.adNodeManager=e},onAdEngineInit:e=>{this.adEngine=e,this.addSlotRenderEndedFloorAdhesionListener(e)},onAdEngineReset:()=>{var r,o;this.containerRendered=!1,this.isTentpole=!1,this.removeCloseButton(),this.observer&&(this.observer.disconnect(),this.observer=void 0);let e=(r=this.adNodeManager)==null?void 0:r.getAdNodeByName(this.floorAdhesionSlotName);const t=!e;if(e??(e=(o=this.adNodeManager)==null?void 0:o.createAdNode(this.floorAdhesionSlotName)),e){const a=this.getFloorAdhesionWrapper(e);t&&a.style.display==="none"&&(a.style.display="")}}});s(this,"api",{activateTentpole:()=>{this.isTentpole=!0},block:()=>{try{T(this.adNodeManager,"adNodeManager is not defined"),this.adNodeManager.blockSlot(this.floorAdhesionSlotName)}catch(e){h({message:"Could not block the slot",priority:c.P3,error:e})}},unblock:async()=>{var o;const{adNodeManager:e,gptWrapper:t}=this.adEngine??{};this.isTentpole&&t&&(t.setTargeting("uap","none"),t.setTargeting("uap_c","none"));const r=e==null?void 0:e.getAdNodeByName(this.floorAdhesionSlotName);r?(r.unblock(),this.expand(r),To(r),await((o=this.adEngine)==null?void 0:o.adRenderManager.requestRender([r]))):E({message:`[FloorAdhesionPlugin] Could not find AdNode for ${this.floorAdhesionSlotName} to unblock.`,priority:c.P4})},onCollapse:e=>this.collapseEventSubscriber.subscribe(e),onClose:e=>this.closeButtonOnClickEventSubscriber.subscribe(e)})}getDebugState(){return{isContainerRendered:this.containerRendered,isTentpole:this.isTentpole,hasCloseButton:!!this.closeButtonElement,hasActiveObserver:!!this.observer}}startObservingSizeChanges(e,t){const r=t.getElement();r&&(this.observer=new ResizeObserver(o=>{o.forEach(a=>{if(a.target!==r)return;const d=a.contentRect.height;this.render(e,t,d)})}),this.observer.observe(r))}getWrapperId(e){var t,r,o;return(o=(r=(t=e==null?void 0:e.getSlotConfig().dynamic)==null?void 0:t.single)==null?void 0:r.wrapper)==null?void 0:o.id}getFloorAdhesionWrapper(e){const t=this.getWrapperId(e);T(t,"floorAdhesionWrapperId is not defined");const r=document.getElementById(t);return T(r,"floorAdhesionWrapper is not defined"),r}createAndAppendCloseButton(e,t){this.closeButtonElement=bo(()=>{e.style.display="none";const r=t.getRenderCount();this.adNodeManager.removeAdNode(t),f(_e,{type:W.SLOT_FORCE_CLOSE_INFO,slotName:this.floorAdhesionSlotName,rv:r||void 0}),this.closeButtonOnClickEventSubscriber.notify()}),e.appendChild(this.closeButtonElement)}removeCloseButton(){this.closeButtonElement&&(this.closeButtonElement.remove(),this.closeButtonElement=void 0)}isFirstRenderOfBigAd(e){return!this.containerRendered&&e>Ue}isRefreshToSmallerAd(e){return this.containerRendered&&e<=Ue&&!Nt(e)}isRefreshToBiggerAd(e){return this.containerRendered&&(e>Ue||Nt(e))&&!this.closeButtonElement}render(e,t,r){this.containerRendered||e.classList.add("add-background"),this.isFirstRenderOfBigAd(r)?this.createAndAppendCloseButton(e,t):this.isRefreshToSmallerAd(r)?this.removeCloseButton():this.isRefreshToBiggerAd(r)&&this.createAndAppendCloseButton(e,t),this.containerRendered=!0}collapse(e){const t=e.getElement(),r=this.getFloorAdhesionWrapper(e);r.style.display="none",t&&(t.style.height="0px"),this.containerRendered=!1,this.collapseEventSubscriber.notify(),this.observer&&(this.observer.disconnect(),this.observer=void 0)}expand(e){const t=this.getFloorAdhesionWrapper(e);t.style.display=""}addSlotRenderEndedFloorAdhesionListener(e){e.gptWrapper.addSlotEventListener(this.floorAdhesionSlotName,"slotRenderEnded",t=>{var o;const r=(o=this.adNodeManager)==null?void 0:o.getAdNodeByName(this.floorAdhesionSlotName);if(r){if(t.isEmpty){this.collapse(r);return}this.observer||this.startObservingSizeChanges(this.getFloorAdhesionWrapper(r),r)}})}}const So=".mw-parser-output > h2";function ie(n){var e;return!!((Ao(n)??{}).hasFeaturedVideo&&((e=window.canPlayVideo)!=null&&e.call(window)))}function Ke(n){return!ie(n)&&!!document.querySelector(So)}function Eo(){var n,i,e;return((i=(n=window.mw)==null?void 0:n.config)==null?void 0:i.get("wgArticleFeaturedVideo"))??((e=window.RLCONF)==null?void 0:e.wgArticleFeaturedVideo)??null}function Ao(n){var i;return n??((i=window.ads)==null?void 0:i.context.targeting)}const _o=/^(?<prefix>sse-)(?<experimentString>.+)$/;function Ti(){const n=document.documentElement.classList;for(const i of n){const e=i.toLowerCase().match(_o);if(e&&e.groups)return e.groups.experimentString}}function yo(){const n=Ti();if(n){const i=Si(n);if(i)return i}}const vo=/^(?<team>[a-zA-Z]+)-(?<ticketId>[0-9]+)-(?<mode>variant|control)-?(?<variant>[1-6])?$/;function Si(n){const i=n.toLowerCase().match(vo);if(i&&i.groups){let e=`${i.groups.mode}`;return i.groups.variant&&(e=`${e}${i.groups.variant}`),{name:`${i.groups.team}-${i.groups.ticketId}`,group:e}}}function Io(){var n,i;return((i=(n=window.fandomHost)==null?void 0:n.browser)==null?void 0:i.split(" ")[0])??""}function X(n=window.fandomContext??null){var i;return((i=n==null?void 0:n.user)==null?void 0:i.userState)??rt}class Co extends g{constructor(e){super();s(this,"name","PageLevelTargetingPlugin");s(this,"adEngine");s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e},onInitPageTargeting:e=>{const t=this.buildInitialPageTargeting();Object.assign(e,t)},onBiddersInit:e=>{this.setTargeting(e.gptWrapper),tn().then(()=>this.setTargeting(e.gptWrapper))},onBeforeFirstCallAdsRequest:e=>{const{ppid:t}=this.getTargetingFromFandomContextTracking();t&&e.updatePublisherProvidedId(t)},onAdEngineReset:()=>{const e=this.buildInitialPageTargeting();this.adEngine.gptWrapper.setTargeting(e)}});s(this,"api",{getAllTargeting:()=>{var e;return(e=this.adEngine)==null?void 0:e.gptWrapper.getAllTargeting()},setTargeting:e=>{var t;(t=this.adEngine)==null||t.gptWrapper.setTargeting(e)}});this.activeLabradorKeyValues=e}getDebugState(){return structuredClone({targetingFromLegacy:this.getTargetingFromLegacyAdsContext(),targetingFromFandomContextSite:this.getTargetingFromFandomContextSite(),targetingFromFandomContextPage:this.getTargetingFromFandomContextPage()})}getRating({esrb:e=[],mpa:t=[]}){const r=[];for(const o of e)r.push(`esrb:${o}`);for(const o of t)r.push(`mpa:${o}`);return r}getS2PageType(e){const t=(e==null?void 0:e.pageType)??"article";if(t==="article"){if(ie(e))return`wv-${t}`;if(Ke())return`${t}-ic`}return t}getTargetingFromLegacyAdsContext(){var r;const{targeting:e={},opts:t={}}=((r=window.ads)==null?void 0:r.context)??{};return{s2:this.getS2PageType(e),original_host:t.isGamepedia===!0?"gamepedia":"fandom"}}getTargetingFromFandomContextSite(){const e=L();if(!(e!=null&&e.site))return{};const{site:t}=e;if(Object.keys(t).length===0)return{};const r={},{categories:o,siteId:a,siteName:d="wikia",tags:l,directedAtChildren:u,taxonomy:b=[]}=t;return t.top1000&&(r.top="1k"),{...r,s0:b[0],s0c:o,s0v:b[1],s1:`_${d}`,siteId:a.toString(),kid_wiki:u?$:ce,rating:this.getRating(l??{}),...l}}getTargetingFromFandomContextPage(){const e=L();if(!(e!=null&&e.page))return{};const{page:t}=e;if(Object.keys(t).length===0)return{};const{articleId:r,pageName:o,pageType:a,pageId:d,lang:l,wordCount:u}=t;return{artid:String(r),lang:l,pageId:d.toString(),pageName:o,pageType:a,tier:Kt(e).toString(),word_count:String(u),wpage:o==null?void 0:o.toLowerCase()}}getTargetingFromFandomContextTracking(){const e=L();if(!(e!=null&&e.tracking))return{};const{tracking:t}=e,r={};return t.pvNumber!==void 0&&(r.pv=t.pvNumber.toString()),t.pvNumberGlobal!==void 0&&(r.pvg=t.pvNumberGlobal.toString()),t.pvUID!==void 0&&(r.pvuid=t.pvUID),t.ppid!==void 0&&(r.ppid=t.ppid),r}getTargetingFromFandomContextTargeting(){const e=L();if(!(e!=null&&e.targeting))return{};const{targeting:t}=e,r={};return t.brand!==void 0&&(r.brand=t.brand),t.adGroup!==void 0&&(r.adGroup=t.adGroup.split(",")),r}getTargetingFromFandomContextUser(){return{userState:X()}}getTargetingFromFandomContext(){return{...this.getTargetingFromFandomContextPage(),...this.getTargetingFromFandomContextSite(),...this.getTargetingFromFandomContextTracking(),...this.getTargetingFromFandomContextTargeting(),...this.getTargetingFromFandomContextUser()}}getExperimentGroups(){const e=Ti();return e?[e]:[]}getTargetingFromFandomHost(){var t,r,o;const e=te();return{device:((t=window.fandomHost)==null?void 0:t.device)??"desktop",geo:((o=(r=window.fandomHost)==null?void 0:r.geo)==null?void 0:o.country)??"none",is_mobile:e?$:ce,skin:`ucp_${e?"mobile":"desktop"}`,browser:Io()}}setTargeting(e){const t={...this.getTargetingFromFandomContextTracking(),...this.getTargetingFromFandomContextTargeting()};e.setTargeting(t)}buildInitialPageTargeting(){return{...{odyssey:["1",`1_${en()}`],odyssey_version:Wt(),odyssey_takeover:Ae,product:"fandom",uap:"none",uap_c:"none",labrador:this.activeLabradorKeyValues,dmn:Gt().replace(/\./g,""),hostpre:Vi()??void 0,exp_bucket:Gi(),experiment_groups:this.getExperimentGroups()},...this.getTargetingFromFandomContext(),...this.getTargetingFromFandomHost(),...this.getTargetingFromLegacyAdsContext()}}}class Po extends g{constructor(){super(...arguments);s(this,"name","PerformanceTestPlugin");s(this,"hooks",{onBeforeFirstCallAdsRequest(e){e.addEventListener("slotRenderEnded",t=>{t.slot.getSlotElementId()==="top_leaderboard"&&performance.mark("top_leaderboard_rendered")})}})}}function Ro(n){return n.offsetTop>=window.innerHeight}function Te(){var n,i;return((i=(n=window.ads)==null?void 0:n.context)==null?void 0:i.platform)??"app"}const Ve={fandomdesktop:".mw-parser-output",fandommobile:".mw-parser-output",default:"#content"};function wo(n){return n?Ve[n]??Ve.default:Ve.default}const Bt=970;class No extends g{constructor(){super();s(this,"name","RepeatableSlotsPlugin");s(this,"contentWidth");s(this,"hooks",{onAfterAdNodeManagerInit:e=>{var r;const{baseSlots:t}=e.getSlotConfigMap();for(const o of Object.values(t))(r=o==null?void 0:o.dynamic)!=null&&r.repeat&&this.createAdNodesForBaseSlot(o,o.dynamic.repeat)}});this.contentWidth=this.calculateContentWidth()}getDebugState(){return{contentWidth:this.contentWidth,maxIncontentAdWidth:Bt}}calculateContentWidth(){const e=document.querySelector(wo(Te()));return e?e.clientWidth:Bt}shouldPlaceSlotOnAnchor(e,t,r){const{minDistanceBetweenAds:o=1}=r;if(!Ro(e)||e.offsetWidth<this.contentWidth)return!1;const a=window.innerHeight;if(t!==null&&o>0){const d=a*o,l=t.offsetTop+d;if(e.offsetTop<l)return!1}return!0}getAnchors(e){const t=[...document.querySelectorAll(e.selector)],r=(e==null?void 0:e.startAtSelectorIndex)??0;let o=null;return t.filter((d,l)=>{if(this.shouldPlaceSlotOnAnchor(d,o,e)&&l>=r)return o=d,!0})}createAdNodesForBaseSlot(e,t){const r=document.createElement("div");r.classList.add(e.name,y.WRAPPER_CLASS);const o=this.getAnchors(t),a=Math.min(t.max??Number.MAX_SAFE_INTEGER,o.length);for(let d=0;d<a;d++){const l=`${e.name}_${d+1}`,u=o[d],b=r.cloneNode(),I=document.createElement(y.ELEMENT_NAME);I.id=l,b.appendChild(I),u[t.insertMethod](b)}}}class Bo{constructor(i,e){s(this,"refreshStatus");s(this,"nextRefreshTime");s(this,"refreshTimerRef");s(this,"slotVisibilityChangedEventListenerUnsubscribe");this.adNode=i,this.refreshTimeoutMS=e,this.refreshStatus="disabled",this.init()}init(){var i;this.clearTimer(),this.unsubscribeFromSlotVisibilityChangedEventListener(),this.refreshStatus=(i=this.refreshConfig)!=null&&i.enabled?"enabled":"disabled"}onRefreshScheduled(i){this.clearTimer(),this.refreshTimerRef=i,this.nextRefreshTime=new Date(Date.now()+this.refreshTimeoutMS),this.refreshStatus="scheduled"}onSlotVisibilityChangedEventListenerSubscribed(i){this.refreshStatus="out-of-view",this.clearTimer(),this.unsubscribeFromSlotVisibilityChangedEventListener(),this.slotVisibilityChangedEventListenerUnsubscribe=i}onSlotVisible(){this.unsubscribeFromSlotVisibilityChangedEventListener()}onRequestRender(){this.refreshStatus="refreshing",this.clearTimer()}onAdNodeRemoved(){this.clearTimer(),this.unsubscribeFromSlotVisibilityChangedEventListener(),this.refreshStatus="disabled"}onSlotRenderEnded(){var i;this.refreshStatus=(i=this.refreshConfig)!=null&&i.enabled?"enabled":"disabled"}getDebugState(){const i={status:this.refreshStatus};return this.nextRefreshTime&&(i.nextRefreshTime=this.nextRefreshTime,i.secondsUntilNextRefresh=this.nextRefreshTime.getTime()-Date.now()),i.config=this.refreshConfig,i}get refreshConfig(){return this.adNode.getSlotConfig().refresh}clearTimer(){this.refreshTimerRef&&clearTimeout(this.refreshTimerRef),this.refreshTimerRef=void 0,this.nextRefreshTime=void 0}unsubscribeFromSlotVisibilityChangedEventListener(){var i;(i=this.slotVisibilityChangedEventListenerUnsubscribe)==null||i.call(this),this.slotVisibilityChangedEventListenerUnsubscribe=()=>{}}}const de=class de extends g{constructor(e={}){super();s(this,"name","SlotRefresherPlugin");s(this,"active",!0);s(this,"refreshTimeoutMS",de.DEFAULT_REFRESH_TIMEOUT_MS);s(this,"adEngine");s(this,"adNodeRefreshers");s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,e.gptWrapper.addEventListener("impressionViewable",t=>{this.scheduleRefresh(t.slot,e)}),e.gptWrapper.addEventListener("slotRenderEnded",t=>{var r;(r=this.adNodeRefreshers.get(t.slot.getSlotElementId()))==null||r.onSlotRenderEnded()})},onAdNodeCreated:e=>{this.adNodeRefreshers.set(e.getSlotName(),new Bo(e,this.refreshTimeoutMS))},onAdNodeRemoved:e=>{const t=this.adNodeRefreshers.get(e.getSlotName());t==null||t.onAdNodeRemoved(),this.adNodeRefreshers.delete(e.getSlotName())},onAdEngineReset:()=>{this.active=!0;for(const e of this.adNodeRefreshers.values())e.init()}});s(this,"api",{stop:()=>{this.active=!1},stopSlot:e=>{var r;const t=(r=this.adEngine)==null?void 0:r.adNodeManager.getAdNodeByName(e);T(t,`AdNode for slot ${e} not found`),t.block()}});this.config=e,this.adNodeRefreshers=new Map,this.refreshTimeoutMS=this.config.icRefreshTimeoutMS??de.DEFAULT_REFRESH_TIMEOUT_MS}refreshWhenBackInViewport(e,t){var a;const r=e.getSlotName(),o=t.gptWrapper.addSlotEventListener(r,"slotVisibilityChanged",d=>{var l,u;d.inViewPercentage>=50&&((l=this.adNodeRefreshers.get(r))==null||l.onSlotVisible(),this.active&&(t.adRenderManager.requestRender([e]),(u=this.adNodeRefreshers.get(r))==null||u.onRequestRender()))});(a=this.adNodeRefreshers.get(r))==null||a.onSlotVisibilityChangedEventListenerSubscribed(o)}refreshOrAddListener(e,t){var r;this.active&&(e.isInViewport()?(t.adRenderManager.requestRender([e]),(r=this.adNodeRefreshers.get(e.getSlotName()))==null||r.onRequestRender()):this.refreshWhenBackInViewport(e,t))}scheduleRefresh(e,t){var d;const r=e.getSlotElementId(),o=t.adNodeManager.getAdNodeByName(r);T(o,`Cannot schedule refresh. AdNode for slot ${r} not found`);const a=window.setTimeout(()=>{o.isRefreshable()&&this.refreshOrAddListener(o,t)},this.refreshTimeoutMS);(d=this.adNodeRefreshers.get(r))==null||d.onRefreshScheduled(a)}getDebugState(){const e={refreshActive:this.active,refreshTimeoutMS:this.refreshTimeoutMS,adNodes:{}};for(const[t,r]of this.adNodeRefreshers.entries())e.adNodes[t]=r.getDebugState();return e}};s(de,"DEFAULT_REFRESH_TIMEOUT_MS",3e4);let ge=de;const ko={cache:{url:"https://prebid-server.rubiconproject.com/cache",ignoreBidderCacheKey:!0},s2sConfig:[]},Lo={enabled:!0,accountId:"7450",bidders:["mgnipbs"],defaultVendor:"rubicon",coopSync:!0,userSyncLimit:8,defaultTTL:300,timeout:500,allowUnknownBidderCodes:!0,extPrebid:{cache:{vastxml:{returnCreative:!1}},bidders:{mgnipbs:{wrappername:"7450_Web_Server"}}}};class Do extends g{constructor(e={}){super();s(this,"name","ServerToServerPlugin");s(this,"hooks",{onBiddersInit:()=>{if(this.config.icPrebidMagniteS2s){const e=this.usePlugin(v);e==null||e.addPrebidReadyCallback(t=>{t.setConfig(ko)}),e==null||e.addPrebidReadyCallback(t=>{t.mergeConfig({s2sConfig:[Lo]})})}}});this.config=e}static isEnabled(e){return!!(e!=null&&e.icPrebidMagniteS2s)}}const M="top_leaderboard",Ye={DESKTOP:[3,3],MAX:[3,3],MOBILE:[2,2]},Oo=250;function Ei(n){if(n.size===null||typeof n.size=="string")return!1;if(Array.isArray(n.size)&&n.size.length>=2){const[i,e]=n.size;return He([i,e],Ye.DESKTOP)||He([i,e],Ye.MOBILE)}return!1}function Fo(n,i){if(n==="fandomdesktop")return B(async()=>{const{TopBoxadHandler:e}=await import("./TopBoxadHandler-D3AHPWmH.js");return{TopBoxadHandler:e}},[]).then(({TopBoxadHandler:e})=>{new e().applySticky(i)}).catch(e=>{h({message:"Failed to load TopBoxadHandler",error:e,priority:c.P4})})}const Re=class Re extends g{constructor(){super(...arguments);s(this,"name","InContentLeaderboardPlugin");s(this,"adEngine");s(this,"adNodes",[]);s(this,"blockedSlots",new Set);s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,this.adNodes=this.adEngine.adNodeManager.getAdNodesByBaseName(Re.IN_CONTENT_LEADERBOARD_BASE_SLOT_NAME),this.api.block(0)}});s(this,"api",{block:e=>{var r;const t=this.getAdNodes(e);try{T((r=this.adEngine)==null?void 0:r.adNodeManager,"adNodeManager is not defined");for(const o of t)this.blockSlot(o)}catch(o){h({message:"Could not block slots",error:o,priority:c.P3})}},unblock:e=>{var r;const t=this.getAdNodes(e);try{T((r=this.adEngine)==null?void 0:r.adNodeManager,"adNodeManager is not defined");for(const o of t)this.unblockSlot(o)}catch(o){h({message:"Could not unblock slots",error:o,priority:c.P3})}}})}getDebugState(){return{incontentLeaderboardSlots:this.adNodes.map(e=>e.getSlotName()),blockedSlots:Array.from(this.blockedSlots)}}getAdNodes(e){return e===void 0?this.adNodes:e<0||e>=this.adNodes.length?[]:[this.adNodes[e]]}blockSlot(e){var r;(r=this.adEngine)==null||r.adNodeManager.blockSlot(e.getSlotName()),this.blockedSlots.add(e.getSlotName());const t=e.getElement();t&&(t.style.display="none")}unblockSlot(e){var r;(r=this.adEngine)==null||r.adNodeManager.unblockSlot(e.getSlotName()),this.blockedSlots.delete(e.getSlotName());const t=e.getElement();t&&(t.style.display="")}};s(Re,"IN_CONTENT_LEADERBOARD_BASE_SLOT_NAME","incontent_leaderboard");let Ce=Re;class Ai extends g{constructor(){super(...arguments);s(this,"name","InContentPlayerPlugin");s(this,"hasFiredInContentVideoInitCallback",!1);s(this,"initOnceEventSubscriber",new je(1));s(this,"api",{initOnce:()=>{this.hasFiredInContentVideoInitCallback||(this.hasFiredInContentVideoInitCallback=!0,this.initOnceEventSubscriber.notify())},reject:()=>{const e=this.usePlugin(Ce);e==null||e.unblock(0)},registerInContentPlayerInitCallback:e=>{this.initOnceEventSubscriber.subscribe(e)}})}getDebugState(){return{hasInContentVideoInitCallbackFired:this.hasFiredInContentVideoInitCallback}}}const Mo=1e10;function xo(){return Math.floor(Math.random()*Mo)+1}function Uo(){return["output=xml_vast4","env=vp","gdfp_req=1","impl=s","unviewed_position_start=1",`url=${encodeURIComponent(window.location.href)}`,`description_url=${encodeURIComponent(window.location.href)}`,`correlator=${xo()}`]}function Vo(){var i,e;const n=(e=(i=L())==null?void 0:i.tracking)==null?void 0:e.ppid;return n?[`ppid=${n}`]:[]}function Wo(n){const i=ke(n.getSizes());return i.length>0?i.join("|"):"640x480"}function zo(n){window.ads&&n&&(window.ads.runtime=window.ads.runtime??{},window.ads.runtime.video={adUnit:n})}const Go="https://pubads.g.doubleclick.net/gampad/ads?";class Qe extends g{constructor(e={}){super();s(this,"name","VastUrlPlugin");s(this,"consentData");s(this,"resolvedState",Promise.withResolvers());s(this,"adEngine");s(this,"api",{get:async(e="featured",t)=>{const r=this.getAdNode(e)??this.createFeaturedAdNode();return r?(await this.requestBids(r),`${Go}${this.getParams(t,r).join("&")}`):""},getAdUnitPath:(e="featured")=>{var t;return((t=this.getAdNode(e))==null?void 0:t.getAdUnitPath())??""},getTargetingParams:async(e="featured",t)=>{const r=this.getAdNode(e);return r?(await this.requestBids(r),this.buildCustomParams(t,r)):""},getPageTargeting:()=>{var e;return((e=this.adEngine)==null?void 0:e.gptWrapper.getAllTargeting({raw:!1}))??{}},getSlotTargeting:e=>{var t;return((t=this.adEngine)==null?void 0:t.gptWrapper.getAllSlotTargeting(e,{raw:!1}))??{}},setAdUnitRuntimeVariable:(e="incontent_player")=>{const t=this.api.getAdUnitPath(e)??"";zo(t)},unblockVideo:()=>{this.resolvedState.resolve()}});s(this,"hooks",{onConsentUpdated:e=>{this.consentData=e},onAfterAdNodeManagerInit:e=>{try{this.createAdNodeForPageType(e),this.config.icUAPJWPlayer||this.api.unblockVideo()}catch(t){if(t instanceof nt)return;throw t}},onAdEngineInit:e=>{this.adEngine=e}});this.config=e}getDebugState(){return{hasFeaturedVideo:ie(),hasIncontentPlayer:Ke()}}createAdNodeForPageType(e){Ke()&&e.createAdNode("incontent_player")}createFeaturedAdNode(){var e,t;if(ie()&&((e=document.getElementById("featured"))==null?void 0:e.tagName)!==D.ELEMENT_NAME.toUpperCase())return(t=this.adEngine)==null?void 0:t.adNodeManager.createAdNode("featured")}getParams(e,t){return[...Uo(),...Vo(),...this.getPrivacyParams(),...this.getSlotParams(t),...this.getCustomParams(e,t),...this.getVideoParams()].filter(Boolean)}getSlotParams(e){const t=e.getAdUnitPath(),r=Wo(e);return[`iu=${t}`,`sz=${r}`]}getPrivacyParams(){const{coppa:e,consentApi:t,consentString:r=""}=this.consentData??{},o=[];return t==="usp"?o.push(`us_privacy=${r}`,"gdpr=0"):t==="tcf"&&o.push(`gdpr_consent=${r}`,"gdpr=1"),e===!0&&o.push("tfcd=1"),o}buildCustomParams(e,t){const r=(t==null?void 0:t.getAllTargeting())??{},o=Object.entries(r).map(([l,u])=>`${l}=${u.join(",")}`).join("&"),a=this.getPageTargetingParams();return[`player=${this.getVideoPlayer(e)}`,"rv=1",o,...a,...this.getUAPParams()].filter(Boolean).join("&")}getCustomParams(e,t){const r=this.buildCustomParams(e,t);return[`cust_params=${encodeURIComponent(r)}`]}getPageTargetingParams(){var t;const e=((t=this.adEngine)==null?void 0:t.gptWrapper.getAllTargeting({raw:!1}))??{};return Object.entries(e).map(([r,o])=>`${r}=${o}`)}getVideoPlayer(e){return e??(this.config.icFeaturedVideoPlayer==="Connatix"?"cnx":"jwp")}getVideoParams(){return[`vpos=${this.getPosition()}`]}getUAPParams(){var r,o,a,d;const e=(o=(r=this.adEngine)==null?void 0:r.gptWrapper)==null?void 0:o.getTargeting("uap"),t=(d=(a=this.adEngine)==null?void 0:a.gptWrapper)==null?void 0:d.getTargeting("uap_c");return e&&t?[`uap=${e[0]}`,`uap_c=${t[0]}`]:[]}getPosition(){return"preroll"}waitForResolvedState(){return this.resolvedState.promise}getAdNode(e){var t;return(t=this.adEngine)==null?void 0:t.adNodeManager.getAdNodeByName(e)}async requestBids(e){var t;e.incrementRenderCount(),await((t=this.adEngine)==null?void 0:t.adRenderManager.requestBids([e])),await this.waitForResolvedState()}}class Ho{constructor(){s(this,"activating",!1);s(this,"feature");s(this,"killDeactivation",!1);s(this,"onRemoveStickinessCallback")}activate(i){this.activating||this.feature||(this.activating=!0,B(async()=>{const{StickyFeature:e}=await import("./StickyFeature-DxSbHdth.js");return{StickyFeature:e}},[]).then(({StickyFeature:e})=>{this.feature=new e,this.feature.activate(i),this.activating=!1,this.onRemoveStickinessCallback&&this.feature.onRemoveStickiness(this.onRemoveStickinessCallback)}).catch(()=>{throw this.activating=!1,new Error("Failed to load StickyFeature")}))}addOnRemoveStickiness(i){if(!this.feature){this.onRemoveStickinessCallback=i;return}this.feature.onRemoveStickiness(i)}deactivate(){if(this.killDeactivation){this.killDeactivation=!1;return}if(!this.feature){setTimeout(()=>{this.deactivate()},100);return}this.feature.removeStickiness({forcedByDeactivation:!0})}reactivate(i,e){if(this.killDeactivation=!0,!this.feature){this.activate({...i,disableAutoUnstick:e});return}this.feature.activate({...i,disableAutoUnstick:e})}}class $o{constructor(i){s(this,"activating",!1);s(this,"feature");this.topStrategyTunerPlugin=i}activate(i,e){this.activating||this.feature||(this.activating=!0,B(async()=>{const{SkyboxFeature:t}=await import("./SkyboxFeature-CeF0ma1J.js");return{SkyboxFeature:t}},[]).then(({SkyboxFeature:t})=>{this.feature=new t,this.feature.activate(this.topStrategyTunerPlugin,i,e),this.activating=!1}).catch(()=>{throw this.activating=!1,new Error("Failed to load SkyboxFeature")}))}moveToResolvedState(i){this.feature&&(this.feature.isStateResolved()||this.feature.makeStateResolved(i))}onSkyboxStateResolved(i){this.feature&&this.feature.onSkyboxStateResolved(i)}onSkyboxRender(i){const e=(i==null?void 0:i.getRenderCount())??-1;i&&e>1&&this.feature&&this.feature.onSkyboxRefresh(i)}}class qo{constructor(i){s(this,"activating",!1);s(this,"feature");this.adNodeManager=i}activate(i){this.activating||this.feature||(this.activating=!0,B(async()=>{const{SlotManagerFeature:e}=await import("./SlotManagerFeature-SVdkR6ey.js");return{SlotManagerFeature:e}},[]).then(({SlotManagerFeature:e})=>{this.feature=new e(this.adNodeManager),this.feature.activate(i.enabledSlots??[]),this.activating=!1}).catch(()=>{throw this.activating=!1,new Error("Failed to load SlotManagerFeature")}))}}class jo{constructor(){s(this,"activating",!1);s(this,"feature")}activate(i,e){this.activating||this.feature||(this.activating=!0,B(async()=>{const{VideoBannerFeature:t}=await import("./VideoBannerFeature-Du3WnP35.js");return{VideoBannerFeature:t}},[]).then(({VideoBannerFeature:t})=>{this.feature=new t,this.feature.activate(i,e),this.activating=!1}).catch(()=>{throw this.activating=!1,new Error("Failed to load VideoBannerFeature")}))}stopVideoOnOutOfViewport(){this.feature&&this.feature.stopVideoOnOutOfViewport()}}function kt(n){return n?n.toString():"none"}const _i=/(opera|chrome|safari|firefox|msie|trident(?=\/))/i;function yi(){const n=navigator.userAgent.match(_i);return n!==null&&n[1]==="Chrome"}function Ko(){const n=navigator.userAgent.match(_i);return n!==null&&n[1].toLowerCase()==="safari"&&!yi()}function Yo(){Ko()&&requestAnimationFrame(()=>{const n=document.body.style.display;document.body.style.display="inline-block",document.body.offsetHeight,document.body.style.display=n})}class Qo extends g{constructor(e={},t){super();s(this,"name","TopStrategyTunerPlugin");s(this,"adNodeManager");s(this,"gpt");s(this,"defaultStickyTlbPromiseResolver",()=>{});s(this,"defaultStickyTlbPromiseRejecter",()=>{});s(this,"featuresFlags",{skyboxResolved:!1});s(this,"defaultStickyTlbApplied",!1);s(this,"stickyActivator");s(this,"skyboxActivator");s(this,"slotManagerActivator");s(this,"videoFeatureActivator");s(this,"tentpoleActivator",Promise.withResolvers());s(this,"onTlbLoadedCallbacks",[]);s(this,"hasFanTakeoverLoaded",null);s(this,"api",{activate:async e=>{var t;e.slotName??(e.slotName=M),this.defaultStickyTlbPromiseRejecter(),e.skybox&&e.takeover&&((t=this.usePlugin(ge))==null||t.stop()),this.activateTentpoleFeature(e),this.activateStickyFeature(e),this.activateSlotManagerFeature(e),this.activateSkyboxFeature(e),this.activateVideoFeature(e)},onRemoveStickiness:e=>{var t;(t=this.stickyActivator)==null||t.addOnRemoveStickiness(e)},onSkyboxStateResolved:e=>{var t;(t=this.skyboxActivator)==null||t.onSkyboxStateResolved(e)},onTlbLoaded:e=>{this.onTlbLoadedCallbacks.push(e)}});s(this,"hooks",{onAfterAdNodeManagerInit:e=>{var t;this.adNodeManager=e,ie()&&((t=this.adNodeManager.getAdNodeByName(M))==null||t.removeSizes(Ye.MAX,oe.LESS_THAN_OR_EQUAL))},onAfterGptWrapperInit:e=>{this.gpt=e,this.activateOrUnblockProperPluginOnDefaultTopSlotRender(e),this.handleDefaultTopLeaderboardFirstImpression(e)}});this.config=e,this.defaultStickyTlbPromise=t,this.defaultStickyTlbPromise??(this.defaultStickyTlbPromise=new Promise((r,o)=>{this.defaultStickyTlbPromiseResolver=r,this.defaultStickyTlbPromiseRejecter=o})),document.body.classList.add("odyssey","odyssey-top-strategy")}getDebugState(){return{isSkyboxResolved:this.featuresFlags.skyboxResolved,hasFanTakeoverLoaded:this.hasFanTakeoverLoaded,isDefaultStickyTlbApplied:this.defaultStickyTlbApplied,hasStickyActivator:!!this.stickyActivator,hasSkyboxActivator:!!this.skyboxActivator,hasSlotManagerActivator:!!this.slotManagerActivator,hasVideoBannerActivator:!!this.videoFeatureActivator,onTlbLoadedCallbacksCount:this.onTlbLoadedCallbacks.length}}activateStickyFeature(e){!e.sticky&&this.defaultStickyTlbApplied||(this.stickyActivator??(this.stickyActivator=new Ho),this.stickyActivator.activate(e))}activateSkyboxFeature(e){var t;e.skybox&&(this.skyboxActivator??(this.skyboxActivator=new $o(this)),(t=this.stickyActivator)==null||t.deactivate(),this.skyboxActivator.activate(e,()=>{var r;this.featuresFlags.skyboxResolved=!0,(r=this.stickyActivator)==null||r.reactivate(e,!te()),Yo()}),this.onTlbLoadedCallbacks.forEach(r=>r(!0)))}activateSlotManagerFeature(e){var t;!e.takeover||!((t=e.enabledSlots)!=null&&t.length)||(this.slotManagerActivator=new qo(this.adNodeManager),this.slotManagerActivator.activate({enabledSlots:e.enabledSlots}))}activateTentpoleFeature(e){var r,o,a;if(typeof e.tentpole!="object"){this.tentpoleActivator.resolve();return}const{tentpole:t}=e;this.gpt&&(this.gpt.setTargeting("uap",kt(t==null?void 0:t.lineItemId)),this.gpt.setTargeting("uap_c",kt(t==null?void 0:t.creativeId))),(r=this.usePlugin(ge))==null||r.stop(),(o=this.usePlugin(Qe))==null||o.unblockVideo(),this.unblockVideoAds(),(a=this.usePlugin(bi))==null||a.activateTentpole(),Fo(Te(),this)}activateOrUnblockProperPluginOnDefaultTopSlotRender(e){e.addSlotEventListener(M,"slotRenderEnded",async t=>{var r,o;if(this.handleUnblockVideoOnDefaultSlotRender(),this.skyboxActivator){const a=(r=this.adNodeManager)==null?void 0:r.getAdNodeByName(M);this.skyboxActivator.onSkyboxRender(a);return}if(!te()){if(!this.config.icForceStickyTlb&&t.isEmpty)return;(o=this.defaultStickyTlbPromise)==null||o.then(()=>{this.defaultStickyTlbApplied=!0,this.activateStickyFeature({id:"unknown",slotName:M,sticky:!0})}),setTimeout(()=>{this.defaultStickyTlbPromiseResolver()},100)}this.handleInContentVideo(t)})}handleDefaultTopLeaderboardFirstImpression(e){e.addSlotEventListener(M,"impressionViewable",()=>{var r,o;if(this.skyboxActivator)return;((o=(r=this.adNodeManager)==null?void 0:r.getAdNodeByName(M))==null?void 0:o.getRenderCount())===1&&this.onTlbLoadedCallbacks.forEach(a=>a(!1))})}handleUnblockVideoOnDefaultSlotRender(){const e=()=>{var t;(t=this.usePlugin(Qe))==null||t.unblockVideo(),this.unblockVideoAds()};q(this.tentpoleActivator.promise,Oo).then(e,e)}handleInContentVideo(e){this.hasFanTakeoverLoaded=Ei(e);const t=this.usePlugin(Ai);!this.hasFanTakeoverLoaded&&!ie()?t==null||t.initOnce():t==null||t.reject()}activateVideoFeature(e){var t;e.videoUrl&&(this.videoFeatureActivator??(this.videoFeatureActivator=new jo),this.videoFeatureActivator.activate(e,()=>{var r;(r=this.skyboxActivator)==null||r.moveToResolvedState(e)}),(t=this.stickyActivator)==null||t.addOnRemoveStickiness(()=>{var r;(r=this.videoFeatureActivator)==null||r.stopVideoOnOutOfViewport()}))}unblockVideoAds(){const e=document.getElementsByTagName(D.ELEMENT_NAME);for(const t of e)t instanceof D&&t.unblockVideo()}}class Xo extends g{constructor(e){super();s(this,"name","LightboxLeaderboardPlugin");s(this,"adEngine");s(this,"refreshLock",!1);s(this,"slotExpanded",!1);s(this,"galleryLeaderboard",null);s(this,"lightboxLeaderboardAdNode");s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e},onAdNodeCreated:e=>{this.lightboxLeaderboardAdNode=e}});s(this,"api",{onLightboxOpen:e=>{this.galleryLeaderboard=document.querySelector(".gallery-leaderboard"),this.galleryLeaderboard&&this.renderOrRefreshAd(e)},onLightboxClose:()=>{this.galleryLeaderboard=null,this.toggleFloorAdhesion(!1)},onLightboxChange:e=>{this.renderOrRefreshAd(e)}});this.config=e}getDebugState(){return{isRefreshLocked:this.refreshLock,isSlotExpanded:this.slotExpanded,hasGalleryLeaderboard:!!this.galleryLeaderboard,hasLightboxLeaderboardAdNode:!!this.lightboxLeaderboardAdNode}}setRefreshLock(e=2e3){this.refreshLock=!0,setTimeout(()=>{this.refreshLock=!1},e)}waitForFloorWrapper(e){const t=document.getElementById("floor_adhesion_wrapper");if(t){e(t);return}const r=new MutationObserver(()=>{const o=document.getElementById("floor_adhesion_wrapper");o&&(r.disconnect(),e(o))});r.observe(document.body,{childList:!0,subtree:!0})}toggleFloorAdhesion(e){this.waitForFloorWrapper(t=>{t.classList.toggle("hide-under-lightbox",e)})}getOrCreateLightboxLeaderboard(){var t;if(!this.galleryLeaderboard)return null;let e=document.getElementById("lightbox_leaderboard");return e||(e=document.createElement(y.ELEMENT_NAME),e.id="lightbox_leaderboard",this.galleryLeaderboard.classList.add(y.WRAPPER_CLASS),this.galleryLeaderboard.prepend(e),this.lightboxLeaderboardAdNode=(t=this.adEngine)==null?void 0:t.adNodeManager.getAdNodeByName("lightbox_leaderboard")),e}handleShowingAdSlot(){var r;const e=this.getOrCreateLightboxLeaderboard();if(!e)return;this.toggleFloorAdhesion(!0),(r=e.parentElement)==null||r.classList.remove("is-loading");const t=document==null?void 0:document.getElementsByClassName("lightbox-wrapper-inner")[0];t&&!t.classList.contains("with-ad")&&t.classList.add("with-ad"),this.expandSlot(),this.bidAndRefreshLightboxLeaderboardAdNode()}handleHidingAdSlot(){var r;if(!this.getOrCreateLightboxLeaderboard())return;const t=document==null?void 0:document.getElementsByClassName("lightbox-wrapper-inner")[0];(r=t==null?void 0:t.classList)==null||r.remove("with-ad"),this.collapseSlot()}collapseSlot(){var t;if(!this.slotExpanded)return;const e=(t=this.lightboxLeaderboardAdNode)==null?void 0:t.getElement();e&&(e.style.height="0px",e.parentElement&&(e.parentElement.style.display="none")),this.slotExpanded=!1}expandSlot(){var t;if(this.slotExpanded)return;const e=(t=this.lightboxLeaderboardAdNode)==null?void 0:t.getElement();e&&(e.style.height="",e.parentElement&&(e.parentElement.style.display="")),this.slotExpanded=!0}renderOrRefreshAd(e){var t;if(this.config.icLightboxLeaderboardEnabled&&((t=this.adEngine)==null?void 0:t.monetizationTierEngine.getCurrentTier())===A.PARTIALLY_MONETIZED)if(e){if(this.refreshLock)return;this.handleShowingAdSlot()}else this.handleHidingAdSlot()}async bidAndRefreshLightboxLeaderboardAdNode(){var e;this.setRefreshLock(),this.lightboxLeaderboardAdNode&&((e=this.adEngine)==null||e.adRenderManager.requestRender([this.lightboxLeaderboardAdNode],!0))}}class Zo extends g{constructor(){super(...arguments);s(this,"name","LotamePlugin");s(this,"CLIENT_ID",17364);s(this,"PIXEL_URL",`https://tags.crwdcntrl.net/lt/c/${this.CLIENT_ID}/lt.min.js`);s(this,"isLoaded",!1);s(this,"TAXONOMY_TAGS_TO_KEEP",["gnre","media","pform","pub","theme","tv"]);s(this,"hooks",{onConsentUpdated:e=>{w(e)&&this.init()}})}getDebugState(){var e,t;return{isScriptLoaded:this.isLoaded,clientId:this.CLIENT_ID,hasFandomContext:!!((t=(e=L())==null?void 0:e.site)!=null&&t.tags)}}mapTaxonomyToLotameBehaviorTags(e={}){const t=[];for(const[r,o]of Object.entries(e))if(this.TAXONOMY_TAGS_TO_KEEP.includes(r))for(const a of o)t.push(`${r}: ${a}`);return t}setupLotameTagInput(){var r,o;const e=(o=(r=L())==null?void 0:r.site)==null?void 0:o.tags;return{data:{behaviors:{med:e?this.mapTaxonomyToLotameBehaviorTags(e):[]}},config:{clientId:this.CLIENT_ID}}}setupLotameNamespaceConfig(){const e=this.setupLotameTagInput(),t=`lotame_${this.CLIENT_ID}`,r=e.config??{},o=window[t]={};o.config=r,o.data=e.data??{},o.cmd=o.cmd??[],o.cmd.push(()=>{var a;(a=o.setUserConsent)==null||a.call(o,{lotameConsent:!0})})}async loadLotameScript(){this.setupLotameNamespaceConfig();try{await be("lotame",this.PIXEL_URL),this.isLoaded=!0}catch{}}static isEnabled(e){return!!(e!=null&&e.icLotame)}init(){this.isLoaded||this.loadLotameScript()}}class Jo extends g{constructor(){super(...arguments);s(this,"name","ConfiantPlugin");s(this,"scriptDomain","cdn.confiant-integrations.net");s(this,"propertyId","d-aIf3ibf0cYxCLB1HTWfBQOFEA");s(this,"isLoaded",!1);s(this,"trackBlock",(e,t,r,o,a,d)=>{if(d&&d.dfp){const l=d.dfp.s;console.debug(`Blocked ad on ${l}`)}});s(this,"hooks",{onConsentUpdated:e=>{w(e)&&this.init()}})}getDebugState(){return{isScriptLoaded:this.isLoaded,propertyId:this.propertyId,scriptDomain:this.scriptDomain}}static isEnabled(e){return!!(e!=null&&e.icConfiant)}async loadConfiantScript(){const e=`//${this.scriptDomain}/${this.propertyId}/gpt_and_prebid/config.js`;try{await be("confiant",e),this.isLoaded=!0}catch{}}setupConfiantWindowObject(){window.confiant=window.confiant??{},window.confiant.callback=this.trackBlock}init(){this.isLoaded||(this.setupConfiantWindowObject(),this.loadConfiantScript())}}const es=1,Lt={default:1187275693,v6_1:339079598},ts={default:"IntentIqObject",v6_1:"IntentIqObject61"};function is(n){return{biddingPlatformId:es,partnerAuctionId:n.auctionId,bidderCode:n.bidderCode,prebidAuctionId:n.auctionId,cpm:n.cpm,currency:n.currency}}function ns(n){return`//script.wikia.nocookie.net/fandom-ae-assets/intentiq/${n}/IIQUniversalID.js`}function at(n){return n==="v6.1"}function rs(n){return ts[at(n)?"v6_1":"default"]}function vi(n){return window[rs(n)]}async function os(n){await ye(()=>vi(n)!==void 0,{maxTries:10,exponentialTimeout:10})}function ss(n,i,e){const t=window.location.hostname.includes(".fandom.com")?"fandom.com":window.location.hostname;return at(n)?{partner:Lt.v6_1,pbjs:e,timeoutInMillis:i,ABTestingConfigurationSource:"IIQServer",manualWinReportEnabled:!0,domainName:t,vrBrowserBlackList:["chrome"]}:{partner:Lt.default,pbjs:e,timeoutInMillis:i,ABTestingConfigurationSource:"percentage",abPercentage:97,manualWinReportEnabled:!0,domainName:t,vrBrowserBlackList:["chrome"]}}async function as(n,i,e){return new Promise(t=>{const r=new i({...n,callback:(o,a)=>{a??(a="U"),e(r,a),t()}})})}async function ds(n,i,e){return new Promise(t=>{var a,d;const r=new i({...n,callback:()=>{t()}}),o=((d=(a=r==null?void 0:r.intentIqConfig)==null?void 0:a.abTesting)==null?void 0:d.currentTestGroup)??"U";e(r,o)})}async function ls(n,i,e,t){const r=ss(n,i,e),o=vi(n);if(o)return at(n)?as(r,o,t):ds(r,o,t)}const cs=1e3;class us extends g{constructor(e){super();s(this,"name","IntentIqPlugin");s(this,"consent",!1);s(this,"enabled",!1);s(this,"intentIqObject");s(this,"gptWrapper");s(this,"pbjs");s(this,"hooks",{onBiddersInit:()=>{var e;(e=this.usePlugin(v))==null||e.addPrebidReadyCallback(t=>{this.pbjs=t,this.initialize(this.pbjs)})},onConsentUpdated:e=>{this.consent=w(e),this.pbjs&&this.initialize(this.pbjs)},onAfterGptWrapperInit:e=>{this.gptWrapper=e}});this.config=e}static isEnabled(e){return!yi()&&e.icPrebidIntentIQ&&!!e.icPrebidIntentIQVersion&&!!e.icPrebidIntentIQTimeout}async initialize(e){if(this.enabled||!this.consent)return;await this.loadIntentIqLibrary(e);const t=({bid:r})=>{this.reportPrebidWin(r)};e.onEvent("adRenderSucceeded",t)}async loadIntentIqLibrary(e){try{f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"intentiq_started",time:performance.now()}),await q(H(ns(this.config.icPrebidIntentIQVersion)),cs)}catch{f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"intentiq_error_loading",time:performance.now()})}try{await os(this.config.icPrebidIntentIQVersion),await ls(this.config.icPrebidIntentIQVersion,this.config.icPrebidIntentIQTimeout,e,(t,r)=>{this.enabled=!0,this.intentIqObject=t,this.setTargeting(r),f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"intentiq_loaded",time:performance.now()})})}catch(t){f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"intentiq_error_loading",time:performance.now()}),h({message:"Failed to get intent Iq object instance",priority:c.P3,error:t})}}setTargeting(e){T(this.gptWrapper,"GPT wrapper is not available"),e&&this.gptWrapper&&this.gptWrapper.setTargeting("intent_iq_group",e)}reportPrebidWin(e){if(!this.enabled||!this.intentIqObject)return;const t=is(e);this.intentIqObject.reportExternalWin(t)}}class gs extends g{constructor(e){super();s(this,"name","CaptifyPlugin");s(this,"gptWrapper");s(this,"PROPERTY_ID");s(this,"CAPTIFY_PIXEL_URL");s(this,"gamIntegration",!1);s(this,"isLoaded",!1);s(this,"hooks",{onAdEngineInit:e=>{this.gptWrapper=e.gptWrapper},onConsentUpdated:e=>{w(e)&&this.init()}});const{propertyId:t=12974,gamIntegration:r=!1}=typeof e.icCaptify=="boolean"?{propertyId:12974,gamIntegration:!1}:e.icCaptify;this.PROPERTY_ID=t,this.CAPTIFY_PIXEL_URL=`https://p.cpx.to/p/${this.PROPERTY_ID}/px.js`,this.gamIntegration=r}static isEnabled(e){return!!(e!=null&&e.icCaptify)}createCaptifyWindowObject(){const e=`captify_kw_query_${this.PROPERTY_ID}`;window[e]=""}async createAndInsertScript(){try{await be("captify",{src:this.CAPTIFY_PIXEL_URL,isAsyncOrDeferOtherwise:!1,node:"first"}),this.isLoaded=!0}catch{}}installGAMIntegration(){var r;const e="_cptt",t="_cptte";(r=this.gptWrapper)==null||r.addToCommandQueue(()=>{var d;const o=window.localStorage&&window.localStorage.getItem(e);if(!o){window.localStorage.removeItem(e),window.localStorage.removeItem(t);return}const a=parseInt(window.localStorage.getItem(t));if(!isNaN(a)&&a>Date.now()){const l=JSON.parse(o);for(let u=0,b=Object.keys(l);u<b.length;u++){const I=b[u];(d=this.gptWrapper)==null||d.setTargeting(I,l[I].map(N=>N.toString()))}}})}init(){this.isLoaded||(this.createCaptifyWindowObject(),this.createAndInsertScript(),this.gamIntegration&&this.installGAMIntegration())}}class hs extends g{constructor(){super(...arguments);s(this,"name","BrandMetricsPlugin");s(this,"BRAND_METRICS_LIB_URL","//cdn.brandmetrics.com/tag/9097a5369e204e6eac53b45c7dde13c5/fandom.com_au.js");s(this,"firstAdRendered",!1);s(this,"hooks",{onAfterGptWrapperInit:e=>{this.init(e)}})}async loadBrandMetricsScript(){try{await be("brand-metrics",this.BRAND_METRICS_LIB_URL)}catch{}}static isEnabled(e){return!!(e!=null&&e.icBrandMetrics)}init(e){const t=()=>{this.firstAdRendered||(this.firstAdRendered=!0,e.removeEventListener("slotRenderEnded",t),this.loadBrandMetricsScript())};e.addEventListener("slotRenderEnded",t)}}const fs="AU_SEG",ps="auSegReady";var Y=(n=>(n.MATCHES_SCRIPT_LOADED="audigent_matches_library_loaded",n.MATCHES_SCRIPT_ERROR_LOADING="audigent_matches_library_error_loading",n.SEGMENTS_SCRIPT_LOADED="audigent_segment_library_loaded",n.SEGMENTS_SCRIPT_ERROR_LOADING="audigent_segment_library_error_loading",n.SEGMENTS_READY="audigent_segments_ready",n))(Y||{});const ms="-1",bs="https://a.ad.gt/api/v1/u/matches/158",Ts="https://seg.ad.gt/api/v1/s/158";class Ss extends g{constructor(e){super();s(this,"name","AudigentPlugin");s(this,"isInitialized",!1);s(this,"segmentsScriptAdded",!1);s(this,"matchesScriptAdded",!1);s(this,"gptWrapper");s(this,"consent",!1);s(this,"hooks",{onConsentUpdated:e=>{this.consent=w(e),this.consent&&this.initialize()},onInitPageTargeting:e=>{this.consent&&(e.AU_SEG=this.getSegments())},onAfterGptWrapperInit:e=>{this.gptWrapper=e,this.updateTargeting()},onAdEngineReset:()=>{this.updateTargeting()}});this.instantConfig=e,this.listenForSegmentUpdates(),this.addSegmentsScript()}static isEnabled(e){return!!e.icAudigent}getDebugState(){var e;return{isInitialized:this.isInitialized,isSegmentsScriptAdded:this.segmentsScriptAdded,isMatchesScriptAdded:this.matchesScriptAdded,segments:((e=window.au_seg)==null?void 0:e.segments)??[]}}sendTracking(e){const t={type:S.VENDOR_TIME_UPDATE,eventName:e,time:performance.now()};f(_,t)}getSegments(){var t;let e=ms;return window.au_seg&&(e=(t=window.au_seg)==null?void 0:t.segments.slice(0,this.instantConfig.icAudigentSegmentLimit)),e}updateTargeting(){if(!this.gptWrapper||!this.consent)return;const e=this.getSegments();this.gptWrapper.setTargeting(fs,e)}listenForSegmentUpdates(){document.addEventListener(ps,()=>{this.updateTargeting(),this.sendTracking(Y.SEGMENTS_READY)})}async addSegmentsScript(){if(!this.segmentsScriptAdded)try{await H(Ts),this.segmentsScriptAdded=!0,this.sendTracking(Y.SEGMENTS_SCRIPT_LOADED)}catch{this.sendTracking(Y.SEGMENTS_SCRIPT_ERROR_LOADING)}}async addMatchesScript(){if(!(this.matchesScriptAdded||!this.consent))try{await H(bs),this.matchesScriptAdded=!0,this.sendTracking(Y.MATCHES_SCRIPT_LOADED)}catch{this.sendTracking(Y.MATCHES_SCRIPT_ERROR_LOADING)}}async initialize(){this.isInitialized||(this.updateTargeting(),await this.addMatchesScript(),this.isInitialized=!0)}}const se="-1",Es="https://pub.doubleverify.com/signals/pub.json",As="28150781",_s="DV1001654",Dt=window.location.href,ys={abs:se,bsc:se,ids:se},Ot=["top_leaderboard","top_boxad","incontent_boxad","bottom_leaderboard","incontent_leaderboard","gallery_leaderboard","featured","incontent_player","mpu_top","mpu-plus-top","cdm-zone-01","cdm-zone-02","cdm-zone-03","cdm-zone-04","cdm-zone-06"];class vs extends g{constructor(){super(...arguments);s(this,"name","DoubleVerifyPlugin");s(this,"adNodeManager");s(this,"gptWrapper");s(this,"consent",!1);s(this,"initialized",!1);s(this,"trackedSlots",{});s(this,"hooks",{onConsentUpdated:e=>{w(e)&&(this.consent=!0,this.initialize())},onAdEngineInit:e=>{this.gptWrapper=e.gptWrapper,this.adNodeManager=e.adNodeManager,this.initialize()}})}getDebugState(){return{isInitialized:this.initialized,trackedSlotNames:Object.keys(this.trackedSlots)}}static isEnabled({icDoubleVerify:e}){return!!e}buildRequestUrl(){const e=new URL(Es),t=e.searchParams;t.set("ctx",As),t.set("cmp",_s),t.set("url",Dt);for(const r of Object.keys(this.trackedSlots))t.append(`adunits[${r}][]`,"");return e}async fetchData(){if(!this.gptWrapper||!this.adNodeManager||!this.consent)return;const e=this.buildRequestUrl();try{const t=await fetch(e,{headers:{referer:Dt}});if(t.status>=400)return;const r=await t.json();this.handleResponse(r)}catch(t){h({message:"Failed to request data from DoubleVerify",error:t,priority:c.P3})}}handleResponse(e){const{ABS:t,BSC:r,IDS:o,TVP:a,VLP:d}=e;this.gptWrapper&&(this.gptWrapper.setTargeting("abs",t),this.gptWrapper.setTargeting("bsc",r),this.gptWrapper.setTargeting("ids",o.toString())),this.setTargetingForSlots("tvp",a),this.setTargetingForSlots("vlp",d)}setTargetingForSlots(e,t={}){for(const[r,o]of Object.entries(t)){const a=this.trackedSlots[r];a==null||a.setTargeting(e,o[""])}}initialize(){if(!this.consent||!this.gptWrapper||!this.adNodeManager||this.initialized)return;for(const[t,r]of Object.entries(ys))this.gptWrapper.setTargeting(t,r);const e=this.adNodeManager.getAdNodes();for(const t of e){if(!Ot.includes(t.getBaseSlotName())&&!Ot.includes(t.getSlotName()))continue;t.setTargeting("vlp",se),t.setTargeting("tvp",se);const r=t.getAdUnitPath();r?this.trackedSlots[r]=t:E({message:`[DoubleVerifyPlugin] AdUnitPath for ${t.getSlotName()} not defined. Skipping slot`,priority:c.P4})}this.initialized=!0,this.fetchData()}}class Is extends g{constructor(){super(...arguments);s(this,"name","InterstitialPlugin");s(this,"gpt");s(this,"hooks",{onAdEngineInit:e=>{if(this.gpt=e.gptWrapper,!this.shouldLoadInterstitial())return;const t=e.adNodeManager.getAdNodeByName("interstitial");t&&this.listenForNonFanTakeoverTopSlotRenderAndRequestInterstitial(e,t,()=>{this.listenForImpressionViewableOnInterstitialAndSetInterstitialImpression(e,t)})}});s(this,"api",{onCeltraInterstitialImpression:()=>{this.setCappingCookieAndInterstitialDisabledTargeting()}})}getDebugState(){var t,r;return{isCappingCookieSet:!!k.get("_ae_intrsttl_imp"),isPageReloaded:this.isPageReloaded(),hasInterstitialDisabledTargeting:((r=(t=this.gpt)==null?void 0:t.getTargeting("bundles"))==null?void 0:r.includes("interstitial_disabled"))??!1}}isPageReloaded(){if(!window.performance)return;const e=performance.getEntriesByType("navigation")[0];return(e==null?void 0:e.type)==="reload"}setCappingCookieAndInterstitialDisabledTargeting(){k.set("_ae_intrsttl_imp","1",{expires:864e5,domain:Gt(),path:"/"}),this.setInterstitialDisabledTargeting()}setInterstitialDisabledTargeting(){if(this.gpt){const e=this.gpt.getTargeting("bundles")||[];e.push("interstitial_disabled"),this.gpt.setTargeting("bundles",e)}}markAnchorTagsWithImgTagsAsInterstitialIneligible(){for(const e of document.querySelectorAll("a"))e.querySelector("img")&&e.setAttribute("data-google-interstitial","false")}shouldLoadInterstitial(){return k.get("_ae_intrsttl_imp")||this.isPageReloaded()?(this.setInterstitialDisabledTargeting(),!1):te()}listenForNonFanTakeoverTopSlotRenderAndRequestInterstitial(e,t,r){const o=e.gptWrapper.addSlotEventListener(M,"slotRenderEnded",a=>{Ei(a)||(this.markAnchorTagsWithImgTagsAsInterstitialIneligible(),e.adRenderManager.requestRender([t]),r()),o()})}listenForImpressionViewableOnInterstitialAndSetInterstitialImpression(e,t){const r=e.gptWrapper.addSlotEventListener(t.getSlotName(),"impressionViewable",()=>{this.setCappingCookieAndInterstitialDisabledTargeting(),r()})}}function Xe(n,i,e){return n===i&&e!==void 0&&e!==null}class Cs extends g{constructor(){super(...arguments);s(this,"name","JWPlayerRTDPrebidPlugin");s(this,"JWP_RTD_AUCTION_DELAY",100);s(this,"hooks",{onBiddersInit:()=>{const e=this.usePlugin(v);e==null||e.addPrebidReadyCallback(t=>{t.mergeConfig(this.configureJwpRtd())})},onCreateBidderAdUnit:(e,t,r)=>{Xe("prebid",e,r)&&r.forEach(o=>{var a;(a=o.mediaTypes)!=null&&a.video&&(o.ortb2Imp=this.extendOrtbWithJwpRtdData(o.ortb2Imp))})}})}static isEnabled(e){var t;return!!((t=window.canPlayVideo)!=null&&t.call(window))&&e.icFeaturedVideoPlayer==="jwp-video-player"}configureJwpRtd(){const e=this.getMediaId();return{realTimeData:{auctionDelay:this.JWP_RTD_AUCTION_DELAY,dataProviders:[{name:"jwplayer",waitForIt:!0,params:{mediaIDs:e?[e]:[]}}]}}}extendOrtbWithJwpRtdData(e={}){var r;const t=this.getMediaId();return t?{...e,ext:{...e.ext,data:{...((r=e.ext)==null?void 0:r.data)??{},jwTargeting:{mediaID:t}}}}:e}getMediaId(){var r,o,a;if(typeof jwplayer<"u"){const d=(r=jwplayer().getPlaylistItem())==null?void 0:r.mediaid;if(d)return d}const e=Eo(),t=(a=(o=e==null?void 0:e.playlist)==null?void 0:o[0])==null?void 0:a.mediaid;return t||E({message:"JWPlayerRTDPrebidPlugin: No mediaId found in the featured video config.",priority:c.P3}),t}}const Ps="//cdn.adsafeprotected.com/iasPET.1.js",Rs="930616",Ft=["adt","alc","dlm","drg","hat","off","vio"],Mt={veryLow:1,low:2,medium:3,high:4},xt={default:[],fandomdesktop:["top_leaderboard","top_boxad","incontent_boxad","incontent_leaderboard","bottom_leaderboard","gallery_leaderboard","featured","incontent_player"],fandommobile:["top_leaderboard","top_boxad","incontent_boxad","bottom_leaderboard","featured","incontent_player","drawer"],f2:["top_leaderboard","top_boxad","incontent_boxad","bottom_leaderboard","featured"],comicvine:["mpu_top"],gamefaqs:["mpu_top"],gamespot:["mpu_top"],giantbomb:["mpu_top"],metacritic:["mpu_plus_top"],"metacritic-neutron":["mpu-plus-top"],tvguide:["mpu-plus-top"],sports:["cdm-zone-01","cdm-zone-02","cdm-zone-03","cdm-zone-04","cdm-zone-06"]};function Ii(n){return Array.isArray(n)?n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"?n:n.length===1&&n[0]==="fluid"?"fluid":Array.isArray(n[0])?Ii(n[0]):[1,1]:n==="fluid"?"fluid":[1,1]}class ws extends g{constructor(){super(...arguments);s(this,"name","IasPublisherOptimizationPlugin");s(this,"gptWrapper");s(this,"adNodeManager");s(this,"consent",!1);s(this,"initialized",!1);s(this,"hooks",{onConsentUpdated:e=>{w(e)&&(this.consent=!0,this.initialize())},onBeforeFirstCallAdsRequest:()=>{this.setInitialAdNodesTargeting()},onInitPageTargeting:e=>{e.fr="-1",e.b_ias="-1",e["ias-kw"]="-1",Ft.forEach(t=>{e[t]="-1"})},onAdEngineInit:e=>{this.adNodeManager=e.adNodeManager,this.gptWrapper=e.gptWrapper,this.initialize()}})}static isEnabled(e){return!!(e!=null&&e.icIASPublisherOptimization)}async initialize(){if(!(!this.consent||!this.gptWrapper||!this.adNodeManager||this.initialized))try{this.initialized=!0,this.setup(),await be("ias-publisher-optimization",Ps)}catch{}}setup(){window.__iasPET=window.__iasPET??{},window.__iasPET.queue=window.__iasPET.queue??[],window.__iasPET.pubId=Rs,window.__iasPET.queue.push({adSlots:this.getPETSlots(),dataHandler:this.iasDataHandler.bind(this)})}setInitialAdNodesTargeting(){this.getWatchedAdNodes().forEach(e=>{e.getTargeting("vw").length===0&&e.setTargeting("vw","-1")})}getPETSlots(){const e=[];return this.getWatchedAdNodes().forEach(t=>{const r=this.getSlotSize(t),o={adUnitPath:t.getAdUnitPath()??"",adSlotId:t.getSlotName(),size:r};t.getSlotType()==="video"&&(o.type="video",o.size=[1,1]),e.push(o)}),e}getSlotSize(e){const t=e.getDefaultSizes(),r=Ii(t);return Array.isArray(r)?r:[1,1]}getWatchedAdNodes(){var t;return(((t=this.adNodeManager)==null?void 0:t.getAdNodes())??[]).filter(r=>this.getWatchedSlotList().includes(r.getSlotName())||this.getWatchedSlotList().includes(r.getBaseSlotName()))}getWatchedSlotList(){return xt[Te()]??xt.default}iasDataHandler(e){try{const t=JSON.parse(e);this.updateGenericTargeting(t),this.updateSlotTargeting(t),this.updateBrandSafetyTargeting(t)}catch(t){h({message:"Failed to parse IAS targeting data",error:t,priority:c.P3})}}updateGenericTargeting(e){var t,r;(t=this.gptWrapper)==null||t.setTargeting("fr",(e==null?void 0:e.fr)??""),e.custom&&e.custom["ias-kw"]&&((r=this.gptWrapper)==null||r.setTargeting("ias-kw",e.custom["ias-kw"]))}updateSlotTargeting(e){var t;if(e.slots)for(const[r,o]of Object.entries(e.slots))(t=this.gptWrapper)==null||t.setSlotTargeting(r,"vw",o.vw??o.vw_vv)}updateBrandSafetyTargeting(e){var t;if(e.brandSafety){const r=e.brandSafety;let o;Ft.forEach(a=>{var d;r[a]&&((d=this.gptWrapper)==null||d.setTargeting(a,r[a]),(typeof o>"u"||Mt[o]<Mt[r[a]])&&(o=r[a]))}),(t=this.gptWrapper)==null||t.setTargeting("b_ias",o??"-1")}}}function Ns(){(function(n,i){n[i]=n[i]||{nlsQ:function(e,t,r,o,a,d){return a=n.document,o=a.createElement("script"),o.defer=1,o.src=(n.location.protocol==="http:"?"http:":"https:")+"//cdn-gl.imrworldwide.com/conf/"+e+".js#name="+t+"&ns="+i,d=a.getElementsByTagName("script")[0],d.parentNode.insertBefore(o,d),n[i][t]=n[i][t]||{g:r||{},ggPM:function(l,u,b,I,N){(n[i][t].q=n[i][t].q||[]).push([l,u,b,I,N])}},n[i][t]}}})(window,"NOLBUNDLE")}class Bs extends g{constructor(){super();s(this,"name","NielsenPlugin");s(this,"NIELSEN_KEY","P26086A07-C7FB-4124-A679-8AC404198BA7");s(this,"nielsenWindowConfig",{});s(this,"isLoaded",!1);s(this,"gptWrapper");s(this,"consent",!1);s(this,"hooks",{onConsentUpdated:e=>{this.consent=w(e),this.consent&&this.init()},onAfterGptWrapperInit:e=>{this.gptWrapper=e,this.consent&&this.init()}})}getDebugState(){return{isScriptLoaded:this.isLoaded,isDebugModeEnabled:this.nielsenWindowConfig.nol_sdkDebug==="debug"}}static isEnabled({icNielsen:e}){return!!e}getNielsenInstance(){return Ns(),G("nielsen-dcr-debug")&&(this.nielsenWindowConfig.nol_sdkDebug="debug"),window==null?void 0:window.NOLBUNDLE.nlsQ(this.NIELSEN_KEY,"nlsnInstance",this.nielsenWindowConfig)}init(){var d,l,u;if(this.isLoaded||!this.gptWrapper)return;const e=this.getNielsenInstance(),t=(d=this.gptWrapper.getTargeting("s0v"))==null?void 0:d.join(","),r=(l=this.gptWrapper.getTargeting("artid"))==null?void 0:l.join(","),o=(u=this.gptWrapper.getTargeting("s1"))==null?void 0:u.join(","),a={type:"static",assetid:`fandom.com/${t}/${o}/${r}`,section:`FANDOM ${t==null?void 0:t.replace(/_/g," ").toUpperCase()} NETWORK`};e.ggPM("static",a),this.isLoaded=!0}}const we=class we extends g{constructor(){super(...arguments);s(this,"name","BlockthroughReadershipLinkPlugin");s(this,"isInitialized",!1);s(this,"adEngine",null);s(this,"hooks",{onConsentUpdated:e=>{w(e)&&this.initialize()},onAdEngineInit:e=>{this.adEngine=e},onBeforeAdsRequest:e=>{var o;const t=(o=this.adEngine)==null?void 0:o.monetizationTierEngine;if(!t){h({message:"Monetization tier engine is not available, cannot add Blockthrough readership link classes",priority:c.P2});return}const r=`tier${t.getCurrentTier()}`;for(const a of e){const d=a.getElement();d&&!d.classList.contains(r)&&d.classList.add(r)}}})}static isEnabled({icBlockthroughReadershipLink:e}){return X()!==rt?!1:!!e}adjustPrebidAdserverTargetingConfig(){var e;(e=this.usePlugin(v))==null||e.addPrebidReadyCallback(t=>{t.bidderSettings=tt(t.bidderSettings,fr)})}async initialize(){if(!this.isInitialized){this.isInitialized=!0;try{f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"bt-loader_started",time:performance.now()}),this.adjustPrebidAdserverTargetingConfig(),await H(we.SCRIPT_URL),f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"bt-loader_loaded",time:performance.now()})}catch{f(_,{type:S.VENDOR_TIME_UPDATE,eventName:"bt-loader_error_loading",time:performance.now()})}}}};s(we,"SCRIPT_URL","https://btloader.com/tag?o=5199505043488768&upapi=true");let Ze=we;class Ci extends g{constructor(){super();s(this,"name","AdLabelPlugin");s(this,"translatedAdLabel");s(this,"excludedSlots",new Set(["top_leaderboard","floor_adhesion","left_panel_ad","mobile_drawer_ad"]));s(this,"hooks",{onAdEngineInit:e=>{this.registerSlotRenderHandler(e.gptWrapper)}});s(this,"api",{addLabelToSlot:e=>{this.addLabelToSlot(e)}});const e=document.querySelector(".ae-translatable-label");this.translatedAdLabel=e instanceof HTMLElement?e:null}addLabelToSlot(e){if(this.excludedSlots.has(e))return;const t=document.getElementById(e);if(!t||!this.translatedAdLabel)return;const r=`label-${e}`;if(document.getElementById(r))return;const o=this.cloneTranslatedLabel(r);t.appendChild(o)}registerSlotRenderHandler(e){e.addEventListener("slotRenderEnded",t=>{const r=t.slot.getSlotElementId();t.isEmpty||this.addLabelToSlot(r)})}cloneTranslatedLabel(e){const t=this.translatedAdLabel.cloneNode(!0);t.classList.remove("dsa-advertisement-label-clickable"),t.id=e;const r=t.querySelector(".dsa-advertisement-label-icon");return r==null||r.remove(),t}getDebugState(){return{hasTranslatedLabel:!!this.translatedAdLabel,excludedSlotNames:Array.from(this.excludedSlots)}}}class ks extends g{constructor(e){super();s(this,"name","PrebidIdSyncingPlugin");s(this,"YAHOO_BIT",0);s(this,"ID5_BIT",1);s(this,"HEM_BIT",2);s(this,"LIVEINTENT_BIT",3);s(this,"PUBCID_BIT",4);s(this,"UID2_BIT",5);s(this,"LIVE_RAMP_ATS_BIT",6);s(this,"UID_BIT",7);s(this,"BIT_PLACEHOLDER","x");s(this,"ID_STRING_LENGTH",16);s(this,"PRESENT_PLACEHOLDER","P");s(this,"ABSENT_PLACEHOLDER","A");s(this,"LIVE_CONNECT_PLACEHOLDER","L");s(this,"MEDIA_WIKI_PLACEHOLDER","M");s(this,"pbjs");s(this,"ID_MAP",{[this.YAHOO_BIT]:e=>this.getDefaultBitStatus(e,"yahoo.com"),[this.ID5_BIT]:e=>this.getDefaultBitStatus(e,"id5-sync.com"),[this.HEM_BIT]:()=>this.getHEMBitStatus(),[this.LIVEINTENT_BIT]:e=>this.getDefaultBitStatus(e,"liveintent.com"),[this.PUBCID_BIT]:e=>this.getDefaultBitStatus(e,"pubcid.org"),[this.UID2_BIT]:e=>this.getDefaultBitStatus(e,"uidapi.com"),[this.LIVE_RAMP_ATS_BIT]:e=>this.getDefaultBitStatus(e,"liveramp.com"),[this.UID_BIT]:e=>this.getDefaultBitStatus(e,"adserver.org")});s(this,"hooks",{onBiddersInit:e=>{var t;this.configureLiveIntentTargeting(e),(t=this.usePlugin(v))==null||t.addPrebidReadyCallback(r=>{this.pbjs=r,this.pbjs.onEvent("requestBids",()=>{this.generateBoiAndSyncGptTargeting(e),this.updateLiveIntentTargeting(e)})})}});this.config=e}getDebugState(){return{boiString:this.generateBoiString()}}getDefaultBitStatus(e,t){return e.find(r=>r.source===t)?this.PRESENT_PLACEHOLDER:this.ABSENT_PLACEHOLDER}getHEMBitStatus(){var e,t,r;switch(!0){case this.checkIfLiveConnectSha2HEMIsPresent():return this.LIVE_CONNECT_PLACEHOLDER;case!!((r=(t=(e=ri())==null?void 0:e.opts)==null?void 0:t.userEmailHashes)!=null&&r.length):return this.MEDIA_WIKI_PLACEHOLDER;default:return this.ABSENT_PLACEHOLDER}}configureLiveIntentTargeting(e){var o;const t=this.config.icLiveIntentConnectedId,r=t?"t1":"t0";if((o=e.gptWrapper)==null||o.setTargeting("li-module-enabled",[r]),!t){window.liModuleEnabled=!1;return}window.liModuleEnabled=!0}updateLiveIntentTargeting(e){var r;if(!this.config.icLiveIntentConnectedId)return;const t=this.getIds().some(o=>o.source.includes("liveintent.com"));(r=e.gptWrapper)==null||r.setTargeting("li-module-enabled",[`t1-${t?"e1":"e0"}`])}getIds(){var e;return((e=this.pbjs)==null?void 0:e.getUserIdsAsEids())??[]}generateBoiString(){const e=this.getIds();let t="";for(let r=0;r<this.ID_STRING_LENGTH;r++){const o=this.ID_MAP[r];if(o){const a=o(e);t+=a}else t+=this.BIT_PLACEHOLDER}return t}generateBoiAndSyncGptTargeting(e){const t=this.generateBoiString();e.gptWrapper.setTargeting("boi",t),this.getIds().forEach(r=>{var o;(o=r.uids[0])!=null&&o.id&&f(et.IDENTITY_INFO,{partnerName:r.source,partnerIdentityId:r.uids[0].id})})}checkIfLiveConnectSha2HEMIsPresent(){var e;try{return((e=this.usePlugin(ne))==null?void 0:e.checkIfSha2HemAvailable())??!1}catch{return!1}}}const Ne=class Ne extends g{constructor(){super(...arguments);s(this,"name","InContentBoxadPlugin");s(this,"adEngine");s(this,"adNodes",[]);s(this,"blockedSlots",new Set);s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,this.adNodes=this.adEngine.adNodeManager.getAdNodesByBaseName(Ne.IN_CONTENT_BOXAD_BASE_SLOT_NAME)}});s(this,"api",{block:e=>{var r;const t=this.getAdNodes(e);try{T((r=this.adEngine)==null?void 0:r.adNodeManager,"adNodeManager is not defined");for(const o of t)this.blockSlot(o)}catch(o){h({message:"Could not block slots",error:o,priority:c.P3})}},unblock:e=>{var r;const t=this.getAdNodes(e);try{T((r=this.adEngine)==null?void 0:r.adNodeManager,"adNodeManager is not defined");for(const o of t)this.unblockSlot(o)}catch(o){h({message:"Could not unblock slots",error:o,priority:c.P3})}}})}getAdNodes(e){return e===void 0?this.adNodes:e<0||e>=this.adNodes.length?[]:[this.adNodes[e]]}blockSlot(e){var r;(r=this.adEngine)==null||r.adNodeManager.blockSlot(e.getSlotName()),this.blockedSlots.add(e.getSlotName());const t=e.getElement();t&&(t.style.display="none")}unblockSlot(e){var r;(r=this.adEngine)==null||r.adNodeManager.unblockSlot(e.getSlotName()),this.blockedSlots.delete(e.getSlotName());const t=e.getElement();t&&(t.style.display="")}};s(Ne,"IN_CONTENT_BOXAD_BASE_SLOT_NAME","incontent_boxad");let Pe=Ne;class Ls{constructor(i){s(this,"experimentPluginMap",new Map);this.pluginClasses=i;const e=this.identifyActiveExperiment();if(e){for(const t of i)if(t.experimentName==e.name){const r=new t;r.setExperimentGroup(e.group),this.experimentPluginMap.set(r.experimentName,r)}}}checkExpiration(i){const e=i.codeDeletionDate;new Date().getTime()>=e.getTime()&&E({message:`Experiment ${i.experimentName} has passed its codeDeletionDate`,priority:c.P4})}identifyActiveExperiment(){const i=Be("force-sse");if(i){const e=Si(i);if(e)return e}return yo()}getExperimentPlugins(){return[...this.experimentPluginMap.values()]}}const We="control";class Le extends g{constructor(){super();s(this,"experimentName");s(this,"currentGroup",We);this.experimentName=this.constructor.experimentName}getDebugState(){return{experimentName:this.experimentName,currentGroup:this.currentGroup,variantNames:[...this.variantNames],codeDeletionDate:this.codeDeletionDate.toISOString()}}setExperimentGroup(e){[We].concat(this.variantNames).includes(e)?this.currentGroup=e:(h({message:`Unknown experiment group "${e}" set for ${this.experimentName}; defaulting to control`,priority:c.P2}),this.currentGroup=We)}}s(Le,"experimentName","missing");const Pi=198157,Ds={pubId:Pi,slots:{top_leaderboard:{widgetId:287601},top_boxad:{widgetId:287602},incontent_leaderboard:{widgetId:287605},incontent_boxad:{widgetId:287603},bottom_leaderboard:{widgetId:287604}}},Os={pubId:Pi,slots:{top_leaderboard:{widgetId:287606},top_boxad:{widgetId:287607},incontent_boxad:{widgetId:287609},bottom_leaderboard:{widgetId:287610},floor_adhesion:{widgetId:287613}}},Fs={fandomdesktop:Ds,fandommobile:Os};function Ms(n){return Fs[n]??void 0}class Ri extends Le{constructor(){super();s(this,"name","ExpMuse15028");s(this,"variantNames",["variant1"]);s(this,"codeDeletionDate",new Date("2025-12-01"));s(this,"hasConsent",!1);s(this,"config");s(this,"adEngine");s(this,"hooks",{onConsentUpdated:e=>{w(e)&&!this.hasConsent&&(this.hasConsent=!0,this.addRevContentElementsToAdNodes())},onAdNodeCreated:e=>{this.addRevContentElementsToAdNode(e)},onAdEngineInit:e=>{var t;!this.adEngine&&this.currentGroup==="variant1"&&e.monetizationTierEngine.isNotSuitableForAdvertising()&&!((t=window.fandomContext)!=null&&t.site.directedAtChildren)&&(this.adEngine=e,this.addRevContentElementsToAdNodes())}});const e=Te();this.config=Ms(e)}addRevContentElementsToAdNodes(){var e;(e=this.adEngine)==null||e.adNodeManager.getAdNodes().forEach(t=>{this.addRevContentElementsToAdNode(t)})}getWidgetId(e){const{slots:t={}}=this.config??{},r=t[e.getSlotName()]??t[e.getBaseSlotName()];return r==null?void 0:r.widgetId}addRevContentElementsToAdNode(e){var l;if(!this.hasConsent||!this.adEngine)return;const t=e.getElement();if(!t||t.dataset.revContent==="true")return;const{pubId:r}=this.config??{},o=this.getWidgetId(e);if(!r||!o)return;const a=document.createElement("div");a.dataset.widgetHost="revcontent",a.dataset.pubId=`${r}`,a.dataset.widgetId=`${o}`,a.style.background="#FFF",t.appendChild(a);const d=document.createElement("script");d.src=`https://delivery.revcontent.com/${r}/${o}/widget.js`,d.defer=!0,t.appendChild(d),t.dataset.revContent="true",(l=this.usePlugin(Ci))==null||l.addLabelToSlot(e.getSlotName())}}s(Ri,"experimentName","muse-15028");class wi extends Le{constructor(){super(...arguments);s(this,"name","ExpMuse15130");s(this,"variantNames",["variant1"]);s(this,"codeDeletionDate",new Date("2025-12-01"));s(this,"pageViewNumber",1);s(this,"takeoverStatus",Ae);s(this,"dialActivated",!1);s(this,"hooks",{onAdEngineInit:e=>{this.shouldRunExperiment()&&this.init(e)},onFirstRenderCycleComplete:(e,t,r)=>{if(!(!this.shouldRunExperiment()||this.pageViewNumber===1)){if(this.dialActivated){this.setTakeoverCookie(this.takeoverStatus);return}this.takeoverStatus=r,this.setTakeoverCookie(r)}}})}shouldRunExperiment(){return this.currentGroup==="variant1"}init(e){const{pageViewNumber:t,takeoverStatus:r}=this.readCookies();this.pageViewNumber=t,this.takeoverStatus=r,this.canActivateDial(this.pageViewNumber,this.takeoverStatus)&&this.activateDial(e),this.updateTargeting(e,this.takeoverStatus)}activateDial(e){this.dialActivated=!0,e.adRenderManager.isFirstRenderCycleComplete=!0}updateTargeting(e,t){e.gptWrapper.setTargeting("odyssey_takeover",t)}readCookies(){const e=parseInt(k.get("pvNumberGlobal")??""),t=isNaN(e)?1:e,r=k.get("odyssey_takeover"),o=this.isValidTakeoverStatus(r)?r:Ae;return{pageViewNumber:t,takeoverStatus:o}}canActivateDial(e,t){const r=e>2,o=[qe,$e].includes(t);return r&&o}isValidTakeoverStatus(e){return[Ae,$e,ni,qe].includes(e)}setTakeoverCookie(e){k.set("odyssey_takeover",e,{path:"/",expires:1800,domain:".fandom.com"})}}s(wi,"experimentName","muse-15130");class Ni extends Le{constructor(){super(...arguments);s(this,"name","ExpUxfcp4592");s(this,"variantNames",["variant1","variant2"]);s(this,"codeDeletionDate",new Date("2025-11-12"));s(this,"hooks",{onAdEngineInit:()=>{this.shouldRunExperiment()&&this.blockIncontentBoxads()},onInitSlotConfigMap:e=>{this.shouldRunExperiment()&&this.updateIncontentBoxadConfig(e)}})}updateIncontentBoxadConfig(e){var d,l;const t=".mw-parser-output > h2",r="before",o=(d=e.baseSlots)==null?void 0:d.incontent_boxad,a=(l=o==null?void 0:o.dynamic)==null?void 0:l.repeat;a&&(a.selector=t,a.insertMethod=r,a.minDistanceBetweenAds=0)}shouldRunExperiment(){return te()&&(this.currentGroup==="variant1"||this.currentGroup==="variant2")}blockIncontentBoxads(){var e;(e=this.usePlugin(Pe))==null||e.block()}}s(Ni,"experimentName","uxfcp-4592");const xs="https://ats-wrapper.privacymanager.io/ats-modules/2be88350-78eb-4214-96b8-3a489d2aa7d6/ats.js";class Us extends g{constructor(){super(...arguments);s(this,"name","LiveRampATSPlugin");s(this,"initialized",!1);s(this,"isScriptLoaded",!1);s(this,"hooks",{onConsentUpdated:e=>{if(!w(e)){this.shouldClearEnvelope(e)&&this.processOptOut();return}this.initialize()}})}static isEnabled(e){return e.icPrebidLiveRampATS}async initialize(){if(!this.initialized){this.initialized=!0;try{const e=this.usePlugin(ne);if(!e)return;await this.loadScript(),await this.processHems(e)}catch(e){E({message:"LiveRamp ATS initialization failed",priority:c.P3,error:e})}}}async loadScript(){if(!this.isScriptLoaded)try{this.isScriptLoaded=!0,await H({src:xs,isAsyncOrDeferOtherwise:!0,node:"first"})}catch(e){this.isScriptLoaded=!1,E({message:"LiveRamp ATS script failed to load",priority:c.P3,error:e})}}async processHems(e){const t=await e.waitForHems();if(!t)return;const r=[t.sha1,t.sha2,t.md5].filter(a=>!!a);if(r.length===0)return;this.setupLrEnvelopePresentListener(),(await this.getAtsModule()).setAdditionalData({type:"emailHashes",id:r})}getAtsModule(){return new Promise(e=>{if(window.atsenvelopemodule)return e(window.atsenvelopemodule);window.addEventListener("envelopeModuleReady",()=>{e(window.atsenvelopemodule)},{once:!0})})}setupLrEnvelopePresentListener(){window.addEventListener("lrEnvelopePresent",()=>{const e=this.usePlugin(v);e==null||e.addPrebidReadyCallback(t=>{t.refreshUserIds({submoduleNames:[ci]})})},{once:!0})}shouldClearEnvelope(e){return(e==null?void 0:e.consentApi)==="usp"}async processOptOut(){await this.loadScript(),(await this.getAtsModule()).invalidateEnvelope(),this.initialized=!1}}const Vs=n=>n.getEvents().some(i=>{var e,t;return i.eventType==="auctionDebug"&&((e=i.args)==null?void 0:e.type)==="WARNING"&&typeof((t=i.args)==null?void 0:t.arguments)<"u"&&[...i.args.arguments].some(r=>String(r).includes("TCF timeout waiting for CMP to load"))}),Ws=()=>typeof window.OneTrust<"u"&&typeof window.OneTrust.geolocationResponse=="object"&&typeof window.OneTrust.UpdateConsent=="function",le=class le extends g{constructor(e){super();s(this,"name","AuctionCmpTrackingPlugin");s(this,"state",{cmpApiAvailable:!1,oneTrustAvailable:!1,auctionStarted:!1,auctionTimedOut:0,adsRendered:!1,numberOfIdPartners:0});s(this,"trackingSent",!1);s(this,"cleanup",()=>{});s(this,"hooks",{onBiddersInit:()=>{var e;this.enabled&&(this.setTimeoutForTracking(),(e=this.usePlugin(v))==null||e.addPrebidReadyCallback(t=>{t.onEvent("auctionInit",()=>{this.setTimeoutForTracking(),this.state.cmpApiAvailable=!Vs(t),this.state.oneTrustAvailable=Ws(),this.state.auctionStarted=!0}),t.onEvent("auctionTimeout",()=>{this.setTimeoutForTracking(),this.state.auctionTimedOut=1}),t.onEvent("auctionEnd",()=>{this.setTimeoutForTracking(),this.state.numberOfIdPartners=t.getUserIdsAsEids().length})}))},onFirstRenderCycleComplete:(e,t)=>{this.enabled&&(this.state.adsRendered=t.length>0,this.trackingSent||(this.cleanup(),this.sendTracking()))}});this.config=e}get enabled(){return!!this.config.odysseyAuctionCmpTracking}setTimeoutForTracking(e=2*this.config.icAdEngineAuctionTimeoutMS){this.cleanup();const t=setTimeout(()=>{this.trackingSent||(this.state.auctionTimedOut=2,this.sendTracking())},e);this.cleanup=()=>clearTimeout(t)}getConsentRegion(){var t;const e=(t=window.fandomCmp)==null?void 0:t.consentApi;return e==="usp"?"US":e==="tcf"?"EU":"RoW"}encodeState(){return Object.values(this.state).map(e=>typeof e=="boolean"?Number(e):e).join(",")}sendTracking(){this.enabled&&(this.trackingSent=!0,f(jt.TRACKING_EVENT,{event_type:le.TRACKING_EVENT_NAME,ga_category:le.TRACKING_EVENT_NAME,ga_label:this.getConsentRegion(),ga_value:this.encodeState()}))}getDebugState(){return{isEnabled:this.enabled,hasTrackingSent:this.trackingSent,cmpApiAvailable:this.state.cmpApiAvailable,oneTrustAvailable:this.state.oneTrustAvailable,hasAuctionStarted:this.state.auctionStarted,auctionTimeoutStatus:this.state.auctionTimedOut,hasAdsRendered:this.state.adsRendered,numberOfIdPartners:this.state.numberOfIdPartners,consentRegion:this.getConsentRegion(),encodedState:this.encodeState()}}};s(le,"TRACKING_EVENT_NAME","odyssey_cmp_tracking");let Je=le;const zs={fandomdesktop:{baseSlots:["incontent_leaderboard","bottom_leaderboard","floor_adhesion","lightbox_leaderboard","mid_boxad","left_panel_ad"],videoSlots:["featured","incontent_player"]},fandommobile:{baseSlots:["incontent_boxad","bottom_leaderboard","interstitial","lightbox_leaderboard","mobile_drawer_ad"],videoSlots:["featured","incontent_player"]}};function Gs(n){n.bundles=n.bundles??[],n.bundles.includes("exclusion_list")||n.bundles.push("exclusion_list")}class Hs extends g{constructor(){super();s(this,"name","RegisteredUserPlugin");s(this,"config");s(this,"removedSlots",{baseSlots:new Set,videoSlots:new Set});s(this,"hooks",{onInitSlotConfigMap:e=>{const t=X();t===Tt?this.removeSlotsForRegisteredUsers(e):t===Bn&&this.removeAllSlots(e)},onInitPageTargeting:e=>{X()!==rt&&Gs(e)},onAfterAdNodeManagerInit:e=>{X()===Tt&&this.collapseAdsWhenCommentsEnterViewport(e)}});this.config=zs}getDebugState(){return{config:this.config,removedSlots:this.removedSlots,userState:X()}}removeSlots(e,t){var r,o;(r=t.baseSlots)==null||r.forEach(a=>{e.baseSlots[a].isDisabled=!0,this.removedSlots.baseSlots.add(a)}),(o=t.videoSlots)==null||o.forEach(a=>{e.videoSlots[a].isDisabled=!0,this.removedSlots.videoSlots.add(a)}),this.removeAdNodeComponents(t)}removeSlotsForRegisteredUsers(e){const{app:t}=e,r=this.config[t];this.removeSlots(e,r)}removeAllSlots(e){this.removeSlots(e,{baseSlots:Object.keys(e.baseSlots),videoSlots:Object.keys(e.videoSlots)}),this.removeTopLeaderboardWrapper()}removeAdNodeComponents(e){var t,r;(t=e.baseSlots)==null||t.forEach(o=>{var a;return(a=document.querySelector(`${y.ELEMENT_NAME}#${o}`))==null?void 0:a.remove()}),(r=e.videoSlots)==null||r.forEach(o=>{var a;return(a=document.querySelector(`${D.ELEMENT_NAME}#${o}`))==null?void 0:a.remove()})}getCommentsContainer(e){let t="";return e===ze.FANDOM_DESKTOP?t="#articleComments":e===ze.FANDOM_MOBILE&&(t=".article-comments-collapsible-menu"),document.querySelector(t)}collapseAdsWhenCommentsEnterViewport(e){const t=e.getSlotConfigMap().app,r=this.getCommentsContainer(t),o=document.querySelector("#article-discussions");if(!r&&!o)return;const a={root:null,rootMargin:"0px 0px 100px 0px",threshold:0},d=new IntersectionObserver(l=>{l.forEach(u=>{u.isIntersecting&&(e.getAdNodes().forEach(b=>{b.collapse(),b.destroy()}),this.removeTopLeaderboardWrapper(),d.disconnect())})},a);r&&d.observe(r),o&&d.observe(o)}removeTopLeaderboardWrapper(){var e;(e=document.querySelector(".top_leaderboard-odyssey-wrapper"))==null||e.remove()}wasSlotRemoved(e){return this.removedSlots.baseSlots.has(e)||this.removedSlots.videoSlots.has(e)||!1}}const p=n=>i=>{if(!i)return ue.data.default;for(const e of n)if(i>=e.minTlbBid)return e.floor;return ue.data.default},$s=[{criteria:{baseSlotName:"bottom_leaderboard",tier:"3",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.19},{minTlbBid:1.85,floor:.14},{minTlbBid:1.6,floor:.13},{minTlbBid:1.35,floor:.13},{minTlbBid:1.1,floor:.12},{minTlbBid:.85,floor:.12},{minTlbBid:.6,floor:.12},{minTlbBid:.35,floor:.12},{minTlbBid:.2,floor:.13},{minTlbBid:.15,floor:.12},{minTlbBid:.11,floor:.1},{minTlbBid:.1,floor:.1}])},{criteria:{baseSlotName:"bottom_leaderboard",tier:"4",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.25},{minTlbBid:1.85,floor:.22},{minTlbBid:1.6,floor:.28},{minTlbBid:1.35,floor:.24},{minTlbBid:1.1,floor:.24},{minTlbBid:.85,floor:.24},{minTlbBid:.6,floor:.21},{minTlbBid:.35,floor:.19},{minTlbBid:.2,floor:.17},{minTlbBid:.15,floor:.14},{minTlbBid:.11,floor:.11},{minTlbBid:.1,floor:.12}])},{criteria:{baseSlotName:"floor_adhesion",tier:"3",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.86},{minTlbBid:1.85,floor:.53},{minTlbBid:1.6,floor:.42},{minTlbBid:1.35,floor:.33},{minTlbBid:1.1,floor:.41},{minTlbBid:.85,floor:.32},{minTlbBid:.6,floor:.31},{minTlbBid:.35,floor:.27},{minTlbBid:.2,floor:.18},{minTlbBid:.15,floor:.15},{minTlbBid:.11,floor:.14},{minTlbBid:.1,floor:.15}])},{criteria:{baseSlotName:"floor_adhesion",tier:"4",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.58},{minTlbBid:1.85,floor:.46},{minTlbBid:1.6,floor:.46},{minTlbBid:1.35,floor:.47},{minTlbBid:1.1,floor:.46},{minTlbBid:.85,floor:.43},{minTlbBid:.6,floor:.4},{minTlbBid:.35,floor:.35},{minTlbBid:.2,floor:.25},{minTlbBid:.15,floor:.23},{minTlbBid:.11,floor:.23},{minTlbBid:.1,floor:.22}])},{criteria:{baseSlotName:"incontent_boxad",tier:"3",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.59},{minTlbBid:1.85,floor:.31},{minTlbBid:1.6,floor:.28},{minTlbBid:1.35,floor:.25},{minTlbBid:1.1,floor:.23},{minTlbBid:.85,floor:.21},{minTlbBid:.6,floor:.18},{minTlbBid:.35,floor:.16},{minTlbBid:.2,floor:.14},{minTlbBid:.15,floor:.13},{minTlbBid:.11,floor:.12},{minTlbBid:.1,floor:.11}])},{criteria:{baseSlotName:"incontent_boxad",tier:"4",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.52},{minTlbBid:1.85,floor:.39},{minTlbBid:1.6,floor:.35},{minTlbBid:1.35,floor:.34},{minTlbBid:1.1,floor:.29},{minTlbBid:.85,floor:.3},{minTlbBid:.6,floor:.27},{minTlbBid:.35,floor:.23},{minTlbBid:.2,floor:.18},{minTlbBid:.15,floor:.15},{minTlbBid:.11,floor:.13},{minTlbBid:.1,floor:.13}])},{criteria:{baseSlotName:"incontent_leaderboard",tier:"3",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.18},{minTlbBid:1.85,floor:.14},{minTlbBid:1.6,floor:.13},{minTlbBid:1.35,floor:.13},{minTlbBid:1.1,floor:.12},{minTlbBid:.85,floor:.12},{minTlbBid:.6,floor:.11},{minTlbBid:.35,floor:.11},{minTlbBid:.2,floor:.11},{minTlbBid:.15,floor:.11},{minTlbBid:.11,floor:.1},{minTlbBid:.1,floor:.1}])},{criteria:{baseSlotName:"incontent_leaderboard",tier:"4",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.3},{minTlbBid:1.85,floor:.24},{minTlbBid:1.6,floor:.21},{minTlbBid:1.35,floor:.23},{minTlbBid:1.1,floor:.19},{minTlbBid:.85,floor:.18},{minTlbBid:.6,floor:.16},{minTlbBid:.35,floor:.15},{minTlbBid:.2,floor:.13},{minTlbBid:.15,floor:.12},{minTlbBid:.11,floor:.11},{minTlbBid:.1,floor:.11}])},{criteria:{baseSlotName:"mid_boxad",tier:"3",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.18},{minTlbBid:1.85,floor:.14},{minTlbBid:1.6,floor:.14},{minTlbBid:1.35,floor:.13},{minTlbBid:1.1,floor:.12},{minTlbBid:.85,floor:.11},{minTlbBid:.6,floor:.11},{minTlbBid:.35,floor:.11},{minTlbBid:.2,floor:.11},{minTlbBid:.15,floor:.1},{minTlbBid:.11,floor:.1},{minTlbBid:.1,floor:.1}])},{criteria:{baseSlotName:"mid_boxad",tier:"4",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.28},{minTlbBid:1.85,floor:.25},{minTlbBid:1.6,floor:.26},{minTlbBid:1.35,floor:.23},{minTlbBid:1.1,floor:.19},{minTlbBid:.85,floor:.18},{minTlbBid:.6,floor:.16},{minTlbBid:.35,floor:.14},{minTlbBid:.2,floor:.12},{minTlbBid:.15,floor:.11},{minTlbBid:.11,floor:.11},{minTlbBid:.1,floor:.1}])},{criteria:{baseSlotName:"top_boxad",tier:"3",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.42},{minTlbBid:1.85,floor:.19},{minTlbBid:1.6,floor:.19},{minTlbBid:1.35,floor:.17},{minTlbBid:1.1,floor:.15},{minTlbBid:.85,floor:.14},{minTlbBid:.6,floor:.13},{minTlbBid:.35,floor:.13},{minTlbBid:.2,floor:.13},{minTlbBid:.15,floor:.12},{minTlbBid:.11,floor:.11},{minTlbBid:.1,floor:.11}])},{criteria:{baseSlotName:"top_boxad",tier:"4",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.48},{minTlbBid:1.85,floor:.32},{minTlbBid:1.6,floor:.34},{minTlbBid:1.35,floor:.29},{minTlbBid:1.1,floor:.27},{minTlbBid:.85,floor:.27},{minTlbBid:.6,floor:.26},{minTlbBid:.35,floor:.21},{minTlbBid:.2,floor:.18},{minTlbBid:.15,floor:.14},{minTlbBid:.11,floor:.12},{minTlbBid:.1,floor:.15}])},{criteria:{baseSlotName:"top_leaderboard",tier:"3",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.82},{minTlbBid:1.85,floor:.33},{minTlbBid:1.6,floor:.38},{minTlbBid:1.35,floor:.27},{minTlbBid:1.1,floor:.41},{minTlbBid:.85,floor:.28},{minTlbBid:.6,floor:.25},{minTlbBid:.35,floor:.2},{minTlbBid:.2,floor:.14},{minTlbBid:.15,floor:.12},{minTlbBid:.11,floor:.12},{minTlbBid:.1,floor:.1}])},{criteria:{baseSlotName:"top_leaderboard",tier:"4",geo:"au",pageStrategy:"tlb_predicts_5perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.44},{minTlbBid:1.85,floor:.35},{minTlbBid:1.6,floor:.29},{minTlbBid:1.35,floor:.29},{minTlbBid:1.1,floor:.27},{minTlbBid:.85,floor:.26},{minTlbBid:.6,floor:.25},{minTlbBid:.35,floor:.21},{minTlbBid:.2,floor:.17},{minTlbBid:.15,floor:.14},{minTlbBid:.11,floor:.12},{minTlbBid:.1,floor:.1}])},{criteria:{baseSlotName:"bottom_leaderboard",tier:"3",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.35},{minTlbBid:1.85,floor:.19},{minTlbBid:1.6,floor:.18},{minTlbBid:1.35,floor:.17},{minTlbBid:1.1,floor:.15},{minTlbBid:.85,floor:.16},{minTlbBid:.6,floor:.15},{minTlbBid:.35,floor:.16},{minTlbBid:.2,floor:.17},{minTlbBid:.15,floor:.14},{minTlbBid:.11,floor:.11},{minTlbBid:.1,floor:.1}])},{criteria:{baseSlotName:"bottom_leaderboard",tier:"4",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.42},{minTlbBid:1.85,floor:.36},{minTlbBid:1.6,floor:.43},{minTlbBid:1.35,floor:.39},{minTlbBid:1.1,floor:.38},{minTlbBid:.85,floor:.36},{minTlbBid:.6,floor:.32},{minTlbBid:.35,floor:.28},{minTlbBid:.2,floor:.2},{minTlbBid:.15,floor:.16},{minTlbBid:.11,floor:.14},{minTlbBid:.1,floor:.17}])},{criteria:{baseSlotName:"floor_adhesion",tier:"3",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:1.62},{minTlbBid:1.85,floor:.78},{minTlbBid:1.6,floor:.65},{minTlbBid:1.35,floor:.55},{minTlbBid:1.1,floor:.55},{minTlbBid:.85,floor:.47},{minTlbBid:.6,floor:.45},{minTlbBid:.35,floor:.35},{minTlbBid:.2,floor:.2},{minTlbBid:.15,floor:.17},{minTlbBid:.11,floor:.17},{minTlbBid:.1,floor:.18}])},{criteria:{baseSlotName:"floor_adhesion",tier:"4",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.79},{minTlbBid:1.85,floor:.6},{minTlbBid:1.6,floor:.61},{minTlbBid:1.35,floor:.6},{minTlbBid:1.1,floor:.59},{minTlbBid:.85,floor:.55},{minTlbBid:.6,floor:.51},{minTlbBid:.35,floor:.42},{minTlbBid:.2,floor:.3},{minTlbBid:.15,floor:.29},{minTlbBid:.11,floor:.29},{minTlbBid:.1,floor:.27}])},{criteria:{baseSlotName:"incontent_boxad",tier:"3",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:1.27},{minTlbBid:1.85,floor:.48},{minTlbBid:1.6,floor:.42},{minTlbBid:1.35,floor:.37},{minTlbBid:1.1,floor:.33},{minTlbBid:.85,floor:.29},{minTlbBid:.6,floor:.23},{minTlbBid:.35,floor:.21},{minTlbBid:.2,floor:.17},{minTlbBid:.15,floor:.15},{minTlbBid:.11,floor:.14},{minTlbBid:.1,floor:.13}])},{criteria:{baseSlotName:"incontent_boxad",tier:"4",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.78},{minTlbBid:1.85,floor:.57},{minTlbBid:1.6,floor:.54},{minTlbBid:1.35,floor:.49},{minTlbBid:1.1,floor:.43},{minTlbBid:.85,floor:.42},{minTlbBid:.6,floor:.38},{minTlbBid:.35,floor:.32},{minTlbBid:.2,floor:.23},{minTlbBid:.15,floor:.18},{minTlbBid:.11,floor:.18},{minTlbBid:.1,floor:.19}])},{criteria:{baseSlotName:"incontent_leaderboard",tier:"3",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.28},{minTlbBid:1.85,floor:.19},{minTlbBid:1.6,floor:.17},{minTlbBid:1.35,floor:.17},{minTlbBid:1.1,floor:.14},{minTlbBid:.85,floor:.14},{minTlbBid:.6,floor:.13},{minTlbBid:.35,floor:.13},{minTlbBid:.2,floor:.12},{minTlbBid:.15,floor:.12},{minTlbBid:.11,floor:.11},{minTlbBid:.1,floor:.11}])},{criteria:{baseSlotName:"incontent_leaderboard",tier:"4",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.45},{minTlbBid:1.85,floor:.35},{minTlbBid:1.6,floor:.33},{minTlbBid:1.35,floor:.34},{minTlbBid:1.1,floor:.28},{minTlbBid:.85,floor:.27},{minTlbBid:.6,floor:.23},{minTlbBid:.35,floor:.2},{minTlbBid:.2,floor:.16},{minTlbBid:.15,floor:.14},{minTlbBid:.11,floor:.13},{minTlbBid:.1,floor:.12}])},{criteria:{baseSlotName:"mid_boxad",tier:"3",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.3},{minTlbBid:1.85,floor:.19},{minTlbBid:1.6,floor:.19},{minTlbBid:1.35,floor:.16},{minTlbBid:1.1,floor:.14},{minTlbBid:.85,floor:.13},{minTlbBid:.6,floor:.13},{minTlbBid:.35,floor:.13},{minTlbBid:.2,floor:.12},{minTlbBid:.15,floor:.11},{minTlbBid:.11,floor:.11},{minTlbBid:.1,floor:.1}])},{criteria:{baseSlotName:"mid_boxad",tier:"4",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.44},{minTlbBid:1.85,floor:.38},{minTlbBid:1.6,floor:.39},{minTlbBid:1.35,floor:.34},{minTlbBid:1.1,floor:.28},{minTlbBid:.85,floor:.26},{minTlbBid:.6,floor:.22},{minTlbBid:.35,floor:.19},{minTlbBid:.2,floor:.15},{minTlbBid:.15,floor:.13},{minTlbBid:.11,floor:.12},{minTlbBid:.1,floor:.12}])},{criteria:{baseSlotName:"top_boxad",tier:"3",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.8},{minTlbBid:1.85,floor:.29},{minTlbBid:1.6,floor:.28},{minTlbBid:1.35,floor:.22},{minTlbBid:1.1,floor:.19},{minTlbBid:.85,floor:.18},{minTlbBid:.6,floor:.17},{minTlbBid:.35,floor:.17},{minTlbBid:.2,floor:.16},{minTlbBid:.15,floor:.14},{minTlbBid:.11,floor:.13},{minTlbBid:.1,floor:.13}])},{criteria:{baseSlotName:"top_boxad",tier:"4",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.73},{minTlbBid:1.85,floor:.46},{minTlbBid:1.6,floor:.51},{minTlbBid:1.35,floor:.46},{minTlbBid:1.1,floor:.41},{minTlbBid:.85,floor:.41},{minTlbBid:.6,floor:.4},{minTlbBid:.35,floor:.32},{minTlbBid:.2,floor:.23},{minTlbBid:.15,floor:.19},{minTlbBid:.11,floor:.18},{minTlbBid:.1,floor:.26}])},{criteria:{baseSlotName:"top_leaderboard",tier:"3",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:1.6},{minTlbBid:1.85,floor:.59},{minTlbBid:1.6,floor:.59},{minTlbBid:1.35,floor:.48},{minTlbBid:1.1,floor:.54},{minTlbBid:.85,floor:.44},{minTlbBid:.6,floor:.36},{minTlbBid:.35,floor:.26},{minTlbBid:.2,floor:.18},{minTlbBid:.15,floor:.15},{minTlbBid:.11,floor:.12},{minTlbBid:.1,floor:.1}])},{criteria:{baseSlotName:"top_leaderboard",tier:"4",geo:"au",pageStrategy:"tlb_predicts_10perc:v01"},calculateFloor:p([{minTlbBid:2.1,floor:.7},{minTlbBid:1.85,floor:.49},{minTlbBid:1.6,floor:.42},{minTlbBid:1.35,floor:.47},{minTlbBid:1.1,floor:.4},{minTlbBid:.85,floor:.35},{minTlbBid:.6,floor:.34},{minTlbBid:.35,floor:.27},{minTlbBid:.2,floor:.2},{minTlbBid:.15,floor:.16},{minTlbBid:.11,floor:.14},{minTlbBid:.1,floor:.13}])}];function qs(n,i,e){const t={"*":ue.data.default};for(const r of i){const o=r.getSlotName(),a=js(r,n);a&&(t[o]=a.calculateFloor(e))}return t}function Ut(n,i){const e=n.gptWrapper.getAllTargeting({raw:!0});return $s.filter(r=>{const o=Se(r.criteria.tier,e.tier[0]),a=Se(r.criteria.geo,e.geo[0]),d=i===void 0||Se(r.criteria.pageStrategy,i);return o&&a&&d})}function js(n,i){const e=n.getBaseSlotName(),t=i.filter(r=>Se(r.criteria.baseSlotName,e));if(t.length!==0)return t.length>1&&h({message:`DynamicPriceFloor: Unexpected number of matching dynamic floor configs for this slot ${e}`,priority:c.P3}),t[0]}const he="ay_floor",fe="ay_floor_g",Ks="hb_pb";function Vt(n,i,e){if(n<=1||n>=3.5)return n;const t=Number((n-e).toFixed(2)),r=Number((t%i).toFixed(2));return r===i?n:Number((n-r).toFixed(2))}function Bi(n){let i;return n>=3.5?i=3.5:n>=2?i=Vt(n,.03,2):n>=1?i=Vt(n,.02,1):n>=0?i=n:i=0,i.toFixed(2)}function Ys(n){var t;n.clearTargeting(he),n.clearTargeting(fe);const i=parseFloat((t=n.getTargeting(Ks))==null?void 0:t[0]);if(isNaN(i))return;const e=Bi(i);n.setTargeting(he,e),n.setTargeting(fe,"beatPrebid")}function Qs(n,i){const e=n.getSlotName(),t=i[e];if(t){n.clearTargeting(he),n.clearTargeting(fe);const r=Bi(t);n.setTargeting(he,r),n.setTargeting(fe,"getFloors")}}function Xs(n){let i=5381;for(let e=0;e<n.length;e++){const t=n.charCodeAt(e);i=(i<<5)+i+t,i|=0}return(i>>>0).toString(16)}function Zs(n){const i=["geo","monetization","tier"].map(e=>{const t=n[e],r=Array.isArray(t)?t.sort().join(","):t;return`${e}=${r}`}).join("&");return{targetingStr:i,hash:Xs(i)}}class Js extends g{constructor(e){super();s(this,"name","DynamicPriceFloorPlugin");s(this,"floorStrategy");s(this,"supportedStrategies",["ctrl","fndm_0","tlb_predicts_5perc:v01","tlb_predicts_10perc:v01"]);s(this,"initialized",!1);s(this,"adEngine");s(this,"floorValues");s(this,"cohortHashResult");s(this,"icDynamicFloorStrategies");s(this,"tlbBidPrice");s(this,"targetingDebugStates",[]);s(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,this.floorStrategy=this.pickPageStrategy(e),this.trackBidsReceived(),this.initialized=!0,this.calculateFloors(),this.setPrebidFloorConfig(),this.scheduleBeatPrebidTargeting(),e.gptWrapper.setTargeting({dyn_floor_src:this.floorStrategy}),this.cohortHashResult=Zs(e.gptWrapper.getAllTargeting({raw:!0})),e.gptWrapper.setTargeting({dyn_ads_cohort:this.cohortHashResult.hash})},onBeforeAdsRequest:e=>{e.forEach(t=>{this.targetingDebugStates.push({slotName:t.getSlotName(),hb_pb:t.getTargeting("hb_pb")[0],ay_floor:t.getTargeting("ay_floor")[0],ay_floor_g:t.getTargeting("ay_floor_g")[0]})})},onCreateBidderAdUnit:(e,t,r)=>{if(Xe("prebid",e,r))for(const o of r)this.resetFloorKeyValues(o);Xe("a9",e,r)&&this.setA9FloorOnAuction(r)}});this.icDynamicFloorStrategies={beatPrebid:!0,tlbPredicts:!1,...e.icDynamicFloorStrategies}}static isEnabled(e){return!!(e!=null&&e.icDynamicFloorEnabled)}pickPageStrategy(e){const t=Be("dyn_flr_src");if(t){if(this.supportedStrategies.includes(t))return t;console.error("Unsupported query param used for dyn_flr_src")}if(this.icDynamicFloorStrategies.tlbPredicts&&Ut(e).length>0){const o=Math.random();if(o<.1)return"tlb_predicts_5perc:v01";if(o<.2)return"tlb_predicts_10perc:v01"}return"fndm_0"}getDebugState(){return{icDynamicFloorStrategies:{...this.icDynamicFloorStrategies},floorStrategy:this.floorStrategy,tlbBidPrice:this.tlbBidPrice,floorValues:{...this.floorValues},cohortHashResult:{...this.cohortHashResult},targetingDebugStates:this.targetingDebugStates}}calculateFloors(){if(!this.isGetFloorsEligible())return;const e=Ut(this.adEngine,this.floorStrategy),t=this.adEngine.adNodeManager.getAdNodes();this.floorValues=qs(e,t,this.tlbBidPrice)}setPrebidFloorConfig(){if(!this.isGetFloorsEligible())return;if(!this.floorValues){h({message:"Expected floorValues to already be calculated",priority:c.P3});return}const e=this.usePlugin(v);e==null||e.addPrebidReadyCallback(t=>{t.setConfig({floors:{data:{...ue.data,schema:{fields:["adUnitCode"]},values:this.floorValues}}})})}isGetFloorsEligible(){return!(!this.initialized||["ctrl","fndm_0"].includes(this.floorStrategy))}setA9FloorOnAuction(e){this.isGetFloorsEligible()&&this.floorValues&&e.slots.forEach(t=>{var o,a;let r=((o=this.floorValues)==null?void 0:o[t.slotID])??((a=this.floorValues)==null?void 0:a["*"])??void 0;r?r=Math.round(r*100):r=oi,t.floor={currency:"USD",value:r}})}trackBidsReceived(){var e;(e=this.usePlugin(v))==null||e.addPrebidReadyCallback(t=>{t.onEvent("auctionEnd",r=>{this.tlbBidPrice===void 0&&(r.bidsReceived.forEach(o=>{o.adUnitCode==="top_leaderboard"&&(this.tlbBidPrice=Math.max(this.tlbBidPrice??0,o.cpm))}),this.tlbBidPrice!==void 0&&(this.calculateFloors(),this.setPrebidFloorConfig()))})})}scheduleBeatPrebidTargeting(){var e;["ctrl"].includes(this.floorStrategy)||(e=this.usePlugin(v))==null||e.addPrebidReadyCallback(t=>{t.onEvent("setTargeting",r=>{Object.keys(r).forEach(o=>{var d;const a=this.adEngine.adNodeManager.getAdNodeByName(o);a&&((d=a.getTargeting("ay_floor_g"))==null?void 0:d[0])!=="getFloors"&&Ys(a)})})})}resetFloorKeyValues(e){const t=this.adEngine.adNodeManager.getAdNodeByName(e.code);t&&(t.clearTargeting(he),t.clearTargeting(fe),this.tlbBidPrice&&this.isGetFloorsEligible()&&this.floorValues&&Qs(t,this.floorValues))}}function dt(n,i){return n.filter(e=>e.isEnabled(i)).map(e=>new e(i))}function ea(n){return dt([lo,Ss,Ze,hs,gs,Jo,vs,ws,us,ne,Us,Zo,Bs],n)}function ta(n){return dt([co,v,Do,ks,Cs],n)}function ia(n){return dt([Js],n)}async function na(){const{config:n,activeLabradorKeyValues:i}=await Zt(),e=await Gn(Te()),t={InterstitialPlugin:new Is,FloorAdhesionPlugin:new bi,TopStrategyTunerPlugin:new Qo(n),SlotRefresherPlugin:new ge(n),VastUrlPlugin:new Qe(n),LightboxLeaderboardPlugin:new Xo(n),InContentBoxadPlugin:new Pe,InContentPlayerPlugin:new Ai,InContentLeaderboardPlugin:new Ce,PageLevelTargetingPlugin:new Co(i)},r=new Ls([Ri,wi,Ni]),o=[new fi,new Je(n),new gi(n),new po,...Object.values(t),new di,new Po,new Ci,new No,new uo,new ot,new Hs,...ia(n),...ta(n),...ea(n),...r.getExperimentPlugins(),...await un()],a=new Map(o.map(u=>[u.constructor,u]));o.forEach(u=>{u.setPlugins(a)}),performance.mark(P.AE_AFTER_INIT_PLUGINS);const d={flags:i};f($t.LABRADOR_KEYVALUES,d);const l=await Wn(n,o,e);return l.start(),{exposedPlugins:t,adEngine:l}}function ra(n,i,...e){const t=document.createElement(n);return i&&Object.keys(i).forEach(r=>{r.startsWith("on")?t.addEventListener(r.slice(2).toLowerCase(),i[r]):r==="ref"?i[r].current=t:t[r]=i[r]}),t.append(...e.filter(r=>!!r)),t}window.jsxRenderer=ra;function oa(){typeof Promise.withResolvers!="function"&&(Promise.withResolvers=()=>{let n,i;return{promise:new Promise((t,r)=>{n=t,i=r}),resolve:n,reject:i}})}oa();performance.mark(P.AE_FIRST_LINE_EXEC);na().then(({exposedPlugins:n,adEngine:i})=>{var e;window.fandomAds=new an(n,i,(e=window.fandomAds)==null?void 0:e.cmd)}).catch(n=>{h({message:"Failed to load ad engine",priority:c.P1,error:n})});export{g as A,c as I,A as M,v as P,Qt as U,B as _,G as a,Gt as b,k as c,te as d,go as e,Fo as f,Be as g,Ee as h,T as i,fn as j,Wt as k,tt as m,h as r};
//# sourceMappingURL=main.js.map
